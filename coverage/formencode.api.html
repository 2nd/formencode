<html>
<head>
<title>formencode.api</title>
</head>
<body>
formencode.api
<style>
.coverage pre {float: left; margin: 0px 1em; border: none;
               padding: 0px; }
.num pre { margin: 0px }
.nocov, .nocov pre {background-color: #faa}
.cov, .cov pre {background-color: #cfc}
div.coverage div { clear: both; height: 1.1em}
</style>
<div class="stats">
Covered: 131 lines<br/>
Missed: 265 lines<br/>
Skipped 93 lines<br/>
Percent: 33 %<br/>

</div>
<div class="coverage">
<div class="cov"><span class="num"><pre>  1</pre></span><pre>&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>  2</pre></span><pre>Core classes for validation.</pre></div>
<div class="cov"><span class="num"><pre>  3</pre></span><pre>&quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>  4</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>  5</pre></span><pre>import declarative</pre></div>
<div class="nocov"><span class="num"><pre>  6</pre></span><pre>import textwrap</pre></div>
<div class="nocov"><span class="num"><pre>  7</pre></span><pre>import re</pre></div>
<div class="nocov"><span class="num"><pre>  8</pre></span><pre>import os</pre></div>
<div class="nocov"><span class="num"><pre>  9</pre></span><pre>try:</pre></div>
<div class="nocov"><span class="num"><pre> 10</pre></span><pre>    from pkg_resources import resource_filename</pre></div>
<div class="nocov"><span class="num"><pre> 11</pre></span><pre>except ImportError:</pre></div>
<div class="nocov"><span class="num"><pre> 12</pre></span><pre>    resource_filename = None</pre></div>
<div class="skip"><span class="num"><pre> 13</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 14</pre></span><pre>__all__ = ['NoDefault', 'Invalid', 'Validator', 'Identity',</pre></div>
<div class="nocov"><span class="num"><pre> 15</pre></span><pre>           'FancyValidator', 'is_validator']</pre></div>
<div class="skip"><span class="num"><pre> 16</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 17</pre></span><pre>import gettext</pre></div>
<div class="skip"><span class="num"><pre> 18</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 19</pre></span><pre>def get_localedir():</pre></div>
<div class="nocov"><span class="num"><pre> 20</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 21</pre></span><pre>    Retrieve the location of locales.</pre></div>
<div class="skip"><span class="num"><pre> 22</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 23</pre></span><pre>    If we're built as an egg, we need to find the resource within the egg.</pre></div>
<div class="nocov"><span class="num"><pre> 24</pre></span><pre>    Otherwise, we need to look for the locales on the filesystem or in the</pre></div>
<div class="nocov"><span class="num"><pre> 25</pre></span><pre>    system message catalog.</pre></div>
<div class="nocov"><span class="num"><pre> 26</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 27</pre></span><pre>    locale_dir = ''</pre></div>
<div class="skip"><span class="num"><pre> 28</pre></span><pre>    # Check the egg first</pre></div>
<div class="nocov"><span class="num"><pre> 29</pre></span><pre>    if resource_filename is not None:</pre></div>
<div class="nocov"><span class="num"><pre> 30</pre></span><pre>        try:</pre></div>
<div class="nocov"><span class="num"><pre> 31</pre></span><pre>            locale_dir = resource_filename(__name__, &quot;/i18n&quot;)</pre></div>
<div class="nocov"><span class="num"><pre> 32</pre></span><pre>        except NotImplementedError:</pre></div>
<div class="skip"><span class="num"><pre> 33</pre></span><pre>            # resource_filename doesn't work with non-egg zip files</pre></div>
<div class="nocov"><span class="num"><pre> 34</pre></span><pre>            pass</pre></div>
<div class="nocov"><span class="num"><pre> 35</pre></span><pre>    if not hasattr(os, 'access'):</pre></div>
<div class="skip"><span class="num"><pre> 36</pre></span><pre>        # This happens on Google App Engine</pre></div>
<div class="nocov"><span class="num"><pre> 37</pre></span><pre>        return os.path.join(os.path.dirname(__file__), 'i18n')</pre></div>
<div class="nocov"><span class="num"><pre> 38</pre></span><pre>    if os.access(locale_dir, os.R_OK | os.X_OK):</pre></div>
<div class="skip"><span class="num"><pre> 39</pre></span><pre>        # If the resource is present in the egg, use it</pre></div>
<div class="nocov"><span class="num"><pre> 40</pre></span><pre>        return locale_dir</pre></div>
<div class="skip"><span class="num"><pre> 41</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 42</pre></span><pre>    # Otherwise, search the filesystem</pre></div>
<div class="nocov"><span class="num"><pre> 43</pre></span><pre>    locale_dir = os.path.join(os.path.dirname(__file__), 'i18n')</pre></div>
<div class="nocov"><span class="num"><pre> 44</pre></span><pre>    if not os.access(locale_dir, os.R_OK | os.X_OK):</pre></div>
<div class="skip"><span class="num"><pre> 45</pre></span><pre>        # Fallback on the system catalog</pre></div>
<div class="nocov"><span class="num"><pre> 46</pre></span><pre>        locale_dir = os.path.normpath('/usr/share/locale')</pre></div>
<div class="skip"><span class="num"><pre> 47</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 48</pre></span><pre>    return locale_dir</pre></div>
<div class="skip"><span class="num"><pre> 49</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 50</pre></span><pre>def set_stdtranslation(domain=&quot;FormEncode&quot;, languages=None, \</pre></div>
<div class="nocov"><span class="num"><pre> 51</pre></span><pre>                       localedir = get_localedir()):</pre></div>
<div class="skip"><span class="num"><pre> 52</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 53</pre></span><pre>    t = gettext.translation(domain=domain, \</pre></div>
<div class="cov"><span class="num"><pre> 54</pre></span><pre>                            languages=languages, \</pre></div>
<div class="cov"><span class="num"><pre> 55</pre></span><pre>                            localedir=localedir, fallback=True)</pre></div>
<div class="cov"><span class="num"><pre> 56</pre></span><pre>    global _stdtrans</pre></div>
<div class="cov"><span class="num"><pre> 57</pre></span><pre>    _stdtrans = t.ugettext</pre></div>
<div class="skip"><span class="num"><pre> 58</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 59</pre></span><pre>set_stdtranslation()</pre></div>
<div class="skip"><span class="num"><pre> 60</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 61</pre></span><pre>def _(s): return s # dummy i18n translation function, nothing is translated here.</pre></div>
<div class="skip"><span class="num"><pre> 62</pre></span><pre>                   # Instead this is actually done in api.Validator.message.</pre></div>
<div class="skip"><span class="num"><pre> 63</pre></span><pre>                   # The surrounding _(&quot;string&quot;) of the strings is only for extracting</pre></div>
<div class="skip"><span class="num"><pre> 64</pre></span><pre>                   # the strings automatically</pre></div>
<div class="skip"><span class="num"><pre> 65</pre></span><pre>                   # if you run pygettext with this source comment this function out temporarly </pre></div>
<div class="skip"><span class="num"><pre> 66</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 67</pre></span><pre>class NoDefault:</pre></div>
<div class="nocov"><span class="num"><pre> 68</pre></span><pre>    pass</pre></div>
<div class="skip"><span class="num"><pre> 69</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 70</pre></span><pre>def is_validator(obj):</pre></div>
<div class="cov"><span class="num"><pre> 71</pre></span><pre>    return (isinstance(obj, Validator) or</pre></div>
<div class="cov"><span class="num"><pre> 72</pre></span><pre>            (isinstance(obj, type) and</pre></div>
<div class="cov"><span class="num"><pre> 73</pre></span><pre>             issubclass(obj, Validator)))</pre></div>
<div class="skip"><span class="num"><pre> 74</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 75</pre></span><pre>class Invalid(Exception):</pre></div>
<div class="skip"><span class="num"><pre> 76</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 77</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 78</pre></span><pre>    This is raised in response to invalid input.  It has several</pre></div>
<div class="nocov"><span class="num"><pre> 79</pre></span><pre>    public attributes:</pre></div>
<div class="skip"><span class="num"><pre> 80</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 81</pre></span><pre>    msg:</pre></div>
<div class="nocov"><span class="num"><pre> 82</pre></span><pre>        The message, *without* values substituted.  For instance, if</pre></div>
<div class="nocov"><span class="num"><pre> 83</pre></span><pre>        you want HTML quoting of values, you can apply that.</pre></div>
<div class="nocov"><span class="num"><pre> 84</pre></span><pre>    substituteArgs:</pre></div>
<div class="nocov"><span class="num"><pre> 85</pre></span><pre>        The arguments (a dictionary) to go with `msg`.</pre></div>
<div class="nocov"><span class="num"><pre> 86</pre></span><pre>    str(self):</pre></div>
<div class="nocov"><span class="num"><pre> 87</pre></span><pre>        The message describing the error, with values substituted.</pre></div>
<div class="nocov"><span class="num"><pre> 88</pre></span><pre>    value:</pre></div>
<div class="nocov"><span class="num"><pre> 89</pre></span><pre>        The offending (invalid) value.</pre></div>
<div class="nocov"><span class="num"><pre> 90</pre></span><pre>    state:</pre></div>
<div class="nocov"><span class="num"><pre> 91</pre></span><pre>        The state that went with this validator.  This is an</pre></div>
<div class="nocov"><span class="num"><pre> 92</pre></span><pre>        application-specific object.</pre></div>
<div class="nocov"><span class="num"><pre> 93</pre></span><pre>    error_list:</pre></div>
<div class="nocov"><span class="num"><pre> 94</pre></span><pre>        If this was a compound validator that takes a repeating value,</pre></div>
<div class="nocov"><span class="num"><pre> 95</pre></span><pre>        and sub-validator(s) had errors, then this is a list of those</pre></div>
<div class="nocov"><span class="num"><pre> 96</pre></span><pre>        exceptions.  The list will be the same length as the number of</pre></div>
<div class="nocov"><span class="num"><pre> 97</pre></span><pre>        values -- valid values will have None instead of an exception.</pre></div>
<div class="nocov"><span class="num"><pre> 98</pre></span><pre>    error_dict:</pre></div>
<div class="nocov"><span class="num"><pre> 99</pre></span><pre>        Like `error_list`, but for dictionary compound validators.</pre></div>
<div class="nocov"><span class="num"><pre>100</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>101</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>102</pre></span><pre>    def __init__(self, msg,</pre></div>
<div class="nocov"><span class="num"><pre>103</pre></span><pre>                 value, state, error_list=None, error_dict=None):</pre></div>
<div class="cov"><span class="num"><pre>104</pre></span><pre>        Exception.__init__(self, msg)</pre></div>
<div class="cov"><span class="num"><pre>105</pre></span><pre>        self.msg = msg</pre></div>
<div class="cov"><span class="num"><pre>106</pre></span><pre>        self.value = value</pre></div>
<div class="cov"><span class="num"><pre>107</pre></span><pre>        self.state = state</pre></div>
<div class="cov"><span class="num"><pre>108</pre></span><pre>        self.error_list = error_list</pre></div>
<div class="cov"><span class="num"><pre>109</pre></span><pre>        self.error_dict = error_dict</pre></div>
<div class="cov"><span class="num"><pre>110</pre></span><pre>        assert (not self.error_list or not self.error_dict), (</pre></div>
<div class="cov"><span class="num"><pre>111</pre></span><pre>                &quot;Errors shouldn't have both error dicts and lists &quot;</pre></div>
<div class="cov"><span class="num"><pre>112</pre></span><pre>                &quot;(error %s has %s and %s)&quot;</pre></div>
<div class="cov"><span class="num"><pre>113</pre></span><pre>                % (self, self.error_list, self.error_dict))</pre></div>
<div class="skip"><span class="num"><pre>114</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>115</pre></span><pre>    def __str__(self):</pre></div>
<div class="cov"><span class="num"><pre>116</pre></span><pre>        val = self.msg</pre></div>
<div class="skip"><span class="num"><pre>117</pre></span><pre>        #if self.value:</pre></div>
<div class="skip"><span class="num"><pre>118</pre></span><pre>        #    val += &quot; (value: %s)&quot; % repr(self.value)</pre></div>
<div class="cov"><span class="num"><pre>119</pre></span><pre>        return val    </pre></div>
<div class="skip"><span class="num"><pre>120</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>121</pre></span><pre>    def __unicode__(self):</pre></div>
<div class="cov"><span class="num"><pre>122</pre></span><pre>        if isinstance(self.msg, unicode):</pre></div>
<div class="cov"><span class="num"><pre>123</pre></span><pre>            return self.msg</pre></div>
<div class="cov"><span class="num"><pre>124</pre></span><pre>        elif isinstance(self.msg, str):</pre></div>
<div class="cov"><span class="num"><pre>125</pre></span><pre>            return self.msg.decode('utf8')</pre></div>
<div class="nocov"><span class="num"><pre>126</pre></span><pre>        else:</pre></div>
<div class="nocov"><span class="num"><pre>127</pre></span><pre>            return unicode(self.msg)</pre></div>
<div class="skip"><span class="num"><pre>128</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>129</pre></span><pre>    def unpack_errors(self, encode_variables=False, dict_char='.',</pre></div>
<div class="nocov"><span class="num"><pre>130</pre></span><pre>                      list_char='-'):</pre></div>
<div class="nocov"><span class="num"><pre>131</pre></span><pre>        &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>132</pre></span><pre>        Returns the error as a simple data structure -- lists,</pre></div>
<div class="nocov"><span class="num"><pre>133</pre></span><pre>        dictionaries, and strings.</pre></div>
<div class="skip"><span class="num"><pre>134</pre></span><pre>        </pre></div>
<div class="nocov"><span class="num"><pre>135</pre></span><pre>        If ``encode_variables`` is true, then this will return a flat</pre></div>
<div class="nocov"><span class="num"><pre>136</pre></span><pre>        dictionary, encoded with variable_encode</pre></div>
<div class="nocov"><span class="num"><pre>137</pre></span><pre>        &quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>138</pre></span><pre>        if self.error_list:</pre></div>
<div class="cov"><span class="num"><pre>139</pre></span><pre>            assert not encode_variables, (</pre></div>
<div class="cov"><span class="num"><pre>140</pre></span><pre>                &quot;You can only encode dictionary errors&quot;)</pre></div>
<div class="cov"><span class="num"><pre>141</pre></span><pre>            assert not self.error_dict</pre></div>
<div class="cov"><span class="num"><pre>142</pre></span><pre>            result = []</pre></div>
<div class="cov"><span class="num"><pre>143</pre></span><pre>            for item in self.error_list:</pre></div>
<div class="cov"><span class="num"><pre>144</pre></span><pre>                if not item:</pre></div>
<div class="nocov"><span class="num"><pre>145</pre></span><pre>                    result.append(item)</pre></div>
<div class="cov"><span class="num"><pre>146</pre></span><pre>                else:</pre></div>
<div class="cov"><span class="num"><pre>147</pre></span><pre>                    result.append(item.unpack_errors())</pre></div>
<div class="cov"><span class="num"><pre>148</pre></span><pre>            return result</pre></div>
<div class="cov"><span class="num"><pre>149</pre></span><pre>        elif self.error_dict:</pre></div>
<div class="cov"><span class="num"><pre>150</pre></span><pre>            result = {}</pre></div>
<div class="cov"><span class="num"><pre>151</pre></span><pre>            for name, item in self.error_dict.items():</pre></div>
<div class="cov"><span class="num"><pre>152</pre></span><pre>                if isinstance(item, (str, unicode)):</pre></div>
<div class="cov"><span class="num"><pre>153</pre></span><pre>                    result[name] = item</pre></div>
<div class="cov"><span class="num"><pre>154</pre></span><pre>                else:</pre></div>
<div class="cov"><span class="num"><pre>155</pre></span><pre>                    result[name] = item.unpack_errors()</pre></div>
<div class="cov"><span class="num"><pre>156</pre></span><pre>            if encode_variables:</pre></div>
<div class="nocov"><span class="num"><pre>157</pre></span><pre>                import variabledecode</pre></div>
<div class="nocov"><span class="num"><pre>158</pre></span><pre>                result = variabledecode.variable_encode(result, add_repetitions=False,</pre></div>
<div class="nocov"><span class="num"><pre>159</pre></span><pre>                                                        dict_char=dict_char,</pre></div>
<div class="nocov"><span class="num"><pre>160</pre></span><pre>                                                        list_char=list_char)</pre></div>
<div class="nocov"><span class="num"><pre>161</pre></span><pre>                for key in result.keys():</pre></div>
<div class="nocov"><span class="num"><pre>162</pre></span><pre>                    if not result[key]:</pre></div>
<div class="nocov"><span class="num"><pre>163</pre></span><pre>                        del result[key]</pre></div>
<div class="cov"><span class="num"><pre>164</pre></span><pre>            return result</pre></div>
<div class="cov"><span class="num"><pre>165</pre></span><pre>        else:</pre></div>
<div class="cov"><span class="num"><pre>166</pre></span><pre>            assert not encode_variables, (</pre></div>
<div class="cov"><span class="num"><pre>167</pre></span><pre>                &quot;You can only encode dictionary errors&quot;)</pre></div>
<div class="cov"><span class="num"><pre>168</pre></span><pre>            return self.msg</pre></div>
<div class="skip"><span class="num"><pre>169</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>170</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>171</pre></span><pre>############################################################</pre></div>
<div class="skip"><span class="num"><pre>172</pre></span><pre>## Base Classes</pre></div>
<div class="skip"><span class="num"><pre>173</pre></span><pre>############################################################</pre></div>
<div class="skip"><span class="num"><pre>174</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>175</pre></span><pre>class Validator(declarative.Declarative):</pre></div>
<div class="skip"><span class="num"><pre>176</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>177</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>178</pre></span><pre>    The base class of most validators.  See `IValidator` for more, and</pre></div>
<div class="nocov"><span class="num"><pre>179</pre></span><pre>    `FancyValidator` for the more common (and more featureful) class.</pre></div>
<div class="nocov"><span class="num"><pre>180</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>181</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>182</pre></span><pre>    _messages = {}</pre></div>
<div class="nocov"><span class="num"><pre>183</pre></span><pre>    if_missing = NoDefault</pre></div>
<div class="nocov"><span class="num"><pre>184</pre></span><pre>    repeating = False</pre></div>
<div class="nocov"><span class="num"><pre>185</pre></span><pre>    compound = False</pre></div>
<div class="nocov"><span class="num"><pre>186</pre></span><pre>    gettextargs = {}</pre></div>
<div class="nocov"><span class="num"><pre>187</pre></span><pre>    use_builtins_gettext = True #In case you dont want to use __builtins__._</pre></div>
<div class="skip"><span class="num"><pre>188</pre></span><pre>                                #altough it may be definied, set this to False</pre></div>
<div class="skip"><span class="num"><pre>189</pre></span><pre>    </pre></div>
<div class="nocov"><span class="num"><pre>190</pre></span><pre>    __singletonmethods__ = ('to_python', 'from_python', 'message', 'all_messages',</pre></div>
<div class="nocov"><span class="num"><pre>191</pre></span><pre>                            'subvalidators')</pre></div>
<div class="skip"><span class="num"><pre>192</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>193</pre></span><pre>    def __classinit__(cls, new_attrs):</pre></div>
<div class="cov"><span class="num"><pre>194</pre></span><pre>        if new_attrs.has_key('messages'):</pre></div>
<div class="nocov"><span class="num"><pre>195</pre></span><pre>            cls._messages = cls._messages.copy()</pre></div>
<div class="nocov"><span class="num"><pre>196</pre></span><pre>            cls._messages.update(cls.messages)</pre></div>
<div class="nocov"><span class="num"><pre>197</pre></span><pre>            del cls.messages</pre></div>
<div class="cov"><span class="num"><pre>198</pre></span><pre>        cls._initialize_docstring()</pre></div>
<div class="skip"><span class="num"><pre>199</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>200</pre></span><pre>    def __init__(self, *args, **kw):</pre></div>
<div class="cov"><span class="num"><pre>201</pre></span><pre>        if kw.has_key('messages'):</pre></div>
<div class="cov"><span class="num"><pre>202</pre></span><pre>            self._messages = self._messages.copy()</pre></div>
<div class="cov"><span class="num"><pre>203</pre></span><pre>            self._messages.update(kw['messages'])</pre></div>
<div class="cov"><span class="num"><pre>204</pre></span><pre>            del kw['messages']</pre></div>
<div class="cov"><span class="num"><pre>205</pre></span><pre>        declarative.Declarative.__init__(self, *args, **kw)</pre></div>
<div class="skip"><span class="num"><pre>206</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>207</pre></span><pre>    def to_python(self, value, state=None):</pre></div>
<div class="nocov"><span class="num"><pre>208</pre></span><pre>        return value</pre></div>
<div class="skip"><span class="num"><pre>209</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>210</pre></span><pre>    def from_python(self, value, state=None):</pre></div>
<div class="nocov"><span class="num"><pre>211</pre></span><pre>        return value</pre></div>
<div class="skip"><span class="num"><pre>212</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>213</pre></span><pre>    def message(self, msgName, state, **kw):</pre></div>
<div class="skip"><span class="num"><pre>214</pre></span><pre>        #determine translation function</pre></div>
<div class="cov"><span class="num"><pre>215</pre></span><pre>        try:</pre></div>
<div class="cov"><span class="num"><pre>216</pre></span><pre>            trans = state._</pre></div>
<div class="cov"><span class="num"><pre>217</pre></span><pre>        except AttributeError:</pre></div>
<div class="cov"><span class="num"><pre>218</pre></span><pre>            try:</pre></div>
<div class="cov"><span class="num"><pre>219</pre></span><pre>                if self.use_builtins_gettext:</pre></div>
<div class="cov"><span class="num"><pre>220</pre></span><pre>                    import __builtin__</pre></div>
<div class="cov"><span class="num"><pre>221</pre></span><pre>                    trans = __builtin__._</pre></div>
<div class="skip"><span class="num"><pre>222</pre></span><pre>                    </pre></div>
<div class="cov"><span class="num"><pre>223</pre></span><pre>                else:</pre></div>
<div class="cov"><span class="num"><pre>224</pre></span><pre>                    trans = _stdtrans</pre></div>
<div class="skip"><span class="num"><pre>225</pre></span><pre> </pre></div>
<div class="cov"><span class="num"><pre>226</pre></span><pre>            except AttributeError:</pre></div>
<div class="cov"><span class="num"><pre>227</pre></span><pre>                trans = _stdtrans</pre></div>
<div class="skip"><span class="num"><pre>228</pre></span><pre> </pre></div>
<div class="cov"><span class="num"><pre>229</pre></span><pre>        if not callable(trans):</pre></div>
<div class="nocov"><span class="num"><pre>230</pre></span><pre>            trans = _stdtrans</pre></div>
<div class="skip"><span class="num"><pre>231</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>232</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>233</pre></span><pre>        msg = self._messages[msgName]</pre></div>
<div class="cov"><span class="num"><pre>234</pre></span><pre>        msg = trans(msg, **self.gettextargs)</pre></div>
<div class="cov"><span class="num"><pre>235</pre></span><pre>        try:</pre></div>
<div class="cov"><span class="num"><pre>236</pre></span><pre>            return msg % kw</pre></div>
<div class="nocov"><span class="num"><pre>237</pre></span><pre>        except KeyError, e:</pre></div>
<div class="nocov"><span class="num"><pre>238</pre></span><pre>            raise KeyError(</pre></div>
<div class="nocov"><span class="num"><pre>239</pre></span><pre>                &quot;Key not found (%s) for %r=%r %% %r (from: %s)&quot;</pre></div>
<div class="nocov"><span class="num"><pre>240</pre></span><pre>                % (e, msgName, self._messages.get(msgName), kw,</pre></div>
<div class="nocov"><span class="num"><pre>241</pre></span><pre>                   ', '.join(self._messages.keys())))</pre></div>
<div class="skip"><span class="num"><pre>242</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>243</pre></span><pre>    def all_messages(self):</pre></div>
<div class="nocov"><span class="num"><pre>244</pre></span><pre>        &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>245</pre></span><pre>        Return a dictionary of all the messages of this validator, and</pre></div>
<div class="nocov"><span class="num"><pre>246</pre></span><pre>        any subvalidators if present.  Keys are message names, values</pre></div>
<div class="nocov"><span class="num"><pre>247</pre></span><pre>        may be a message or list of messages.  This is really just</pre></div>
<div class="nocov"><span class="num"><pre>248</pre></span><pre>        intended for documentation purposes, to show someone all the</pre></div>
<div class="nocov"><span class="num"><pre>249</pre></span><pre>        messages that a validator or compound validator (like Schemas)</pre></div>
<div class="nocov"><span class="num"><pre>250</pre></span><pre>        can produce.</pre></div>
<div class="skip"><span class="num"><pre>251</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>252</pre></span><pre>        @@: Should this produce a more structured set of messages, so</pre></div>
<div class="nocov"><span class="num"><pre>253</pre></span><pre>        that messages could be unpacked into a rendered form to see</pre></div>
<div class="nocov"><span class="num"><pre>254</pre></span><pre>        the placement of all the messages?  Well, probably so.</pre></div>
<div class="nocov"><span class="num"><pre>255</pre></span><pre>        &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>256</pre></span><pre>        msgs = self._messages.copy()</pre></div>
<div class="nocov"><span class="num"><pre>257</pre></span><pre>        for v in self.subvalidators():</pre></div>
<div class="nocov"><span class="num"><pre>258</pre></span><pre>            inner = v.all_messages()</pre></div>
<div class="nocov"><span class="num"><pre>259</pre></span><pre>            for key, msg in inner:</pre></div>
<div class="nocov"><span class="num"><pre>260</pre></span><pre>                if key in msgs:</pre></div>
<div class="nocov"><span class="num"><pre>261</pre></span><pre>                    if msgs[key] == msg:</pre></div>
<div class="nocov"><span class="num"><pre>262</pre></span><pre>                        continue</pre></div>
<div class="nocov"><span class="num"><pre>263</pre></span><pre>                    if isinstance(msgs[key], list):</pre></div>
<div class="nocov"><span class="num"><pre>264</pre></span><pre>                        msgs[key].append(msg)</pre></div>
<div class="nocov"><span class="num"><pre>265</pre></span><pre>                    else:</pre></div>
<div class="nocov"><span class="num"><pre>266</pre></span><pre>                        msgs[key] = [msgs[key], msg]</pre></div>
<div class="nocov"><span class="num"><pre>267</pre></span><pre>                else:</pre></div>
<div class="nocov"><span class="num"><pre>268</pre></span><pre>                    msgs[key] = msg</pre></div>
<div class="nocov"><span class="num"><pre>269</pre></span><pre>        return msgs</pre></div>
<div class="skip"><span class="num"><pre>270</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>271</pre></span><pre>    def subvalidators(self):</pre></div>
<div class="nocov"><span class="num"><pre>272</pre></span><pre>        &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>273</pre></span><pre>        Return any validators that this validator contains.  This is</pre></div>
<div class="nocov"><span class="num"><pre>274</pre></span><pre>        not useful for functional, except to inspect what values are</pre></div>
<div class="nocov"><span class="num"><pre>275</pre></span><pre>        available.  Specifically the ``.all_messages()`` method uses</pre></div>
<div class="nocov"><span class="num"><pre>276</pre></span><pre>        this to accumulate all possible messages.</pre></div>
<div class="nocov"><span class="num"><pre>277</pre></span><pre>        &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>278</pre></span><pre>        return []</pre></div>
<div class="skip"><span class="num"><pre>279</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>280</pre></span><pre>    #@classmethod</pre></div>
<div class="nocov"><span class="num"><pre>281</pre></span><pre>    def _initialize_docstring(cls):</pre></div>
<div class="nocov"><span class="num"><pre>282</pre></span><pre>        &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>283</pre></span><pre>        This changes the class's docstring to include information</pre></div>
<div class="nocov"><span class="num"><pre>284</pre></span><pre>        about all the messages this validator uses.</pre></div>
<div class="nocov"><span class="num"><pre>285</pre></span><pre>        &quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>286</pre></span><pre>        doc = cls.__doc__ or ''</pre></div>
<div class="cov"><span class="num"><pre>287</pre></span><pre>        doc = [textwrap.dedent(doc).rstrip()]</pre></div>
<div class="cov"><span class="num"><pre>288</pre></span><pre>        messages = cls._messages.items()</pre></div>
<div class="cov"><span class="num"><pre>289</pre></span><pre>        messages.sort()</pre></div>
<div class="cov"><span class="num"><pre>290</pre></span><pre>        doc.append('\n\n**Messages**\n\n')</pre></div>
<div class="cov"><span class="num"><pre>291</pre></span><pre>        for name, default in messages:</pre></div>
<div class="cov"><span class="num"><pre>292</pre></span><pre>            default = re.sub(r'(%\(.*?\)[rsifcx])', r'``\1``', default)</pre></div>
<div class="cov"><span class="num"><pre>293</pre></span><pre>            doc.append('``'+name+'``:\n')</pre></div>
<div class="cov"><span class="num"><pre>294</pre></span><pre>            doc.append('  '+default+'\n\n')</pre></div>
<div class="cov"><span class="num"><pre>295</pre></span><pre>        cls.__doc__ = ''.join(doc)</pre></div>
<div class="nocov"><span class="num"><pre>296</pre></span><pre>    _initialize_docstring = classmethod(_initialize_docstring)</pre></div>
<div class="skip"><span class="num"><pre>297</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>298</pre></span><pre>class _Identity(Validator):</pre></div>
<div class="nocov"><span class="num"><pre>299</pre></span><pre>    def __repr__(self):</pre></div>
<div class="nocov"><span class="num"><pre>300</pre></span><pre>        return 'validators.Identity'</pre></div>
<div class="nocov"><span class="num"><pre>301</pre></span><pre>Identity = _Identity()</pre></div>
<div class="skip"><span class="num"><pre>302</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>303</pre></span><pre>class FancyValidator(Validator):</pre></div>
<div class="skip"><span class="num"><pre>304</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>305</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>306</pre></span><pre>    FancyValidator is the (abstract) superclass for various validators</pre></div>
<div class="nocov"><span class="num"><pre>307</pre></span><pre>    and converters.  A subclass can validate, convert, or do both.</pre></div>
<div class="nocov"><span class="num"><pre>308</pre></span><pre>    There is no formal distinction made here.</pre></div>
<div class="skip"><span class="num"><pre>309</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>310</pre></span><pre>    Validators have two important external methods:</pre></div>
<div class="skip"><span class="num"><pre>311</pre></span><pre>    </pre></div>
<div class="nocov"><span class="num"><pre>312</pre></span><pre>    * .to_python(value, state):</pre></div>
<div class="nocov"><span class="num"><pre>313</pre></span><pre>      Attempts to convert the value.  If there is a problem, or the</pre></div>
<div class="nocov"><span class="num"><pre>314</pre></span><pre>      value is not valid, an Invalid exception is raised.  The</pre></div>
<div class="nocov"><span class="num"><pre>315</pre></span><pre>      argument for this exception is the (potentially HTML-formatted)</pre></div>
<div class="nocov"><span class="num"><pre>316</pre></span><pre>      error message to give the user.</pre></div>
<div class="skip"><span class="num"><pre>317</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>318</pre></span><pre>    * .from_python(value, state):</pre></div>
<div class="nocov"><span class="num"><pre>319</pre></span><pre>      Reverses to_python.</pre></div>
<div class="skip"><span class="num"><pre>320</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>321</pre></span><pre>    There are five important methods for subclasses to override,</pre></div>
<div class="nocov"><span class="num"><pre>322</pre></span><pre>    however none of these *have* to be overridden, only the ones that</pre></div>
<div class="nocov"><span class="num"><pre>323</pre></span><pre>    are appropriate for the validator:</pre></div>
<div class="skip"><span class="num"><pre>324</pre></span><pre>    </pre></div>
<div class="nocov"><span class="num"><pre>325</pre></span><pre>    * __init__():</pre></div>
<div class="nocov"><span class="num"><pre>326</pre></span><pre>      if the `declarative.Declarative` model doesn't work for this.</pre></div>
<div class="skip"><span class="num"><pre>327</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>328</pre></span><pre>    * .validate_python(value, state):</pre></div>
<div class="nocov"><span class="num"><pre>329</pre></span><pre>      This should raise an error if necessary.  The value is a Python</pre></div>
<div class="nocov"><span class="num"><pre>330</pre></span><pre>      object, either the result of to_python, or the input to</pre></div>
<div class="nocov"><span class="num"><pre>331</pre></span><pre>      from_python.</pre></div>
<div class="skip"><span class="num"><pre>332</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>333</pre></span><pre>    * .validate_other(value, state):</pre></div>
<div class="nocov"><span class="num"><pre>334</pre></span><pre>      Validates the source, before to_python, or after from_python.</pre></div>
<div class="nocov"><span class="num"><pre>335</pre></span><pre>      It's more common to use `.validate_python()` however.</pre></div>
<div class="skip"><span class="num"><pre>336</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>337</pre></span><pre>    * ._to_python(value, state):</pre></div>
<div class="nocov"><span class="num"><pre>338</pre></span><pre>      This returns the converted value, or raises an Invalid</pre></div>
<div class="nocov"><span class="num"><pre>339</pre></span><pre>      exception if there is an error.  The argument to this exception</pre></div>
<div class="nocov"><span class="num"><pre>340</pre></span><pre>      should be the error message.</pre></div>
<div class="skip"><span class="num"><pre>341</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>342</pre></span><pre>    * ._from_python(value, state):</pre></div>
<div class="nocov"><span class="num"><pre>343</pre></span><pre>      Should undo .to_python() in some reasonable way, returning</pre></div>
<div class="nocov"><span class="num"><pre>344</pre></span><pre>      a string.</pre></div>
<div class="skip"><span class="num"><pre>345</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>346</pre></span><pre>    Validators should have no internal state besides the</pre></div>
<div class="nocov"><span class="num"><pre>347</pre></span><pre>    values given at instantiation.  They should be reusable and</pre></div>
<div class="nocov"><span class="num"><pre>348</pre></span><pre>    reentrant.</pre></div>
<div class="skip"><span class="num"><pre>349</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>350</pre></span><pre>    All subclasses can take the arguments/instance variables:</pre></div>
<div class="skip"><span class="num"><pre>351</pre></span><pre>    </pre></div>
<div class="nocov"><span class="num"><pre>352</pre></span><pre>    * if_empty:</pre></div>
<div class="nocov"><span class="num"><pre>353</pre></span><pre>      If set, then this value will be returned if the input evaluates</pre></div>
<div class="nocov"><span class="num"><pre>354</pre></span><pre>      to false (empty list, empty string, None, etc), but not the 0 or</pre></div>
<div class="nocov"><span class="num"><pre>355</pre></span><pre>      False objects.  This only applies to ``.to_python()``.</pre></div>
<div class="skip"><span class="num"><pre>356</pre></span><pre>      </pre></div>
<div class="nocov"><span class="num"><pre>357</pre></span><pre>    * not_empty:</pre></div>
<div class="nocov"><span class="num"><pre>358</pre></span><pre>      If true, then if an empty value is given raise an error.</pre></div>
<div class="nocov"><span class="num"><pre>359</pre></span><pre>      (Both with ``.to_python()`` and also ``.from_python()``</pre></div>
<div class="nocov"><span class="num"><pre>360</pre></span><pre>      if ``.validate_python`` is true).</pre></div>
<div class="skip"><span class="num"><pre>361</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>362</pre></span><pre>    * strip:</pre></div>
<div class="nocov"><span class="num"><pre>363</pre></span><pre>      If true and the input is a string, strip it (occurs before empty</pre></div>
<div class="nocov"><span class="num"><pre>364</pre></span><pre>      tests).</pre></div>
<div class="skip"><span class="num"><pre>365</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>366</pre></span><pre>    * if_invalid:</pre></div>
<div class="nocov"><span class="num"><pre>367</pre></span><pre>      If set, then when this validator would raise Invalid during</pre></div>
<div class="nocov"><span class="num"><pre>368</pre></span><pre>      ``.to_python()``, instead return this value.</pre></div>
<div class="skip"><span class="num"><pre>369</pre></span><pre>      </pre></div>
<div class="nocov"><span class="num"><pre>370</pre></span><pre>    * if_invalid_python:</pre></div>
<div class="nocov"><span class="num"><pre>371</pre></span><pre>      If set, when the Python value (converted with</pre></div>
<div class="nocov"><span class="num"><pre>372</pre></span><pre>      ``.from_python()``) is invalid, this value will be returned.</pre></div>
<div class="skip"><span class="num"><pre>373</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>374</pre></span><pre>    * accept_python:</pre></div>
<div class="nocov"><span class="num"><pre>375</pre></span><pre>      If True (the default), then ``.validate_python()`` and</pre></div>
<div class="nocov"><span class="num"><pre>376</pre></span><pre>      ``.validate_other()`` will not be called when</pre></div>
<div class="nocov"><span class="num"><pre>377</pre></span><pre>      ``.from_python()`` is used.</pre></div>
<div class="nocov"><span class="num"><pre>378</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>379</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>380</pre></span><pre>    if_invalid = NoDefault</pre></div>
<div class="nocov"><span class="num"><pre>381</pre></span><pre>    if_invalid_python = NoDefault</pre></div>
<div class="nocov"><span class="num"><pre>382</pre></span><pre>    if_empty = NoDefault</pre></div>
<div class="nocov"><span class="num"><pre>383</pre></span><pre>    not_empty = False</pre></div>
<div class="nocov"><span class="num"><pre>384</pre></span><pre>    accept_python = True</pre></div>
<div class="nocov"><span class="num"><pre>385</pre></span><pre>    strip = False</pre></div>
<div class="skip"><span class="num"><pre>386</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>387</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre>388</pre></span><pre>        'empty': _(&quot;Please enter a value&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>389</pre></span><pre>        'badType': _(&quot;The input must be a string (not a %(type)s: %(value)r)&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>390</pre></span><pre>        'noneType': _(&quot;The input must be a string (not None)&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>391</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre>392</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>393</pre></span><pre>    def to_python(self, value, state=None):</pre></div>
<div class="cov"><span class="num"><pre>394</pre></span><pre>        try:</pre></div>
<div class="cov"><span class="num"><pre>395</pre></span><pre>            if self.strip and isinstance(value, (str, unicode)):</pre></div>
<div class="nocov"><span class="num"><pre>396</pre></span><pre>                value = value.strip()</pre></div>
<div class="cov"><span class="num"><pre>397</pre></span><pre>            elif hasattr(value, 'mixed'):</pre></div>
<div class="skip"><span class="num"><pre>398</pre></span><pre>                # Support Paste's MultiDict</pre></div>
<div class="nocov"><span class="num"><pre>399</pre></span><pre>                value = value.mixed()</pre></div>
<div class="cov"><span class="num"><pre>400</pre></span><pre>            if self.is_empty(value):</pre></div>
<div class="cov"><span class="num"><pre>401</pre></span><pre>                if self.not_empty:</pre></div>
<div class="cov"><span class="num"><pre>402</pre></span><pre>                    raise Invalid(self.message('empty', state), value, state)</pre></div>
<div class="cov"><span class="num"><pre>403</pre></span><pre>                else:</pre></div>
<div class="cov"><span class="num"><pre>404</pre></span><pre>                    if self.if_empty is not NoDefault:</pre></div>
<div class="nocov"><span class="num"><pre>405</pre></span><pre>                        return self.if_empty</pre></div>
<div class="cov"><span class="num"><pre>406</pre></span><pre>                    else:</pre></div>
<div class="cov"><span class="num"><pre>407</pre></span><pre>                        return self.empty_value(value)</pre></div>
<div class="cov"><span class="num"><pre>408</pre></span><pre>            vo = self.validate_other</pre></div>
<div class="cov"><span class="num"><pre>409</pre></span><pre>            if vo and vo is not self._validate_noop:</pre></div>
<div class="cov"><span class="num"><pre>410</pre></span><pre>                vo(value, state)</pre></div>
<div class="cov"><span class="num"><pre>411</pre></span><pre>            tp = self._to_python</pre></div>
<div class="cov"><span class="num"><pre>412</pre></span><pre>            if tp:</pre></div>
<div class="cov"><span class="num"><pre>413</pre></span><pre>                value = tp(value, state)</pre></div>
<div class="cov"><span class="num"><pre>414</pre></span><pre>            vp = self.validate_python</pre></div>
<div class="cov"><span class="num"><pre>415</pre></span><pre>            if vp and vp is not self._validate_noop:</pre></div>
<div class="cov"><span class="num"><pre>416</pre></span><pre>                vp(value, state)</pre></div>
<div class="cov"><span class="num"><pre>417</pre></span><pre>            return value</pre></div>
<div class="cov"><span class="num"><pre>418</pre></span><pre>        except Invalid:</pre></div>
<div class="cov"><span class="num"><pre>419</pre></span><pre>            if self.if_invalid is NoDefault:</pre></div>
<div class="cov"><span class="num"><pre>420</pre></span><pre>                raise</pre></div>
<div class="nocov"><span class="num"><pre>421</pre></span><pre>            else:</pre></div>
<div class="nocov"><span class="num"><pre>422</pre></span><pre>                return self.if_invalid</pre></div>
<div class="skip"><span class="num"><pre>423</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>424</pre></span><pre>    def from_python(self, value, state=None):</pre></div>
<div class="cov"><span class="num"><pre>425</pre></span><pre>        try:</pre></div>
<div class="cov"><span class="num"><pre>426</pre></span><pre>            if self.strip and isinstance(value, (str, unicode)):</pre></div>
<div class="nocov"><span class="num"><pre>427</pre></span><pre>                value = value.strip()</pre></div>
<div class="cov"><span class="num"><pre>428</pre></span><pre>            if not self.accept_python:</pre></div>
<div class="cov"><span class="num"><pre>429</pre></span><pre>                if self.is_empty(value):</pre></div>
<div class="nocov"><span class="num"><pre>430</pre></span><pre>                    if self.not_empty:</pre></div>
<div class="nocov"><span class="num"><pre>431</pre></span><pre>                        raise Invalid(self.message('empty', state),</pre></div>
<div class="nocov"><span class="num"><pre>432</pre></span><pre>                                      value, state)</pre></div>
<div class="nocov"><span class="num"><pre>433</pre></span><pre>                    else:</pre></div>
<div class="nocov"><span class="num"><pre>434</pre></span><pre>                        return self.empty_value(value)</pre></div>
<div class="cov"><span class="num"><pre>435</pre></span><pre>                vp = self.validate_python</pre></div>
<div class="cov"><span class="num"><pre>436</pre></span><pre>                if vp and vp is not self._validate_noop:</pre></div>
<div class="cov"><span class="num"><pre>437</pre></span><pre>                    vp(value, state)</pre></div>
<div class="cov"><span class="num"><pre>438</pre></span><pre>                fp = self._from_python</pre></div>
<div class="cov"><span class="num"><pre>439</pre></span><pre>                if fp:</pre></div>
<div class="cov"><span class="num"><pre>440</pre></span><pre>                    value = fp(value, state)</pre></div>
<div class="cov"><span class="num"><pre>441</pre></span><pre>                vo = self.validate_other</pre></div>
<div class="cov"><span class="num"><pre>442</pre></span><pre>                if vo and vo is not self._validate_noop:</pre></div>
<div class="cov"><span class="num"><pre>443</pre></span><pre>                    vo(value, state)</pre></div>
<div class="cov"><span class="num"><pre>444</pre></span><pre>                return value</pre></div>
<div class="cov"><span class="num"><pre>445</pre></span><pre>            else:</pre></div>
<div class="cov"><span class="num"><pre>446</pre></span><pre>                if self.is_empty(value):</pre></div>
<div class="cov"><span class="num"><pre>447</pre></span><pre>                    return self.empty_value(value)</pre></div>
<div class="cov"><span class="num"><pre>448</pre></span><pre>                fp = self._from_python</pre></div>
<div class="cov"><span class="num"><pre>449</pre></span><pre>                if fp:</pre></div>
<div class="cov"><span class="num"><pre>450</pre></span><pre>                    value = self._from_python(value, state)</pre></div>
<div class="cov"><span class="num"><pre>451</pre></span><pre>                return value</pre></div>
<div class="nocov"><span class="num"><pre>452</pre></span><pre>        except Invalid:</pre></div>
<div class="nocov"><span class="num"><pre>453</pre></span><pre>            if self.if_invalid_python is NoDefault:</pre></div>
<div class="nocov"><span class="num"><pre>454</pre></span><pre>                raise</pre></div>
<div class="nocov"><span class="num"><pre>455</pre></span><pre>            else:</pre></div>
<div class="nocov"><span class="num"><pre>456</pre></span><pre>                return self.if_invalid_python</pre></div>
<div class="skip"><span class="num"><pre>457</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>458</pre></span><pre>    def is_empty(self, value):</pre></div>
<div class="skip"><span class="num"><pre>459</pre></span><pre>        # None and '' are &quot;empty&quot;</pre></div>
<div class="cov"><span class="num"><pre>460</pre></span><pre>        return value is None or value == '' or (</pre></div>
<div class="cov"><span class="num"><pre>461</pre></span><pre>            isinstance(value, (list, tuple, dict)) and not value)</pre></div>
<div class="skip"><span class="num"><pre>462</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>463</pre></span><pre>    def empty_value(self, value):</pre></div>
<div class="nocov"><span class="num"><pre>464</pre></span><pre>        return None</pre></div>
<div class="skip"><span class="num"><pre>465</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>466</pre></span><pre>    def assert_string(self, value, state):</pre></div>
<div class="cov"><span class="num"><pre>467</pre></span><pre>        if not isinstance(value, (str, unicode)):</pre></div>
<div class="nocov"><span class="num"><pre>468</pre></span><pre>            raise Invalid(self.message('badType', state,</pre></div>
<div class="nocov"><span class="num"><pre>469</pre></span><pre>                                       type=type(value), value=value),</pre></div>
<div class="nocov"><span class="num"><pre>470</pre></span><pre>                          value, state)</pre></div>
<div class="skip"><span class="num"><pre>471</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>472</pre></span><pre>    def base64encode(self, value):</pre></div>
<div class="nocov"><span class="num"><pre>473</pre></span><pre>        &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>474</pre></span><pre>        Encode a string in base64, stripping whitespace and removing</pre></div>
<div class="nocov"><span class="num"><pre>475</pre></span><pre>        newlines.</pre></div>
<div class="nocov"><span class="num"><pre>476</pre></span><pre>        &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>477</pre></span><pre>        return value.encode('base64').strip().replace('\n', '')</pre></div>
<div class="skip"><span class="num"><pre>478</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>479</pre></span><pre>    def _validate_noop(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre>480</pre></span><pre>        &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>481</pre></span><pre>        A validation method that doesn't do anything.</pre></div>
<div class="nocov"><span class="num"><pre>482</pre></span><pre>        &quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>483</pre></span><pre>        pass</pre></div>
<div class="skip"><span class="num"><pre>484</pre></span><pre>    </pre></div>
<div class="nocov"><span class="num"><pre>485</pre></span><pre>    validate_python = validate_other = _validate_noop</pre></div>
<div class="nocov"><span class="num"><pre>486</pre></span><pre>    _to_python = None</pre></div>
<div class="nocov"><span class="num"><pre>487</pre></span><pre>    _from_python = None</pre></div>
<div class="skip"><span class="num"><pre>488</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>489</pre></span><pre></pre></div>
</div>
</body>
</html>
