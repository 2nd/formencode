<html>
<head>
<title>formencode.validators</title>
</head>
<body>
formencode.validators
<style>
.coverage pre {float: left; margin: 0px 1em; border: none;
               padding: 0px; }
.num pre { margin: 0px }
.nocov, .nocov pre {background-color: #faa}
.cov, .cov pre {background-color: #cfc}
div.coverage div { clear: both; height: 1.1em}
</style>
<div class="stats">
Covered: 299 lines<br/>
Missed: 2195 lines<br/>
Skipped 499 lines<br/>
Percent: 11 %<br/>

</div>
<div class="coverage">
<div class="skip"><span class="num"><pre>   1</pre></span><pre>## FormEncode, a  Form processor</pre></div>
<div class="skip"><span class="num"><pre>   2</pre></span><pre>## Copyright (C) 2003, Ian Bicking &lt;ianb@colorstudy.com&gt;</pre></div>
<div class="nocov"><span class="num"><pre>   3</pre></span><pre>&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>   4</pre></span><pre>Validator/Converters for use with FormEncode.</pre></div>
<div class="nocov"><span class="num"><pre>   5</pre></span><pre>&quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>   6</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>   7</pre></span><pre>import locale</pre></div>
<div class="nocov"><span class="num"><pre>   8</pre></span><pre>import warnings</pre></div>
<div class="nocov"><span class="num"><pre>   9</pre></span><pre>import re</pre></div>
<div class="nocov"><span class="num"><pre>  10</pre></span><pre>DateTime = None</pre></div>
<div class="nocov"><span class="num"><pre>  11</pre></span><pre>httplib = None</pre></div>
<div class="nocov"><span class="num"><pre>  12</pre></span><pre>urlparse = None</pre></div>
<div class="nocov"><span class="num"><pre>  13</pre></span><pre>import socket</pre></div>
<div class="nocov"><span class="num"><pre>  14</pre></span><pre>from interfaces import *</pre></div>
<div class="nocov"><span class="num"><pre>  15</pre></span><pre>from api import *</pre></div>
<div class="nocov"><span class="num"><pre>  16</pre></span><pre>sha1 = random = None</pre></div>
<div class="skip"><span class="num"><pre>  17</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>  18</pre></span><pre>filters = warnings.filters[:]</pre></div>
<div class="nocov"><span class="num"><pre>  19</pre></span><pre>warnings.simplefilter('ignore', DeprecationWarning)</pre></div>
<div class="nocov"><span class="num"><pre>  20</pre></span><pre>import sets</pre></div>
<div class="nocov"><span class="num"><pre>  21</pre></span><pre>warnings.filters = filters</pre></div>
<div class="nocov"><span class="num"><pre>  22</pre></span><pre>try:</pre></div>
<div class="nocov"><span class="num"><pre>  23</pre></span><pre>    set</pre></div>
<div class="nocov"><span class="num"><pre>  24</pre></span><pre>except NameError:</pre></div>
<div class="nocov"><span class="num"><pre>  25</pre></span><pre>    set = sets.Set</pre></div>
<div class="skip"><span class="num"><pre>  26</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>  27</pre></span><pre>import cgi</pre></div>
<div class="skip"><span class="num"><pre>  28</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>  29</pre></span><pre>import fieldstorage</pre></div>
<div class="skip"><span class="num"><pre>  30</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>  31</pre></span><pre>try:</pre></div>
<div class="nocov"><span class="num"><pre>  32</pre></span><pre>    import DNS</pre></div>
<div class="nocov"><span class="num"><pre>  33</pre></span><pre>    DNS.DiscoverNameServers()</pre></div>
<div class="nocov"><span class="num"><pre>  34</pre></span><pre>    have_dns=True</pre></div>
<div class="nocov"><span class="num"><pre>  35</pre></span><pre>except ImportError:</pre></div>
<div class="nocov"><span class="num"><pre>  36</pre></span><pre>    have_dns=False</pre></div>
<div class="skip"><span class="num"><pre>  37</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>  38</pre></span><pre>True, False = (1==1), (0==1)</pre></div>
<div class="skip"><span class="num"><pre>  39</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>  40</pre></span><pre># dummy translation function, nothing is translated here.</pre></div>
<div class="skip"><span class="num"><pre>  41</pre></span><pre># Instead this is actually done in api.message.</pre></div>
<div class="skip"><span class="num"><pre>  42</pre></span><pre># The surrounding _(&quot;string&quot;) of the strings is only for extracting</pre></div>
<div class="skip"><span class="num"><pre>  43</pre></span><pre># the strings automatically</pre></div>
<div class="skip"><span class="num"><pre>  44</pre></span><pre># (Note: we can't use a def statement, because pygettext dislikes it)</pre></div>
<div class="nocov"><span class="num"><pre>  45</pre></span><pre>_ = lambda s: s</pre></div>
<div class="skip"><span class="num"><pre>  46</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>  47</pre></span><pre>############################################################</pre></div>
<div class="skip"><span class="num"><pre>  48</pre></span><pre>## Utility methods</pre></div>
<div class="skip"><span class="num"><pre>  49</pre></span><pre>############################################################</pre></div>
<div class="skip"><span class="num"><pre>  50</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>  51</pre></span><pre># These all deal with accepting both mxDateTime and datetime</pre></div>
<div class="skip"><span class="num"><pre>  52</pre></span><pre># modules and types</pre></div>
<div class="nocov"><span class="num"><pre>  53</pre></span><pre>datetime_module = None</pre></div>
<div class="nocov"><span class="num"><pre>  54</pre></span><pre>mxDateTime_module = None</pre></div>
<div class="skip"><span class="num"><pre>  55</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>  56</pre></span><pre>def import_datetime(module_type):</pre></div>
<div class="nocov"><span class="num"><pre>  57</pre></span><pre>    global datetime_module, mxDateTime_module</pre></div>
<div class="cov"><span class="num"><pre>  58</pre></span><pre>    if module_type is None:</pre></div>
<div class="cov"><span class="num"><pre>  59</pre></span><pre>        try:</pre></div>
<div class="cov"><span class="num"><pre>  60</pre></span><pre>            if datetime_module is None:</pre></div>
<div class="cov"><span class="num"><pre>  61</pre></span><pre>                import datetime as datetime_module</pre></div>
<div class="cov"><span class="num"><pre>  62</pre></span><pre>            return datetime_module</pre></div>
<div class="nocov"><span class="num"><pre>  63</pre></span><pre>        except ImportError:</pre></div>
<div class="nocov"><span class="num"><pre>  64</pre></span><pre>            if mxDateTime_module is None:</pre></div>
<div class="nocov"><span class="num"><pre>  65</pre></span><pre>                from mx import DateTime as mxDateTime_module</pre></div>
<div class="nocov"><span class="num"><pre>  66</pre></span><pre>            return mxDateTime_module</pre></div>
<div class="skip"><span class="num"><pre>  67</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>  68</pre></span><pre>    module_type = module_type.lower()</pre></div>
<div class="nocov"><span class="num"><pre>  69</pre></span><pre>    assert module_type in ('datetime', 'mxdatetime')</pre></div>
<div class="nocov"><span class="num"><pre>  70</pre></span><pre>    if module_type == 'datetime':</pre></div>
<div class="nocov"><span class="num"><pre>  71</pre></span><pre>        if datetime_module is None:</pre></div>
<div class="nocov"><span class="num"><pre>  72</pre></span><pre>            import datetime as datetime_module</pre></div>
<div class="nocov"><span class="num"><pre>  73</pre></span><pre>        return datetime_module</pre></div>
<div class="nocov"><span class="num"><pre>  74</pre></span><pre>    else:</pre></div>
<div class="nocov"><span class="num"><pre>  75</pre></span><pre>        if mxDateTime_module is None:</pre></div>
<div class="nocov"><span class="num"><pre>  76</pre></span><pre>            from mx import DateTime as mxDateTime_module</pre></div>
<div class="nocov"><span class="num"><pre>  77</pre></span><pre>        return mxDateTime_module</pre></div>
<div class="skip"><span class="num"><pre>  78</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>  79</pre></span><pre>def datetime_now(module):</pre></div>
<div class="cov"><span class="num"><pre>  80</pre></span><pre>    if module.__name__ == 'datetime':</pre></div>
<div class="cov"><span class="num"><pre>  81</pre></span><pre>        return module.datetime.now()</pre></div>
<div class="nocov"><span class="num"><pre>  82</pre></span><pre>    else:</pre></div>
<div class="nocov"><span class="num"><pre>  83</pre></span><pre>        return module.now()</pre></div>
<div class="skip"><span class="num"><pre>  84</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>  85</pre></span><pre>def datetime_makedate(module, year, month, day):</pre></div>
<div class="cov"><span class="num"><pre>  86</pre></span><pre>    if module.__name__ == 'datetime':</pre></div>
<div class="cov"><span class="num"><pre>  87</pre></span><pre>        return module.date(year, month, day)</pre></div>
<div class="nocov"><span class="num"><pre>  88</pre></span><pre>    else:</pre></div>
<div class="nocov"><span class="num"><pre>  89</pre></span><pre>        try:</pre></div>
<div class="nocov"><span class="num"><pre>  90</pre></span><pre>            return module.DateTime(year, month, day)</pre></div>
<div class="nocov"><span class="num"><pre>  91</pre></span><pre>        except module.RangeError, e:</pre></div>
<div class="nocov"><span class="num"><pre>  92</pre></span><pre>            raise ValueError(str(e))</pre></div>
<div class="skip"><span class="num"><pre>  93</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>  94</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>  95</pre></span><pre># TODO: Needs being extended to support mx.DateTime as well.</pre></div>
<div class="nocov"><span class="num"><pre>  96</pre></span><pre>def datetime_time(module):</pre></div>
<div class="nocov"><span class="num"><pre>  97</pre></span><pre>    if module.__name__ == 'datetime':</pre></div>
<div class="nocov"><span class="num"><pre>  98</pre></span><pre>        return module.time</pre></div>
<div class="skip"><span class="num"><pre>  99</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 100</pre></span><pre># TODO: Needs being extended to support mx.DateTime as well.</pre></div>
<div class="nocov"><span class="num"><pre> 101</pre></span><pre>def datetime_isotime(module):</pre></div>
<div class="nocov"><span class="num"><pre> 102</pre></span><pre>    if module.__name__ == 'datetime':</pre></div>
<div class="nocov"><span class="num"><pre> 103</pre></span><pre>        return module.time.isoformat</pre></div>
<div class="skip"><span class="num"><pre> 104</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 105</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 106</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 107</pre></span><pre>############################################################</pre></div>
<div class="skip"><span class="num"><pre> 108</pre></span><pre>## Wrapper Validators</pre></div>
<div class="skip"><span class="num"><pre> 109</pre></span><pre>############################################################</pre></div>
<div class="skip"><span class="num"><pre> 110</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 111</pre></span><pre>class ConfirmType(FancyValidator):</pre></div>
<div class="skip"><span class="num"><pre> 112</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 113</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 114</pre></span><pre>    Confirms that the input/output is of the proper type.</pre></div>
<div class="skip"><span class="num"><pre> 115</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 116</pre></span><pre>    Uses the parameters:</pre></div>
<div class="skip"><span class="num"><pre> 117</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 118</pre></span><pre>    subclass:</pre></div>
<div class="nocov"><span class="num"><pre> 119</pre></span><pre>        The class or a tuple of classes; the item must be an instance</pre></div>
<div class="nocov"><span class="num"><pre> 120</pre></span><pre>        of the class or a subclass.</pre></div>
<div class="nocov"><span class="num"><pre> 121</pre></span><pre>    type:</pre></div>
<div class="nocov"><span class="num"><pre> 122</pre></span><pre>        A type or tuple of types (or classes); the item must be of</pre></div>
<div class="nocov"><span class="num"><pre> 123</pre></span><pre>        the exact class or type.  Subclasses are not allowed.</pre></div>
<div class="skip"><span class="num"><pre> 124</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 125</pre></span><pre>    Examples::</pre></div>
<div class="skip"><span class="num"><pre> 126</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 127</pre></span><pre>        &gt;&gt;&gt; cint = ConfirmType(subclass=int)</pre></div>
<div class="nocov"><span class="num"><pre> 128</pre></span><pre>        &gt;&gt;&gt; cint.to_python(True)</pre></div>
<div class="nocov"><span class="num"><pre> 129</pre></span><pre>        True</pre></div>
<div class="nocov"><span class="num"><pre> 130</pre></span><pre>        &gt;&gt;&gt; cint.to_python('1')</pre></div>
<div class="nocov"><span class="num"><pre> 131</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 132</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre> 133</pre></span><pre>        Invalid: '1' is not a subclass of &lt;type 'int'&gt;</pre></div>
<div class="nocov"><span class="num"><pre> 134</pre></span><pre>        &gt;&gt;&gt; cintfloat = ConfirmType(subclass=(float, int))</pre></div>
<div class="nocov"><span class="num"><pre> 135</pre></span><pre>        &gt;&gt;&gt; cintfloat.to_python(1.0), cintfloat.from_python(1.0)</pre></div>
<div class="nocov"><span class="num"><pre> 136</pre></span><pre>        (1.0, 1.0)</pre></div>
<div class="nocov"><span class="num"><pre> 137</pre></span><pre>        &gt;&gt;&gt; cintfloat.to_python(1), cintfloat.from_python(1)</pre></div>
<div class="nocov"><span class="num"><pre> 138</pre></span><pre>        (1, 1)</pre></div>
<div class="nocov"><span class="num"><pre> 139</pre></span><pre>        &gt;&gt;&gt; cintfloat.to_python(None)</pre></div>
<div class="nocov"><span class="num"><pre> 140</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 141</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre> 142</pre></span><pre>        Invalid: None is not a subclass of one of the types &lt;type 'float'&gt;, &lt;type 'int'&gt;</pre></div>
<div class="nocov"><span class="num"><pre> 143</pre></span><pre>        &gt;&gt;&gt; cint2 = ConfirmType(type=int)</pre></div>
<div class="nocov"><span class="num"><pre> 144</pre></span><pre>        &gt;&gt;&gt; cint2(accept_python=False).from_python(True)</pre></div>
<div class="nocov"><span class="num"><pre> 145</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 146</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre> 147</pre></span><pre>        Invalid: True must be of the type &lt;type 'int'&gt;</pre></div>
<div class="nocov"><span class="num"><pre> 148</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre> 149</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 150</pre></span><pre>    subclass = None</pre></div>
<div class="nocov"><span class="num"><pre> 151</pre></span><pre>    type = None</pre></div>
<div class="skip"><span class="num"><pre> 152</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 153</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre> 154</pre></span><pre>        'subclass': _(&quot;%(object)r is not a subclass of %(subclass)s&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 155</pre></span><pre>        'inSubclass': _(&quot;%(object)r is not a subclass of one of the types %(subclassList)s&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 156</pre></span><pre>        'inType': _(&quot;%(object)r must be one of the types %(typeList)s&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 157</pre></span><pre>        'type': _(&quot;%(object)r must be of the type %(type)s&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 158</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre> 159</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 160</pre></span><pre>    def __init__(self, *args, **kw):</pre></div>
<div class="nocov"><span class="num"><pre> 161</pre></span><pre>        FancyValidator.__init__(self, *args, **kw)</pre></div>
<div class="nocov"><span class="num"><pre> 162</pre></span><pre>        if self.subclass:</pre></div>
<div class="nocov"><span class="num"><pre> 163</pre></span><pre>            if isinstance(self.subclass, list):</pre></div>
<div class="nocov"><span class="num"><pre> 164</pre></span><pre>                self.subclass = tuple(self.subclass)</pre></div>
<div class="nocov"><span class="num"><pre> 165</pre></span><pre>            elif not isinstance(self.subclass, tuple):</pre></div>
<div class="nocov"><span class="num"><pre> 166</pre></span><pre>                self.subclass = (self.subclass,)</pre></div>
<div class="nocov"><span class="num"><pre> 167</pre></span><pre>            self.validate_python = self.confirm_subclass</pre></div>
<div class="nocov"><span class="num"><pre> 168</pre></span><pre>        if self.type:</pre></div>
<div class="nocov"><span class="num"><pre> 169</pre></span><pre>            if isinstance(self.type, list):</pre></div>
<div class="nocov"><span class="num"><pre> 170</pre></span><pre>                self.type = tuple(self.type)</pre></div>
<div class="nocov"><span class="num"><pre> 171</pre></span><pre>            elif not isinstance(self.type, tuple):</pre></div>
<div class="nocov"><span class="num"><pre> 172</pre></span><pre>                self.type = (self.type,)</pre></div>
<div class="nocov"><span class="num"><pre> 173</pre></span><pre>            self.validate_python = self.confirm_type</pre></div>
<div class="skip"><span class="num"><pre> 174</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 175</pre></span><pre>    def confirm_subclass(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre> 176</pre></span><pre>        if not isinstance(value, self.subclass):</pre></div>
<div class="nocov"><span class="num"><pre> 177</pre></span><pre>            if len(self.subclass) == 1:</pre></div>
<div class="nocov"><span class="num"><pre> 178</pre></span><pre>                msg = self.message('subclass', state, object=value,</pre></div>
<div class="nocov"><span class="num"><pre> 179</pre></span><pre>                                   subclass=self.subclass[0])</pre></div>
<div class="nocov"><span class="num"><pre> 180</pre></span><pre>            else:</pre></div>
<div class="nocov"><span class="num"><pre> 181</pre></span><pre>                subclass_list = ', '.join(map(str, self.subclass))</pre></div>
<div class="nocov"><span class="num"><pre> 182</pre></span><pre>                msg = self.message('inSubclass', state, object=value,</pre></div>
<div class="nocov"><span class="num"><pre> 183</pre></span><pre>                                   subclassList=subclass_list)</pre></div>
<div class="nocov"><span class="num"><pre> 184</pre></span><pre>            raise Invalid(msg, value, state)</pre></div>
<div class="skip"><span class="num"><pre> 185</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 186</pre></span><pre>    def confirm_type(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre> 187</pre></span><pre>        for t in self.type:</pre></div>
<div class="nocov"><span class="num"><pre> 188</pre></span><pre>            if type(value) is t:</pre></div>
<div class="nocov"><span class="num"><pre> 189</pre></span><pre>                break</pre></div>
<div class="nocov"><span class="num"><pre> 190</pre></span><pre>        else:</pre></div>
<div class="nocov"><span class="num"><pre> 191</pre></span><pre>            if len(self.type) == 1:</pre></div>
<div class="nocov"><span class="num"><pre> 192</pre></span><pre>                msg = self.message('type', state, object=value,</pre></div>
<div class="nocov"><span class="num"><pre> 193</pre></span><pre>                                   type=self.type[0])</pre></div>
<div class="nocov"><span class="num"><pre> 194</pre></span><pre>            else:</pre></div>
<div class="nocov"><span class="num"><pre> 195</pre></span><pre>                msg = self.message('inType', state, object=value,</pre></div>
<div class="nocov"><span class="num"><pre> 196</pre></span><pre>                                   typeList=', '.join(map(str, self.type)))</pre></div>
<div class="nocov"><span class="num"><pre> 197</pre></span><pre>            raise Invalid(msg, value, state)</pre></div>
<div class="nocov"><span class="num"><pre> 198</pre></span><pre>        return value</pre></div>
<div class="skip"><span class="num"><pre> 199</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 200</pre></span><pre>    def is_empty(self, value):</pre></div>
<div class="nocov"><span class="num"><pre> 201</pre></span><pre>        return False</pre></div>
<div class="skip"><span class="num"><pre> 202</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 203</pre></span><pre>class Wrapper(FancyValidator):</pre></div>
<div class="skip"><span class="num"><pre> 204</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 205</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 206</pre></span><pre>    Used to convert functions to validator/converters.</pre></div>
<div class="skip"><span class="num"><pre> 207</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 208</pre></span><pre>    You can give a simple function for `to_python`, `from_python`,</pre></div>
<div class="nocov"><span class="num"><pre> 209</pre></span><pre>    `validate_python` or `validate_other`.  If that function raises an</pre></div>
<div class="nocov"><span class="num"><pre> 210</pre></span><pre>    exception, the value is considered invalid.  Whatever value the</pre></div>
<div class="nocov"><span class="num"><pre> 211</pre></span><pre>    function returns is considered the converted value.</pre></div>
<div class="skip"><span class="num"><pre> 212</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 213</pre></span><pre>    Unlike validators, the `state` argument is not used.  Functions</pre></div>
<div class="nocov"><span class="num"><pre> 214</pre></span><pre>    like `int` can be used here, that take a single argument.</pre></div>
<div class="skip"><span class="num"><pre> 215</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 216</pre></span><pre>    Examples::</pre></div>
<div class="skip"><span class="num"><pre> 217</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 218</pre></span><pre>        &gt;&gt;&gt; def downcase(v):</pre></div>
<div class="nocov"><span class="num"><pre> 219</pre></span><pre>        ...     return v.lower()</pre></div>
<div class="nocov"><span class="num"><pre> 220</pre></span><pre>        &gt;&gt;&gt; wrap = Wrapper(to_python=downcase)</pre></div>
<div class="nocov"><span class="num"><pre> 221</pre></span><pre>        &gt;&gt;&gt; wrap.to_python('This')</pre></div>
<div class="nocov"><span class="num"><pre> 222</pre></span><pre>        'this'</pre></div>
<div class="nocov"><span class="num"><pre> 223</pre></span><pre>        &gt;&gt;&gt; wrap.from_python('This')</pre></div>
<div class="nocov"><span class="num"><pre> 224</pre></span><pre>        'This'</pre></div>
<div class="nocov"><span class="num"><pre> 225</pre></span><pre>        &gt;&gt;&gt; wrap2 = Wrapper(from_python=downcase)</pre></div>
<div class="nocov"><span class="num"><pre> 226</pre></span><pre>        &gt;&gt;&gt; wrap2.from_python('This')</pre></div>
<div class="nocov"><span class="num"><pre> 227</pre></span><pre>        'this'</pre></div>
<div class="nocov"><span class="num"><pre> 228</pre></span><pre>        &gt;&gt;&gt; wrap2.from_python(1)</pre></div>
<div class="nocov"><span class="num"><pre> 229</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 230</pre></span><pre>          ...</pre></div>
<div class="nocov"><span class="num"><pre> 231</pre></span><pre>        Invalid: 'int' object has no attribute 'lower'</pre></div>
<div class="nocov"><span class="num"><pre> 232</pre></span><pre>        &gt;&gt;&gt; wrap3 = Wrapper(validate_python=int)</pre></div>
<div class="nocov"><span class="num"><pre> 233</pre></span><pre>        &gt;&gt;&gt; wrap3.to_python('1')</pre></div>
<div class="nocov"><span class="num"><pre> 234</pre></span><pre>        '1'</pre></div>
<div class="nocov"><span class="num"><pre> 235</pre></span><pre>        &gt;&gt;&gt; wrap3.to_python('a') # doctest: +ELLIPSIS</pre></div>
<div class="nocov"><span class="num"><pre> 236</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 237</pre></span><pre>          ...</pre></div>
<div class="nocov"><span class="num"><pre> 238</pre></span><pre>        Invalid: invalid literal for int()...</pre></div>
<div class="nocov"><span class="num"><pre> 239</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre> 240</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 241</pre></span><pre>    func_to_python = None</pre></div>
<div class="nocov"><span class="num"><pre> 242</pre></span><pre>    func_from_python = None</pre></div>
<div class="nocov"><span class="num"><pre> 243</pre></span><pre>    func_validate_python = None</pre></div>
<div class="nocov"><span class="num"><pre> 244</pre></span><pre>    func_validate_other = None</pre></div>
<div class="skip"><span class="num"><pre> 245</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 246</pre></span><pre>    def __init__(self, *args, **kw):</pre></div>
<div class="cov"><span class="num"><pre> 247</pre></span><pre>        for n in ['to_python', 'from_python', 'validate_python',</pre></div>
<div class="cov"><span class="num"><pre> 248</pre></span><pre>                  'validate_other']:</pre></div>
<div class="cov"><span class="num"><pre> 249</pre></span><pre>            if kw.has_key(n):</pre></div>
<div class="cov"><span class="num"><pre> 250</pre></span><pre>                kw['func_%s' % n] = kw[n]</pre></div>
<div class="cov"><span class="num"><pre> 251</pre></span><pre>                del kw[n]</pre></div>
<div class="cov"><span class="num"><pre> 252</pre></span><pre>        FancyValidator.__init__(self, *args, **kw)</pre></div>
<div class="cov"><span class="num"><pre> 253</pre></span><pre>        self._to_python = self.wrap(self.func_to_python)</pre></div>
<div class="cov"><span class="num"><pre> 254</pre></span><pre>        self._from_python = self.wrap(self.func_from_python)</pre></div>
<div class="cov"><span class="num"><pre> 255</pre></span><pre>        self.validate_python = self.wrap(self.func_validate_python)</pre></div>
<div class="cov"><span class="num"><pre> 256</pre></span><pre>        self.validate_other = self.wrap(self.func_validate_other)</pre></div>
<div class="skip"><span class="num"><pre> 257</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 258</pre></span><pre>    def wrap(self, func):</pre></div>
<div class="cov"><span class="num"><pre> 259</pre></span><pre>        if not func:</pre></div>
<div class="cov"><span class="num"><pre> 260</pre></span><pre>            return None</pre></div>
<div class="cov"><span class="num"><pre> 261</pre></span><pre>        def result(value, state, func=func):</pre></div>
<div class="nocov"><span class="num"><pre> 262</pre></span><pre>            try:</pre></div>
<div class="nocov"><span class="num"><pre> 263</pre></span><pre>                return func(value)</pre></div>
<div class="nocov"><span class="num"><pre> 264</pre></span><pre>            except Exception, e:</pre></div>
<div class="nocov"><span class="num"><pre> 265</pre></span><pre>                raise Invalid(str(e), {}, value, state)</pre></div>
<div class="cov"><span class="num"><pre> 266</pre></span><pre>        return result</pre></div>
<div class="skip"><span class="num"><pre> 267</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 268</pre></span><pre>class Constant(FancyValidator):</pre></div>
<div class="skip"><span class="num"><pre> 269</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 270</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 271</pre></span><pre>    This converter converts everything to the same thing.</pre></div>
<div class="skip"><span class="num"><pre> 272</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 273</pre></span><pre>    I.e., you pass in the constant value when initializing, then all</pre></div>
<div class="nocov"><span class="num"><pre> 274</pre></span><pre>    values get converted to that constant value.</pre></div>
<div class="skip"><span class="num"><pre> 275</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 276</pre></span><pre>    This is only really useful for funny situations, like::</pre></div>
<div class="skip"><span class="num"><pre> 277</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 278</pre></span><pre>      fromEmailValidator = ValidateAny(</pre></div>
<div class="nocov"><span class="num"><pre> 279</pre></span><pre>                               ValidEmailAddress(),</pre></div>
<div class="nocov"><span class="num"><pre> 280</pre></span><pre>                               Constant('unknown@localhost'))</pre></div>
<div class="skip"><span class="num"><pre> 281</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 282</pre></span><pre>    In this case, the if the email is not valid</pre></div>
<div class="nocov"><span class="num"><pre> 283</pre></span><pre>    ``'unknown@localhost'`` will be used instead.  Of course, you</pre></div>
<div class="nocov"><span class="num"><pre> 284</pre></span><pre>    could use ``if_invalid`` instead.</pre></div>
<div class="skip"><span class="num"><pre> 285</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 286</pre></span><pre>    Examples::</pre></div>
<div class="skip"><span class="num"><pre> 287</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 288</pre></span><pre>        &gt;&gt;&gt; Constant('X').to_python('y')</pre></div>
<div class="nocov"><span class="num"><pre> 289</pre></span><pre>        'X'</pre></div>
<div class="nocov"><span class="num"><pre> 290</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre> 291</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 292</pre></span><pre>    __unpackargs__ = ('value',)</pre></div>
<div class="skip"><span class="num"><pre> 293</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 294</pre></span><pre>    def _to_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre> 295</pre></span><pre>        return self.value</pre></div>
<div class="skip"><span class="num"><pre> 296</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 297</pre></span><pre>    _from_python = _to_python</pre></div>
<div class="skip"><span class="num"><pre> 298</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 299</pre></span><pre>############################################################</pre></div>
<div class="skip"><span class="num"><pre> 300</pre></span><pre>## Normal validators</pre></div>
<div class="skip"><span class="num"><pre> 301</pre></span><pre>############################################################</pre></div>
<div class="skip"><span class="num"><pre> 302</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 303</pre></span><pre>class MaxLength(FancyValidator):</pre></div>
<div class="skip"><span class="num"><pre> 304</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 305</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 306</pre></span><pre>    Invalid if the value is longer than `maxLength`.  Uses len(),</pre></div>
<div class="nocov"><span class="num"><pre> 307</pre></span><pre>    so it can work for strings, lists, or anything with length.</pre></div>
<div class="skip"><span class="num"><pre> 308</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 309</pre></span><pre>    Examples::</pre></div>
<div class="skip"><span class="num"><pre> 310</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 311</pre></span><pre>        &gt;&gt;&gt; max5 = MaxLength(5)</pre></div>
<div class="nocov"><span class="num"><pre> 312</pre></span><pre>        &gt;&gt;&gt; max5.to_python('12345')</pre></div>
<div class="nocov"><span class="num"><pre> 313</pre></span><pre>        '12345'</pre></div>
<div class="nocov"><span class="num"><pre> 314</pre></span><pre>        &gt;&gt;&gt; max5.from_python('12345')</pre></div>
<div class="nocov"><span class="num"><pre> 315</pre></span><pre>        '12345'</pre></div>
<div class="nocov"><span class="num"><pre> 316</pre></span><pre>        &gt;&gt;&gt; max5.to_python('123456')</pre></div>
<div class="nocov"><span class="num"><pre> 317</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 318</pre></span><pre>          ...</pre></div>
<div class="nocov"><span class="num"><pre> 319</pre></span><pre>        Invalid: Enter a value less than 5 characters long</pre></div>
<div class="nocov"><span class="num"><pre> 320</pre></span><pre>        &gt;&gt;&gt; max5(accept_python=False).from_python('123456')</pre></div>
<div class="nocov"><span class="num"><pre> 321</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 322</pre></span><pre>          ...</pre></div>
<div class="nocov"><span class="num"><pre> 323</pre></span><pre>        Invalid: Enter a value less than 5 characters long</pre></div>
<div class="nocov"><span class="num"><pre> 324</pre></span><pre>        &gt;&gt;&gt; max5.to_python([1, 2, 3])</pre></div>
<div class="nocov"><span class="num"><pre> 325</pre></span><pre>        [1, 2, 3]</pre></div>
<div class="nocov"><span class="num"><pre> 326</pre></span><pre>        &gt;&gt;&gt; max5.to_python([1, 2, 3, 4, 5, 6])</pre></div>
<div class="nocov"><span class="num"><pre> 327</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 328</pre></span><pre>          ...</pre></div>
<div class="nocov"><span class="num"><pre> 329</pre></span><pre>        Invalid: Enter a value less than 5 characters long</pre></div>
<div class="nocov"><span class="num"><pre> 330</pre></span><pre>        &gt;&gt;&gt; max5.to_python(5)</pre></div>
<div class="nocov"><span class="num"><pre> 331</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 332</pre></span><pre>          ...</pre></div>
<div class="nocov"><span class="num"><pre> 333</pre></span><pre>        Invalid: Invalid value (value with length expected)</pre></div>
<div class="nocov"><span class="num"><pre> 334</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre> 335</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 336</pre></span><pre>    __unpackargs__ = ('maxLength',)</pre></div>
<div class="nocov"><span class="num"><pre> 337</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre> 338</pre></span><pre>        'tooLong': _(&quot;Enter a value less than %(maxLength)i characters long&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 339</pre></span><pre>        'invalid': _(&quot;Invalid value (value with length expected)&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 340</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre> 341</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 342</pre></span><pre>    def validate_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre> 343</pre></span><pre>        try:</pre></div>
<div class="nocov"><span class="num"><pre> 344</pre></span><pre>            if value and \</pre></div>
<div class="nocov"><span class="num"><pre> 345</pre></span><pre>               len(value) &gt; self.maxLength:</pre></div>
<div class="nocov"><span class="num"><pre> 346</pre></span><pre>                raise Invalid(self.message('tooLong', state,</pre></div>
<div class="nocov"><span class="num"><pre> 347</pre></span><pre>                                           maxLength=self.maxLength),</pre></div>
<div class="nocov"><span class="num"><pre> 348</pre></span><pre>                              value, state)</pre></div>
<div class="nocov"><span class="num"><pre> 349</pre></span><pre>            else:</pre></div>
<div class="nocov"><span class="num"><pre> 350</pre></span><pre>                return None</pre></div>
<div class="nocov"><span class="num"><pre> 351</pre></span><pre>        except TypeError:</pre></div>
<div class="nocov"><span class="num"><pre> 352</pre></span><pre>            raise Invalid(self.message('invalid', state),</pre></div>
<div class="nocov"><span class="num"><pre> 353</pre></span><pre>                          value, state)</pre></div>
<div class="skip"><span class="num"><pre> 354</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 355</pre></span><pre>class MinLength(FancyValidator):</pre></div>
<div class="skip"><span class="num"><pre> 356</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 357</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 358</pre></span><pre>    Invalid if the value is shorter than `minlength`.  Uses len(), so</pre></div>
<div class="nocov"><span class="num"><pre> 359</pre></span><pre>    it can work for strings, lists, or anything with length.  Note</pre></div>
<div class="nocov"><span class="num"><pre> 360</pre></span><pre>    that you **must** use ``not_empty=True`` if you don't want to</pre></div>
<div class="nocov"><span class="num"><pre> 361</pre></span><pre>    accept empty values -- empty values are not tested for length.</pre></div>
<div class="skip"><span class="num"><pre> 362</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 363</pre></span><pre>    Examples::</pre></div>
<div class="skip"><span class="num"><pre> 364</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 365</pre></span><pre>        &gt;&gt;&gt; min5 = MinLength(5)</pre></div>
<div class="nocov"><span class="num"><pre> 366</pre></span><pre>        &gt;&gt;&gt; min5.to_python('12345')</pre></div>
<div class="nocov"><span class="num"><pre> 367</pre></span><pre>        '12345'</pre></div>
<div class="nocov"><span class="num"><pre> 368</pre></span><pre>        &gt;&gt;&gt; min5.from_python('12345')</pre></div>
<div class="nocov"><span class="num"><pre> 369</pre></span><pre>        '12345'</pre></div>
<div class="nocov"><span class="num"><pre> 370</pre></span><pre>        &gt;&gt;&gt; min5.to_python('1234')</pre></div>
<div class="nocov"><span class="num"><pre> 371</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 372</pre></span><pre>          ...</pre></div>
<div class="nocov"><span class="num"><pre> 373</pre></span><pre>        Invalid: Enter a value at least 5 characters long</pre></div>
<div class="nocov"><span class="num"><pre> 374</pre></span><pre>        &gt;&gt;&gt; min5(accept_python=False).from_python('1234')</pre></div>
<div class="nocov"><span class="num"><pre> 375</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 376</pre></span><pre>          ...</pre></div>
<div class="nocov"><span class="num"><pre> 377</pre></span><pre>        Invalid: Enter a value at least 5 characters long</pre></div>
<div class="nocov"><span class="num"><pre> 378</pre></span><pre>        &gt;&gt;&gt; min5.to_python([1, 2, 3, 4, 5])</pre></div>
<div class="nocov"><span class="num"><pre> 379</pre></span><pre>        [1, 2, 3, 4, 5]</pre></div>
<div class="nocov"><span class="num"><pre> 380</pre></span><pre>        &gt;&gt;&gt; min5.to_python([1, 2, 3])</pre></div>
<div class="nocov"><span class="num"><pre> 381</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 382</pre></span><pre>          ...</pre></div>
<div class="nocov"><span class="num"><pre> 383</pre></span><pre>        Invalid: Enter a value at least 5 characters long</pre></div>
<div class="nocov"><span class="num"><pre> 384</pre></span><pre>        &gt;&gt;&gt; min5.to_python(5)</pre></div>
<div class="nocov"><span class="num"><pre> 385</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 386</pre></span><pre>          ...</pre></div>
<div class="nocov"><span class="num"><pre> 387</pre></span><pre>        Invalid: Invalid value (value with length expected)</pre></div>
<div class="skip"><span class="num"><pre> 388</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 389</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre> 390</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 391</pre></span><pre>    __unpackargs__ = ('minLength',)</pre></div>
<div class="skip"><span class="num"><pre> 392</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 393</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre> 394</pre></span><pre>        'tooShort': _(&quot;Enter a value at least %(minLength)i characters long&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 395</pre></span><pre>        'invalid': _(&quot;Invalid value (value with length expected)&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 396</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre> 397</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 398</pre></span><pre>    def validate_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre> 399</pre></span><pre>        try:</pre></div>
<div class="nocov"><span class="num"><pre> 400</pre></span><pre>            if len(value) &lt; self.minLength:</pre></div>
<div class="nocov"><span class="num"><pre> 401</pre></span><pre>                raise Invalid(self.message('tooShort', state,</pre></div>
<div class="nocov"><span class="num"><pre> 402</pre></span><pre>                                           minLength=self.minLength),</pre></div>
<div class="nocov"><span class="num"><pre> 403</pre></span><pre>                              value, state)</pre></div>
<div class="nocov"><span class="num"><pre> 404</pre></span><pre>        except TypeError:</pre></div>
<div class="nocov"><span class="num"><pre> 405</pre></span><pre>            raise Invalid(self.message('invalid', state),</pre></div>
<div class="nocov"><span class="num"><pre> 406</pre></span><pre>                          value, state)</pre></div>
<div class="skip"><span class="num"><pre> 407</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 408</pre></span><pre>class NotEmpty(FancyValidator):</pre></div>
<div class="skip"><span class="num"><pre> 409</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 410</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 411</pre></span><pre>    Invalid if value is empty (empty string, empty list, etc).</pre></div>
<div class="skip"><span class="num"><pre> 412</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 413</pre></span><pre>    Generally for objects that Python considers false, except zero</pre></div>
<div class="nocov"><span class="num"><pre> 414</pre></span><pre>    which is not considered invalid.</pre></div>
<div class="skip"><span class="num"><pre> 415</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 416</pre></span><pre>    Examples::</pre></div>
<div class="skip"><span class="num"><pre> 417</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 418</pre></span><pre>        &gt;&gt;&gt; ne = NotEmpty(messages={'empty': 'enter something'})</pre></div>
<div class="nocov"><span class="num"><pre> 419</pre></span><pre>        &gt;&gt;&gt; ne.to_python('')</pre></div>
<div class="nocov"><span class="num"><pre> 420</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 421</pre></span><pre>          ...</pre></div>
<div class="nocov"><span class="num"><pre> 422</pre></span><pre>        Invalid: enter something</pre></div>
<div class="nocov"><span class="num"><pre> 423</pre></span><pre>        &gt;&gt;&gt; ne.to_python(0)</pre></div>
<div class="nocov"><span class="num"><pre> 424</pre></span><pre>        0</pre></div>
<div class="nocov"><span class="num"><pre> 425</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 426</pre></span><pre>    not_empty = True</pre></div>
<div class="skip"><span class="num"><pre> 427</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 428</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre> 429</pre></span><pre>        'empty': _(&quot;Please enter a value&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 430</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre> 431</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 432</pre></span><pre>    def validate_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre> 433</pre></span><pre>        if value == 0:</pre></div>
<div class="skip"><span class="num"><pre> 434</pre></span><pre>            # This isn't &quot;empty&quot; for this definition.</pre></div>
<div class="nocov"><span class="num"><pre> 435</pre></span><pre>            return value</pre></div>
<div class="nocov"><span class="num"><pre> 436</pre></span><pre>        if not value:</pre></div>
<div class="nocov"><span class="num"><pre> 437</pre></span><pre>            raise Invalid(self.message('empty', state),</pre></div>
<div class="nocov"><span class="num"><pre> 438</pre></span><pre>                          value, state)</pre></div>
<div class="skip"><span class="num"><pre> 439</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 440</pre></span><pre>class Empty(FancyValidator):</pre></div>
<div class="skip"><span class="num"><pre> 441</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 442</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 443</pre></span><pre>    Invalid unless the value is empty.  Use cleverly, if at all.</pre></div>
<div class="skip"><span class="num"><pre> 444</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 445</pre></span><pre>    Examples::</pre></div>
<div class="skip"><span class="num"><pre> 446</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 447</pre></span><pre>        &gt;&gt;&gt; Empty.to_python(0)</pre></div>
<div class="nocov"><span class="num"><pre> 448</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 449</pre></span><pre>          ...</pre></div>
<div class="nocov"><span class="num"><pre> 450</pre></span><pre>        Invalid: You cannot enter a value here</pre></div>
<div class="nocov"><span class="num"><pre> 451</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre> 452</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 453</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre> 454</pre></span><pre>        'notEmpty': _(&quot;You cannot enter a value here&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 455</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre> 456</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 457</pre></span><pre>    def validate_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre> 458</pre></span><pre>        if value or value == 0:</pre></div>
<div class="nocov"><span class="num"><pre> 459</pre></span><pre>            raise Invalid(self.message('notEmpty', state),</pre></div>
<div class="nocov"><span class="num"><pre> 460</pre></span><pre>                          value, state)</pre></div>
<div class="skip"><span class="num"><pre> 461</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 462</pre></span><pre>class Regex(FancyValidator):</pre></div>
<div class="skip"><span class="num"><pre> 463</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 464</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 465</pre></span><pre>    Invalid if the value doesn't match the regular expression `regex`.</pre></div>
<div class="skip"><span class="num"><pre> 466</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 467</pre></span><pre>    The regular expression can be a compiled re object, or a string</pre></div>
<div class="nocov"><span class="num"><pre> 468</pre></span><pre>    which will be compiled for you.</pre></div>
<div class="skip"><span class="num"><pre> 469</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 470</pre></span><pre>    Use strip=True if you want to strip the value before validation,</pre></div>
<div class="nocov"><span class="num"><pre> 471</pre></span><pre>    and as a form of conversion (often useful).</pre></div>
<div class="skip"><span class="num"><pre> 472</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 473</pre></span><pre>    Examples::</pre></div>
<div class="skip"><span class="num"><pre> 474</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 475</pre></span><pre>        &gt;&gt;&gt; cap = Regex(r'^[A-Z]+$')</pre></div>
<div class="nocov"><span class="num"><pre> 476</pre></span><pre>        &gt;&gt;&gt; cap.to_python('ABC')</pre></div>
<div class="nocov"><span class="num"><pre> 477</pre></span><pre>        'ABC'</pre></div>
<div class="skip"><span class="num"><pre> 478</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 479</pre></span><pre>    Note that ``.from_python()`` calls (in general) do not validate</pre></div>
<div class="nocov"><span class="num"><pre> 480</pre></span><pre>    the input::</pre></div>
<div class="skip"><span class="num"><pre> 481</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 482</pre></span><pre>        &gt;&gt;&gt; cap.from_python('abc')</pre></div>
<div class="nocov"><span class="num"><pre> 483</pre></span><pre>        'abc'</pre></div>
<div class="nocov"><span class="num"><pre> 484</pre></span><pre>        &gt;&gt;&gt; cap(accept_python=False).from_python('abc')</pre></div>
<div class="nocov"><span class="num"><pre> 485</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 486</pre></span><pre>          ...</pre></div>
<div class="nocov"><span class="num"><pre> 487</pre></span><pre>        Invalid: The input is not valid</pre></div>
<div class="nocov"><span class="num"><pre> 488</pre></span><pre>        &gt;&gt;&gt; cap.to_python(1)</pre></div>
<div class="nocov"><span class="num"><pre> 489</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 490</pre></span><pre>          ...</pre></div>
<div class="nocov"><span class="num"><pre> 491</pre></span><pre>        Invalid: The input must be a string (not a &lt;type 'int'&gt;: 1)</pre></div>
<div class="nocov"><span class="num"><pre> 492</pre></span><pre>        &gt;&gt;&gt; Regex(r'^[A-Z]+$', strip=True).to_python('  ABC  ')</pre></div>
<div class="nocov"><span class="num"><pre> 493</pre></span><pre>        'ABC'</pre></div>
<div class="nocov"><span class="num"><pre> 494</pre></span><pre>        &gt;&gt;&gt; Regex(r'this', regexOps=('I',)).to_python('THIS')</pre></div>
<div class="nocov"><span class="num"><pre> 495</pre></span><pre>        'THIS'</pre></div>
<div class="nocov"><span class="num"><pre> 496</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre> 497</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 498</pre></span><pre>    regexOps = ()</pre></div>
<div class="nocov"><span class="num"><pre> 499</pre></span><pre>    strip = False</pre></div>
<div class="nocov"><span class="num"><pre> 500</pre></span><pre>    regex = None</pre></div>
<div class="skip"><span class="num"><pre> 501</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 502</pre></span><pre>    __unpackargs__ = ('regex',)</pre></div>
<div class="skip"><span class="num"><pre> 503</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 504</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre> 505</pre></span><pre>        'invalid': _(&quot;The input is not valid&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 506</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre> 507</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 508</pre></span><pre>    def __init__(self, *args, **kw):</pre></div>
<div class="cov"><span class="num"><pre> 509</pre></span><pre>        FancyValidator.__init__(self, *args, **kw)</pre></div>
<div class="cov"><span class="num"><pre> 510</pre></span><pre>        if isinstance(self.regex, basestring):</pre></div>
<div class="cov"><span class="num"><pre> 511</pre></span><pre>            ops = 0</pre></div>
<div class="cov"><span class="num"><pre> 512</pre></span><pre>            assert not isinstance(self.regexOps, basestring), (</pre></div>
<div class="cov"><span class="num"><pre> 513</pre></span><pre>                &quot;regexOps should be a list of options from the re module &quot;</pre></div>
<div class="cov"><span class="num"><pre> 514</pre></span><pre>                &quot;(names, or actual values)&quot;)</pre></div>
<div class="cov"><span class="num"><pre> 515</pre></span><pre>            for op in self.regexOps:</pre></div>
<div class="nocov"><span class="num"><pre> 516</pre></span><pre>                if isinstance(op, basestring):</pre></div>
<div class="nocov"><span class="num"><pre> 517</pre></span><pre>                    ops |= getattr(re, op)</pre></div>
<div class="nocov"><span class="num"><pre> 518</pre></span><pre>                else:</pre></div>
<div class="nocov"><span class="num"><pre> 519</pre></span><pre>                    ops |= op</pre></div>
<div class="cov"><span class="num"><pre> 520</pre></span><pre>            self.regex = re.compile(self.regex, ops)</pre></div>
<div class="skip"><span class="num"><pre> 521</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 522</pre></span><pre>    def validate_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre> 523</pre></span><pre>        self.assert_string(value, state)</pre></div>
<div class="nocov"><span class="num"><pre> 524</pre></span><pre>        if self.strip and isinstance(value, basestring):</pre></div>
<div class="nocov"><span class="num"><pre> 525</pre></span><pre>            value = value.strip()</pre></div>
<div class="nocov"><span class="num"><pre> 526</pre></span><pre>        if not self.regex.search(value):</pre></div>
<div class="nocov"><span class="num"><pre> 527</pre></span><pre>            raise Invalid(self.message('invalid', state),</pre></div>
<div class="nocov"><span class="num"><pre> 528</pre></span><pre>                          value, state)</pre></div>
<div class="skip"><span class="num"><pre> 529</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 530</pre></span><pre>    def _to_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre> 531</pre></span><pre>        if self.strip and isinstance(value, basestring):</pre></div>
<div class="nocov"><span class="num"><pre> 532</pre></span><pre>            return value.strip()</pre></div>
<div class="nocov"><span class="num"><pre> 533</pre></span><pre>        return value</pre></div>
<div class="skip"><span class="num"><pre> 534</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 535</pre></span><pre>class PlainText(Regex):</pre></div>
<div class="skip"><span class="num"><pre> 536</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 537</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 538</pre></span><pre>    Test that the field contains only letters, numbers, underscore,</pre></div>
<div class="nocov"><span class="num"><pre> 539</pre></span><pre>    and the hyphen.  Subclasses Regex.</pre></div>
<div class="skip"><span class="num"><pre> 540</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 541</pre></span><pre>    Examples::</pre></div>
<div class="skip"><span class="num"><pre> 542</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 543</pre></span><pre>        &gt;&gt;&gt; PlainText.to_python('_this9_')</pre></div>
<div class="nocov"><span class="num"><pre> 544</pre></span><pre>        '_this9_'</pre></div>
<div class="nocov"><span class="num"><pre> 545</pre></span><pre>        &gt;&gt;&gt; PlainText.from_python('  this  ')</pre></div>
<div class="nocov"><span class="num"><pre> 546</pre></span><pre>        '  this  '</pre></div>
<div class="nocov"><span class="num"><pre> 547</pre></span><pre>        &gt;&gt;&gt; PlainText(accept_python=False).from_python('  this  ')</pre></div>
<div class="nocov"><span class="num"><pre> 548</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 549</pre></span><pre>          ...</pre></div>
<div class="nocov"><span class="num"><pre> 550</pre></span><pre>        Invalid: Enter only letters, numbers, or _ (underscore)</pre></div>
<div class="nocov"><span class="num"><pre> 551</pre></span><pre>        &gt;&gt;&gt; PlainText(strip=True).to_python('  this  ')</pre></div>
<div class="nocov"><span class="num"><pre> 552</pre></span><pre>        'this'</pre></div>
<div class="nocov"><span class="num"><pre> 553</pre></span><pre>        &gt;&gt;&gt; PlainText(strip=True).from_python('  this  ')</pre></div>
<div class="nocov"><span class="num"><pre> 554</pre></span><pre>        'this'</pre></div>
<div class="nocov"><span class="num"><pre> 555</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre> 556</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 557</pre></span><pre>    regex = r&quot;^[a-zA-Z_\-0-9]*$&quot;</pre></div>
<div class="skip"><span class="num"><pre> 558</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 559</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre> 560</pre></span><pre>        'invalid': _('Enter only letters, numbers, or _ (underscore)'),</pre></div>
<div class="nocov"><span class="num"><pre> 561</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre> 562</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 563</pre></span><pre>class OneOf(FancyValidator):</pre></div>
<div class="skip"><span class="num"><pre> 564</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 565</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 566</pre></span><pre>    Tests that the value is one of the members of a given list.</pre></div>
<div class="skip"><span class="num"><pre> 567</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 568</pre></span><pre>    If ``testValueList=True``, then if the input value is a list or</pre></div>
<div class="nocov"><span class="num"><pre> 569</pre></span><pre>    tuple, all the members of the sequence will be checked (i.e., the</pre></div>
<div class="nocov"><span class="num"><pre> 570</pre></span><pre>    input must be a subset of the allowed values).</pre></div>
<div class="skip"><span class="num"><pre> 571</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 572</pre></span><pre>    Use ``hideList=True`` to keep the list of valid values out of the</pre></div>
<div class="nocov"><span class="num"><pre> 573</pre></span><pre>    error message in exceptions.</pre></div>
<div class="skip"><span class="num"><pre> 574</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 575</pre></span><pre>    Examples::</pre></div>
<div class="skip"><span class="num"><pre> 576</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 577</pre></span><pre>        &gt;&gt;&gt; oneof = OneOf([1, 2, 3])</pre></div>
<div class="nocov"><span class="num"><pre> 578</pre></span><pre>        &gt;&gt;&gt; oneof.to_python(1)</pre></div>
<div class="nocov"><span class="num"><pre> 579</pre></span><pre>        1</pre></div>
<div class="nocov"><span class="num"><pre> 580</pre></span><pre>        &gt;&gt;&gt; oneof.to_python(4)</pre></div>
<div class="nocov"><span class="num"><pre> 581</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 582</pre></span><pre>          ...</pre></div>
<div class="nocov"><span class="num"><pre> 583</pre></span><pre>        Invalid: Value must be one of: 1; 2; 3 (not 4)</pre></div>
<div class="nocov"><span class="num"><pre> 584</pre></span><pre>        &gt;&gt;&gt; oneof(testValueList=True).to_python([2, 3, [1, 2, 3]])</pre></div>
<div class="nocov"><span class="num"><pre> 585</pre></span><pre>        [2, 3, [1, 2, 3]]</pre></div>
<div class="nocov"><span class="num"><pre> 586</pre></span><pre>        &gt;&gt;&gt; oneof.to_python([2, 3, [1, 2, 3]])</pre></div>
<div class="nocov"><span class="num"><pre> 587</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 588</pre></span><pre>          ...</pre></div>
<div class="nocov"><span class="num"><pre> 589</pre></span><pre>        Invalid: Value must be one of: 1; 2; 3 (not [2, 3, [1, 2, 3]])</pre></div>
<div class="nocov"><span class="num"><pre> 590</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre> 591</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 592</pre></span><pre>    list = None</pre></div>
<div class="nocov"><span class="num"><pre> 593</pre></span><pre>    testValueList = False</pre></div>
<div class="nocov"><span class="num"><pre> 594</pre></span><pre>    hideList = False</pre></div>
<div class="skip"><span class="num"><pre> 595</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 596</pre></span><pre>    __unpackargs__ = ('list',)</pre></div>
<div class="skip"><span class="num"><pre> 597</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 598</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre> 599</pre></span><pre>        'invalid': _(&quot;Invalid value&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 600</pre></span><pre>        'notIn': _(&quot;Value must be one of: %(items)s (not %(value)r)&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 601</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre> 602</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 603</pre></span><pre>    def validate_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre> 604</pre></span><pre>        if self.testValueList and isinstance(value, (list, tuple)):</pre></div>
<div class="nocov"><span class="num"><pre> 605</pre></span><pre>            for v in value:</pre></div>
<div class="nocov"><span class="num"><pre> 606</pre></span><pre>                self.validate_python(v, state)</pre></div>
<div class="nocov"><span class="num"><pre> 607</pre></span><pre>        else:</pre></div>
<div class="nocov"><span class="num"><pre> 608</pre></span><pre>            if not value in self.list:</pre></div>
<div class="nocov"><span class="num"><pre> 609</pre></span><pre>                if self.hideList:</pre></div>
<div class="nocov"><span class="num"><pre> 610</pre></span><pre>                    raise Invalid(self.message('invalid', state),</pre></div>
<div class="nocov"><span class="num"><pre> 611</pre></span><pre>                                  value, state)</pre></div>
<div class="nocov"><span class="num"><pre> 612</pre></span><pre>                else:</pre></div>
<div class="nocov"><span class="num"><pre> 613</pre></span><pre>                    items = '; '.join(map(str, self.list))</pre></div>
<div class="nocov"><span class="num"><pre> 614</pre></span><pre>                    raise Invalid(self.message('notIn', state,</pre></div>
<div class="nocov"><span class="num"><pre> 615</pre></span><pre>                                               items=items,</pre></div>
<div class="nocov"><span class="num"><pre> 616</pre></span><pre>                                               value=value),</pre></div>
<div class="nocov"><span class="num"><pre> 617</pre></span><pre>                                  value, state)</pre></div>
<div class="skip"><span class="num"><pre> 618</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 619</pre></span><pre>class DictConverter(FancyValidator):</pre></div>
<div class="skip"><span class="num"><pre> 620</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 621</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 622</pre></span><pre>    Converts values based on a dictionary which has values as keys for</pre></div>
<div class="nocov"><span class="num"><pre> 623</pre></span><pre>    the resultant values.</pre></div>
<div class="skip"><span class="num"><pre> 624</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 625</pre></span><pre>    If ``allowNull`` is passed, it will not balk if a false value</pre></div>
<div class="nocov"><span class="num"><pre> 626</pre></span><pre>    (e.g., '' or None) is given (it will return None in these cases).</pre></div>
<div class="skip"><span class="num"><pre> 627</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 628</pre></span><pre>    to_python takes keys and gives values, from_python takes values and</pre></div>
<div class="nocov"><span class="num"><pre> 629</pre></span><pre>    gives keys.</pre></div>
<div class="skip"><span class="num"><pre> 630</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 631</pre></span><pre>    If you give hideDict=True, then the contents of the dictionary</pre></div>
<div class="nocov"><span class="num"><pre> 632</pre></span><pre>    will not show up in error messages.</pre></div>
<div class="skip"><span class="num"><pre> 633</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 634</pre></span><pre>    Examples::</pre></div>
<div class="skip"><span class="num"><pre> 635</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 636</pre></span><pre>        &gt;&gt;&gt; dc = DictConverter({1: 'one', 2: 'two'})</pre></div>
<div class="nocov"><span class="num"><pre> 637</pre></span><pre>        &gt;&gt;&gt; dc.to_python(1)</pre></div>
<div class="nocov"><span class="num"><pre> 638</pre></span><pre>        'one'</pre></div>
<div class="nocov"><span class="num"><pre> 639</pre></span><pre>        &gt;&gt;&gt; dc.from_python('one')</pre></div>
<div class="nocov"><span class="num"><pre> 640</pre></span><pre>        1</pre></div>
<div class="nocov"><span class="num"><pre> 641</pre></span><pre>        &gt;&gt;&gt; dc.to_python(3)</pre></div>
<div class="nocov"><span class="num"><pre> 642</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 643</pre></span><pre>        Invalid: Enter a value from: 1; 2</pre></div>
<div class="nocov"><span class="num"><pre> 644</pre></span><pre>        &gt;&gt;&gt; dc2 = dc(hideDict=True)</pre></div>
<div class="nocov"><span class="num"><pre> 645</pre></span><pre>        &gt;&gt;&gt; dc2.hideDict</pre></div>
<div class="nocov"><span class="num"><pre> 646</pre></span><pre>        True</pre></div>
<div class="nocov"><span class="num"><pre> 647</pre></span><pre>        &gt;&gt;&gt; dc2.dict</pre></div>
<div class="nocov"><span class="num"><pre> 648</pre></span><pre>        {1: 'one', 2: 'two'}</pre></div>
<div class="nocov"><span class="num"><pre> 649</pre></span><pre>        &gt;&gt;&gt; dc2.to_python(3)</pre></div>
<div class="nocov"><span class="num"><pre> 650</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 651</pre></span><pre>        Invalid: Choose something</pre></div>
<div class="nocov"><span class="num"><pre> 652</pre></span><pre>        &gt;&gt;&gt; dc.from_python('three')</pre></div>
<div class="nocov"><span class="num"><pre> 653</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 654</pre></span><pre>        Invalid: Nothing in my dictionary goes by the value 'three'.  Choose one of: 'one'; 'two'</pre></div>
<div class="nocov"><span class="num"><pre> 655</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre> 656</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 657</pre></span><pre>    dict = None</pre></div>
<div class="nocov"><span class="num"><pre> 658</pre></span><pre>    hideDict = False</pre></div>
<div class="skip"><span class="num"><pre> 659</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 660</pre></span><pre>    __unpackargs__ = ('dict',)</pre></div>
<div class="skip"><span class="num"><pre> 661</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 662</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre> 663</pre></span><pre>        'keyNotFound': _(&quot;Choose something&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 664</pre></span><pre>        'chooseKey': _(&quot;Enter a value from: %(items)s&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 665</pre></span><pre>        'valueNotFound': _(&quot;That value is not known&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 666</pre></span><pre>        'chooseValue': _(&quot;Nothing in my dictionary goes by the value %(value)s.  Choose one of: %(items)s&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 667</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre> 668</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 669</pre></span><pre>    def _to_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre> 670</pre></span><pre>        try:</pre></div>
<div class="nocov"><span class="num"><pre> 671</pre></span><pre>            return self.dict[value]</pre></div>
<div class="nocov"><span class="num"><pre> 672</pre></span><pre>        except KeyError:</pre></div>
<div class="nocov"><span class="num"><pre> 673</pre></span><pre>            if self.hideDict:</pre></div>
<div class="nocov"><span class="num"><pre> 674</pre></span><pre>                raise Invalid(self.message('keyNotFound', state),</pre></div>
<div class="nocov"><span class="num"><pre> 675</pre></span><pre>                              value, state)</pre></div>
<div class="nocov"><span class="num"><pre> 676</pre></span><pre>            else:</pre></div>
<div class="nocov"><span class="num"><pre> 677</pre></span><pre>                items = '; '.join(map(repr, self.dict.keys()))</pre></div>
<div class="nocov"><span class="num"><pre> 678</pre></span><pre>                raise Invalid(self.message('chooseKey', state,</pre></div>
<div class="nocov"><span class="num"><pre> 679</pre></span><pre>                                           items=items),</pre></div>
<div class="nocov"><span class="num"><pre> 680</pre></span><pre>                              value, state)</pre></div>
<div class="skip"><span class="num"><pre> 681</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 682</pre></span><pre>    def _from_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre> 683</pre></span><pre>        for k, v in self.dict.items():</pre></div>
<div class="nocov"><span class="num"><pre> 684</pre></span><pre>            if value == v:</pre></div>
<div class="nocov"><span class="num"><pre> 685</pre></span><pre>                return k</pre></div>
<div class="nocov"><span class="num"><pre> 686</pre></span><pre>        if self.hideDict:</pre></div>
<div class="nocov"><span class="num"><pre> 687</pre></span><pre>            raise Invalid(self.message('valueNotFound', state),</pre></div>
<div class="nocov"><span class="num"><pre> 688</pre></span><pre>                          value, state)</pre></div>
<div class="nocov"><span class="num"><pre> 689</pre></span><pre>        else:</pre></div>
<div class="nocov"><span class="num"><pre> 690</pre></span><pre>            items = '; '.join(map(repr, self.dict.values()))</pre></div>
<div class="nocov"><span class="num"><pre> 691</pre></span><pre>            raise Invalid(self.message('chooseValue', state,</pre></div>
<div class="nocov"><span class="num"><pre> 692</pre></span><pre>                                       value=repr(value),</pre></div>
<div class="nocov"><span class="num"><pre> 693</pre></span><pre>                                       items=items),</pre></div>
<div class="nocov"><span class="num"><pre> 694</pre></span><pre>                          value, state)</pre></div>
<div class="skip"><span class="num"><pre> 695</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 696</pre></span><pre>class IndexListConverter(FancyValidator):</pre></div>
<div class="skip"><span class="num"><pre> 697</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 698</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 699</pre></span><pre>    Converts a index (which may be a string like '2') to the value in</pre></div>
<div class="nocov"><span class="num"><pre> 700</pre></span><pre>    the given list.</pre></div>
<div class="skip"><span class="num"><pre> 701</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 702</pre></span><pre>    Examples::</pre></div>
<div class="skip"><span class="num"><pre> 703</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 704</pre></span><pre>        &gt;&gt;&gt; index = IndexListConverter(['zero', 'one', 'two'])</pre></div>
<div class="nocov"><span class="num"><pre> 705</pre></span><pre>        &gt;&gt;&gt; index.to_python(0)</pre></div>
<div class="nocov"><span class="num"><pre> 706</pre></span><pre>        'zero'</pre></div>
<div class="nocov"><span class="num"><pre> 707</pre></span><pre>        &gt;&gt;&gt; index.from_python('zero')</pre></div>
<div class="nocov"><span class="num"><pre> 708</pre></span><pre>        0</pre></div>
<div class="nocov"><span class="num"><pre> 709</pre></span><pre>        &gt;&gt;&gt; index.to_python('1')</pre></div>
<div class="nocov"><span class="num"><pre> 710</pre></span><pre>        'one'</pre></div>
<div class="nocov"><span class="num"><pre> 711</pre></span><pre>        &gt;&gt;&gt; index.to_python(5)</pre></div>
<div class="nocov"><span class="num"><pre> 712</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 713</pre></span><pre>        Invalid: Index out of range</pre></div>
<div class="nocov"><span class="num"><pre> 714</pre></span><pre>        &gt;&gt;&gt; index(not_empty=True).to_python(None)</pre></div>
<div class="nocov"><span class="num"><pre> 715</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 716</pre></span><pre>        Invalid: Please enter a value</pre></div>
<div class="nocov"><span class="num"><pre> 717</pre></span><pre>        &gt;&gt;&gt; index.from_python('five')</pre></div>
<div class="nocov"><span class="num"><pre> 718</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 719</pre></span><pre>        Invalid: Item 'five' was not found in the list</pre></div>
<div class="nocov"><span class="num"><pre> 720</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre> 721</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 722</pre></span><pre>    list = None</pre></div>
<div class="skip"><span class="num"><pre> 723</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 724</pre></span><pre>    __unpackargs__ = ('list',)</pre></div>
<div class="skip"><span class="num"><pre> 725</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 726</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre> 727</pre></span><pre>        'integer': _(&quot;Must be an integer index&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 728</pre></span><pre>        'outOfRange': _(&quot;Index out of range&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 729</pre></span><pre>        'notFound': _(&quot;Item %(value)s was not found in the list&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 730</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre> 731</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 732</pre></span><pre>    def _to_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre> 733</pre></span><pre>        try:</pre></div>
<div class="nocov"><span class="num"><pre> 734</pre></span><pre>            value = int(value)</pre></div>
<div class="nocov"><span class="num"><pre> 735</pre></span><pre>        except (ValueError, TypeError):</pre></div>
<div class="nocov"><span class="num"><pre> 736</pre></span><pre>            raise Invalid(self.message('integer', state),</pre></div>
<div class="nocov"><span class="num"><pre> 737</pre></span><pre>                          value, state)</pre></div>
<div class="nocov"><span class="num"><pre> 738</pre></span><pre>        try:</pre></div>
<div class="nocov"><span class="num"><pre> 739</pre></span><pre>            return self.list[value]</pre></div>
<div class="nocov"><span class="num"><pre> 740</pre></span><pre>        except IndexError:</pre></div>
<div class="nocov"><span class="num"><pre> 741</pre></span><pre>            raise Invalid(self.message('outOfRange', state),</pre></div>
<div class="nocov"><span class="num"><pre> 742</pre></span><pre>                          value, state)</pre></div>
<div class="skip"><span class="num"><pre> 743</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 744</pre></span><pre>    def _from_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre> 745</pre></span><pre>        for i in range(len(self.list)):</pre></div>
<div class="nocov"><span class="num"><pre> 746</pre></span><pre>            if self.list[i] == value:</pre></div>
<div class="nocov"><span class="num"><pre> 747</pre></span><pre>                return i</pre></div>
<div class="nocov"><span class="num"><pre> 748</pre></span><pre>        raise Invalid(self.message('notFound', state,</pre></div>
<div class="nocov"><span class="num"><pre> 749</pre></span><pre>                                   value=repr(value)),</pre></div>
<div class="nocov"><span class="num"><pre> 750</pre></span><pre>                      value, state)</pre></div>
<div class="skip"><span class="num"><pre> 751</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 752</pre></span><pre>class DateValidator(FancyValidator):</pre></div>
<div class="skip"><span class="num"><pre> 753</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 754</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 755</pre></span><pre>    Validates that a date is within the given range.  Be sure to call</pre></div>
<div class="nocov"><span class="num"><pre> 756</pre></span><pre>    DateConverter first if you aren't expecting mxDateTime input.</pre></div>
<div class="skip"><span class="num"><pre> 757</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 758</pre></span><pre>    ``earliest_date`` and ``latest_date`` may be functions; if so,</pre></div>
<div class="nocov"><span class="num"><pre> 759</pre></span><pre>    they will be called each time before validating.</pre></div>
<div class="skip"><span class="num"><pre> 760</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 761</pre></span><pre>    ``after_now`` means a time after the current timestamp; note that</pre></div>
<div class="nocov"><span class="num"><pre> 762</pre></span><pre>    just a few milliseconds before now is invalid!  ``today_or_after``</pre></div>
<div class="nocov"><span class="num"><pre> 763</pre></span><pre>    is more permissive, and ignores hours and minutes.</pre></div>
<div class="skip"><span class="num"><pre> 764</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 765</pre></span><pre>    Examples::</pre></div>
<div class="skip"><span class="num"><pre> 766</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 767</pre></span><pre>        &gt;&gt;&gt; from datetime import datetime, timedelta</pre></div>
<div class="nocov"><span class="num"><pre> 768</pre></span><pre>        &gt;&gt;&gt; d = DateValidator(earliest_date=datetime(2003, 1, 1))</pre></div>
<div class="nocov"><span class="num"><pre> 769</pre></span><pre>        &gt;&gt;&gt; d.to_python(datetime(2004, 1, 1))</pre></div>
<div class="nocov"><span class="num"><pre> 770</pre></span><pre>        datetime.datetime(2004, 1, 1, 0, 0)</pre></div>
<div class="nocov"><span class="num"><pre> 771</pre></span><pre>        &gt;&gt;&gt; d.to_python(datetime(2002, 1, 1))</pre></div>
<div class="nocov"><span class="num"><pre> 772</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 773</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre> 774</pre></span><pre>        Invalid: Date must be after Wednesday, 01 January 2003</pre></div>
<div class="nocov"><span class="num"><pre> 775</pre></span><pre>        &gt;&gt;&gt; d.to_python(datetime(2003, 1, 1))</pre></div>
<div class="nocov"><span class="num"><pre> 776</pre></span><pre>        datetime.datetime(2003, 1, 1, 0, 0)</pre></div>
<div class="nocov"><span class="num"><pre> 777</pre></span><pre>        &gt;&gt;&gt; d = DateValidator(after_now=True)</pre></div>
<div class="nocov"><span class="num"><pre> 778</pre></span><pre>        &gt;&gt;&gt; now = datetime.now()</pre></div>
<div class="nocov"><span class="num"><pre> 779</pre></span><pre>        &gt;&gt;&gt; d.to_python(now+timedelta(seconds=5)) == now+timedelta(seconds=5)</pre></div>
<div class="nocov"><span class="num"><pre> 780</pre></span><pre>        True</pre></div>
<div class="nocov"><span class="num"><pre> 781</pre></span><pre>        &gt;&gt;&gt; d.to_python(now-timedelta(days=1))</pre></div>
<div class="nocov"><span class="num"><pre> 782</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 783</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre> 784</pre></span><pre>        Invalid: The date must be sometime in the future</pre></div>
<div class="nocov"><span class="num"><pre> 785</pre></span><pre>        &gt;&gt;&gt; d.to_python(now+timedelta(days=1)) &gt; now</pre></div>
<div class="nocov"><span class="num"><pre> 786</pre></span><pre>        True</pre></div>
<div class="nocov"><span class="num"><pre> 787</pre></span><pre>        &gt;&gt;&gt; d = DateValidator(today_or_after=True)</pre></div>
<div class="nocov"><span class="num"><pre> 788</pre></span><pre>        &gt;&gt;&gt; d.to_python(now) == now</pre></div>
<div class="nocov"><span class="num"><pre> 789</pre></span><pre>        True</pre></div>
<div class="skip"><span class="num"><pre> 790</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 791</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre> 792</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 793</pre></span><pre>    earliest_date = None</pre></div>
<div class="nocov"><span class="num"><pre> 794</pre></span><pre>    latest_date = None</pre></div>
<div class="nocov"><span class="num"><pre> 795</pre></span><pre>    after_now = False</pre></div>
<div class="skip"><span class="num"><pre> 796</pre></span><pre>    # Like after_now, but just after this morning:</pre></div>
<div class="nocov"><span class="num"><pre> 797</pre></span><pre>    today_or_after = False</pre></div>
<div class="skip"><span class="num"><pre> 798</pre></span><pre>    # Use 'datetime' to force the Python 2.3+ datetime module, or</pre></div>
<div class="skip"><span class="num"><pre> 799</pre></span><pre>    # 'mxDateTime' to force the mxDateTime module (None means use</pre></div>
<div class="skip"><span class="num"><pre> 800</pre></span><pre>    # datetime, or if not present mxDateTime)</pre></div>
<div class="nocov"><span class="num"><pre> 801</pre></span><pre>    datetime_module = None</pre></div>
<div class="skip"><span class="num"><pre> 802</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 803</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre> 804</pre></span><pre>        'after': _(&quot;Date must be after %(date)s&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 805</pre></span><pre>        'before': _(&quot;Date must be before %(date)s&quot;),</pre></div>
<div class="skip"><span class="num"><pre> 806</pre></span><pre>        # Double %'s, because this will be substituted twice:</pre></div>
<div class="nocov"><span class="num"><pre> 807</pre></span><pre>        'date_format': _(&quot;%%A, %%d %%B %%Y&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 808</pre></span><pre>        'future': _(&quot;The date must be sometime in the future&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 809</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre> 810</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 811</pre></span><pre>    def validate_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre> 812</pre></span><pre>        date_format = self.message('date_format', state)</pre></div>
<div class="nocov"><span class="num"><pre> 813</pre></span><pre>        if isinstance(date_format, unicode):</pre></div>
<div class="skip"><span class="num"><pre> 814</pre></span><pre>            # strftime uses the locale encoding, not Unicode</pre></div>
<div class="nocov"><span class="num"><pre> 815</pre></span><pre>            encoding = locale.getlocale(locale.LC_TIME)[1] or 'utf-8'</pre></div>
<div class="nocov"><span class="num"><pre> 816</pre></span><pre>            date_format = date_format.encode(encoding)</pre></div>
<div class="nocov"><span class="num"><pre> 817</pre></span><pre>        else:</pre></div>
<div class="nocov"><span class="num"><pre> 818</pre></span><pre>            encoding = None</pre></div>
<div class="nocov"><span class="num"><pre> 819</pre></span><pre>        if self.earliest_date:</pre></div>
<div class="nocov"><span class="num"><pre> 820</pre></span><pre>            if callable(self.earliest_date):</pre></div>
<div class="nocov"><span class="num"><pre> 821</pre></span><pre>                earliest_date = self.earliest_date()</pre></div>
<div class="nocov"><span class="num"><pre> 822</pre></span><pre>            else:</pre></div>
<div class="nocov"><span class="num"><pre> 823</pre></span><pre>                earliest_date = self.earliest_date</pre></div>
<div class="nocov"><span class="num"><pre> 824</pre></span><pre>            if value &lt; earliest_date:</pre></div>
<div class="nocov"><span class="num"><pre> 825</pre></span><pre>                date_formatted = earliest_date.strftime(date_format)</pre></div>
<div class="nocov"><span class="num"><pre> 826</pre></span><pre>                if encoding:</pre></div>
<div class="nocov"><span class="num"><pre> 827</pre></span><pre>                    date_formatted = date_formatted.decode(encoding)</pre></div>
<div class="nocov"><span class="num"><pre> 828</pre></span><pre>                raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre> 829</pre></span><pre>                    self.message('after', state,</pre></div>
<div class="nocov"><span class="num"><pre> 830</pre></span><pre>                                 date=date_formatted),</pre></div>
<div class="nocov"><span class="num"><pre> 831</pre></span><pre>                    value, state)</pre></div>
<div class="nocov"><span class="num"><pre> 832</pre></span><pre>        if self.latest_date:</pre></div>
<div class="nocov"><span class="num"><pre> 833</pre></span><pre>            if callable(self.latest_date):</pre></div>
<div class="nocov"><span class="num"><pre> 834</pre></span><pre>                latest_date = self.latest_date()</pre></div>
<div class="nocov"><span class="num"><pre> 835</pre></span><pre>            else:</pre></div>
<div class="nocov"><span class="num"><pre> 836</pre></span><pre>                latest_date = self.latest_date</pre></div>
<div class="nocov"><span class="num"><pre> 837</pre></span><pre>            if value &gt; latest_date:</pre></div>
<div class="nocov"><span class="num"><pre> 838</pre></span><pre>                date_formatted = latest_date.strftime(date_format)</pre></div>
<div class="nocov"><span class="num"><pre> 839</pre></span><pre>                if encoding:</pre></div>
<div class="nocov"><span class="num"><pre> 840</pre></span><pre>                    date_formatted = date_formatted.decode(encoding)</pre></div>
<div class="nocov"><span class="num"><pre> 841</pre></span><pre>                raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre> 842</pre></span><pre>                    self.message('before', state,</pre></div>
<div class="nocov"><span class="num"><pre> 843</pre></span><pre>                                 date=date_formatted),</pre></div>
<div class="nocov"><span class="num"><pre> 844</pre></span><pre>                    value, state)</pre></div>
<div class="nocov"><span class="num"><pre> 845</pre></span><pre>        if self.after_now:</pre></div>
<div class="nocov"><span class="num"><pre> 846</pre></span><pre>            dt_mod = import_datetime(self.datetime_module)</pre></div>
<div class="nocov"><span class="num"><pre> 847</pre></span><pre>            now = datetime_now(dt_mod)</pre></div>
<div class="nocov"><span class="num"><pre> 848</pre></span><pre>            if value &lt; now:</pre></div>
<div class="nocov"><span class="num"><pre> 849</pre></span><pre>                date_formatted = now.strftime(date_format)</pre></div>
<div class="nocov"><span class="num"><pre> 850</pre></span><pre>                if encoding:</pre></div>
<div class="nocov"><span class="num"><pre> 851</pre></span><pre>                    date_formatted = date_formatted.decode(encoding)</pre></div>
<div class="nocov"><span class="num"><pre> 852</pre></span><pre>                raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre> 853</pre></span><pre>                    self.message('future', state,</pre></div>
<div class="nocov"><span class="num"><pre> 854</pre></span><pre>                                 date=date_formatted),</pre></div>
<div class="nocov"><span class="num"><pre> 855</pre></span><pre>                    value, state)</pre></div>
<div class="nocov"><span class="num"><pre> 856</pre></span><pre>        if self.today_or_after:</pre></div>
<div class="nocov"><span class="num"><pre> 857</pre></span><pre>            dt_mod = import_datetime(self.datetime_module)</pre></div>
<div class="nocov"><span class="num"><pre> 858</pre></span><pre>            now = datetime_now(dt_mod)</pre></div>
<div class="nocov"><span class="num"><pre> 859</pre></span><pre>            today = datetime_makedate(dt_mod,</pre></div>
<div class="nocov"><span class="num"><pre> 860</pre></span><pre>                                      now.year, now.month, now.day)</pre></div>
<div class="nocov"><span class="num"><pre> 861</pre></span><pre>            value_as_date = datetime_makedate(</pre></div>
<div class="nocov"><span class="num"><pre> 862</pre></span><pre>                dt_mod, value.year, value.month, value.day)</pre></div>
<div class="nocov"><span class="num"><pre> 863</pre></span><pre>            if value_as_date &lt; today:</pre></div>
<div class="nocov"><span class="num"><pre> 864</pre></span><pre>                date_formatted = now.strftime(date_format)</pre></div>
<div class="nocov"><span class="num"><pre> 865</pre></span><pre>                if encoding:</pre></div>
<div class="nocov"><span class="num"><pre> 866</pre></span><pre>                    date_formatted = date_formatted.decode(encoding)</pre></div>
<div class="nocov"><span class="num"><pre> 867</pre></span><pre>                raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre> 868</pre></span><pre>                    self.message('future', state,</pre></div>
<div class="nocov"><span class="num"><pre> 869</pre></span><pre>                                 date=date_formatted),</pre></div>
<div class="nocov"><span class="num"><pre> 870</pre></span><pre>                    value, state)</pre></div>
<div class="skip"><span class="num"><pre> 871</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 872</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 873</pre></span><pre>class Bool(FancyValidator):</pre></div>
<div class="skip"><span class="num"><pre> 874</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 875</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 876</pre></span><pre>    Always Valid, returns True or False based on the value and the</pre></div>
<div class="nocov"><span class="num"><pre> 877</pre></span><pre>    existance of the value.</pre></div>
<div class="skip"><span class="num"><pre> 878</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 879</pre></span><pre>    If you want to convert strings like ``'true'`` to booleans, then</pre></div>
<div class="nocov"><span class="num"><pre> 880</pre></span><pre>    use ``StringBoolean``.</pre></div>
<div class="skip"><span class="num"><pre> 881</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 882</pre></span><pre>    Examples::</pre></div>
<div class="skip"><span class="num"><pre> 883</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 884</pre></span><pre>        &gt;&gt;&gt; Bool.to_python(0)</pre></div>
<div class="nocov"><span class="num"><pre> 885</pre></span><pre>        False</pre></div>
<div class="nocov"><span class="num"><pre> 886</pre></span><pre>        &gt;&gt;&gt; Bool.to_python(1)</pre></div>
<div class="nocov"><span class="num"><pre> 887</pre></span><pre>        True</pre></div>
<div class="nocov"><span class="num"><pre> 888</pre></span><pre>        &gt;&gt;&gt; Bool.to_python('')</pre></div>
<div class="nocov"><span class="num"><pre> 889</pre></span><pre>        False</pre></div>
<div class="nocov"><span class="num"><pre> 890</pre></span><pre>        &gt;&gt;&gt; Bool.to_python(None)</pre></div>
<div class="nocov"><span class="num"><pre> 891</pre></span><pre>        False</pre></div>
<div class="nocov"><span class="num"><pre> 892</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre> 893</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 894</pre></span><pre>    if_missing = False</pre></div>
<div class="skip"><span class="num"><pre> 895</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 896</pre></span><pre>    def _to_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre> 897</pre></span><pre>        return bool(value)</pre></div>
<div class="nocov"><span class="num"><pre> 898</pre></span><pre>    _from_python = _to_python</pre></div>
<div class="skip"><span class="num"><pre> 899</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 900</pre></span><pre>    def empty_value(self, value):</pre></div>
<div class="nocov"><span class="num"><pre> 901</pre></span><pre>        return False</pre></div>
<div class="skip"><span class="num"><pre> 902</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 903</pre></span><pre>class RangeValidator(FancyValidator):</pre></div>
<div class="skip"><span class="num"><pre> 904</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 905</pre></span><pre>    &quot;&quot;&quot;This is an abstract base class for Int and Number.</pre></div>
<div class="skip"><span class="num"><pre> 906</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 907</pre></span><pre>    It verifies that a value is within range.  It accepts min and max</pre></div>
<div class="nocov"><span class="num"><pre> 908</pre></span><pre>    values in the constructor.</pre></div>
<div class="skip"><span class="num"><pre> 909</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 910</pre></span><pre>    (Since this is an abstract base class, the tests are in Int and</pre></div>
<div class="nocov"><span class="num"><pre> 911</pre></span><pre>    Number.)</pre></div>
<div class="skip"><span class="num"><pre> 912</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 913</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre> 914</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 915</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre> 916</pre></span><pre>        'tooLow': _(&quot;Please enter a number that is %(min)s or greater&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 917</pre></span><pre>        'tooHigh': _(&quot;Please enter a number that is %(max)s or smaller&quot;),</pre></div>
<div class="nocov"><span class="num"><pre> 918</pre></span><pre>    }</pre></div>
<div class="skip"><span class="num"><pre> 919</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 920</pre></span><pre>    min = None</pre></div>
<div class="nocov"><span class="num"><pre> 921</pre></span><pre>    max = None</pre></div>
<div class="skip"><span class="num"><pre> 922</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 923</pre></span><pre>    def validate_python(self, value, state):</pre></div>
<div class="cov"><span class="num"><pre> 924</pre></span><pre>        if self.min is not None:</pre></div>
<div class="cov"><span class="num"><pre> 925</pre></span><pre>            if value &lt; self.min:</pre></div>
<div class="cov"><span class="num"><pre> 926</pre></span><pre>                msg = self.message(&quot;tooLow&quot;, state, min=self.min)</pre></div>
<div class="cov"><span class="num"><pre> 927</pre></span><pre>                raise Invalid(msg, value, state)</pre></div>
<div class="cov"><span class="num"><pre> 928</pre></span><pre>        if self.max is not None:</pre></div>
<div class="cov"><span class="num"><pre> 929</pre></span><pre>            if value &gt; self.max:</pre></div>
<div class="cov"><span class="num"><pre> 930</pre></span><pre>                msg = self.message(&quot;tooHigh&quot;, state, max=self.max)</pre></div>
<div class="cov"><span class="num"><pre> 931</pre></span><pre>                raise Invalid(msg, value, state)</pre></div>
<div class="skip"><span class="num"><pre> 932</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 933</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 934</pre></span><pre>class Int(RangeValidator):</pre></div>
<div class="skip"><span class="num"><pre> 935</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 936</pre></span><pre>    &quot;&quot;&quot;Convert a value to an integer.</pre></div>
<div class="skip"><span class="num"><pre> 937</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 938</pre></span><pre>    Example::</pre></div>
<div class="skip"><span class="num"><pre> 939</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 940</pre></span><pre>        &gt;&gt;&gt; Int.to_python('10')</pre></div>
<div class="nocov"><span class="num"><pre> 941</pre></span><pre>        10</pre></div>
<div class="nocov"><span class="num"><pre> 942</pre></span><pre>        &gt;&gt;&gt; Int.to_python('ten')</pre></div>
<div class="nocov"><span class="num"><pre> 943</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 944</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre> 945</pre></span><pre>        Invalid: Please enter an integer value</pre></div>
<div class="nocov"><span class="num"><pre> 946</pre></span><pre>        &gt;&gt;&gt; Int(min=5).to_python('6')</pre></div>
<div class="nocov"><span class="num"><pre> 947</pre></span><pre>        6</pre></div>
<div class="nocov"><span class="num"><pre> 948</pre></span><pre>        &gt;&gt;&gt; Int(max=10).to_python('11')</pre></div>
<div class="nocov"><span class="num"><pre> 949</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 950</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre> 951</pre></span><pre>        Invalid: Please enter a number that is 10 or smaller</pre></div>
<div class="skip"><span class="num"><pre> 952</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 953</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre> 954</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 955</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre> 956</pre></span><pre>        'integer': _(&quot;Please enter an integer value&quot;)</pre></div>
<div class="nocov"><span class="num"><pre> 957</pre></span><pre>    }</pre></div>
<div class="skip"><span class="num"><pre> 958</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 959</pre></span><pre>    def _to_python(self, value, state):</pre></div>
<div class="cov"><span class="num"><pre> 960</pre></span><pre>        try:</pre></div>
<div class="cov"><span class="num"><pre> 961</pre></span><pre>            return int(value)</pre></div>
<div class="nocov"><span class="num"><pre> 962</pre></span><pre>        except (ValueError, TypeError):</pre></div>
<div class="nocov"><span class="num"><pre> 963</pre></span><pre>            raise Invalid(self.message('integer', state),</pre></div>
<div class="nocov"><span class="num"><pre> 964</pre></span><pre>                          value, state)</pre></div>
<div class="skip"><span class="num"><pre> 965</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 966</pre></span><pre>    _from_python = _to_python</pre></div>
<div class="skip"><span class="num"><pre> 967</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 968</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 969</pre></span><pre>class Number(RangeValidator):</pre></div>
<div class="skip"><span class="num"><pre> 970</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 971</pre></span><pre>    &quot;&quot;&quot;Convert a value to a float or integer.</pre></div>
<div class="skip"><span class="num"><pre> 972</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 973</pre></span><pre>    Tries to convert it to an integer if no information is lost.</pre></div>
<div class="skip"><span class="num"><pre> 974</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 975</pre></span><pre>    Example::</pre></div>
<div class="skip"><span class="num"><pre> 976</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 977</pre></span><pre>        &gt;&gt;&gt; Number.to_python('10')</pre></div>
<div class="nocov"><span class="num"><pre> 978</pre></span><pre>        10</pre></div>
<div class="nocov"><span class="num"><pre> 979</pre></span><pre>        &gt;&gt;&gt; Number.to_python('10.5')</pre></div>
<div class="nocov"><span class="num"><pre> 980</pre></span><pre>        10.5</pre></div>
<div class="nocov"><span class="num"><pre> 981</pre></span><pre>        &gt;&gt;&gt; Number.to_python('ten')</pre></div>
<div class="nocov"><span class="num"><pre> 982</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 983</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre> 984</pre></span><pre>        Invalid: Please enter a number</pre></div>
<div class="nocov"><span class="num"><pre> 985</pre></span><pre>        &gt;&gt;&gt; Number(min=5).to_python('6.5')</pre></div>
<div class="nocov"><span class="num"><pre> 986</pre></span><pre>        6.5</pre></div>
<div class="nocov"><span class="num"><pre> 987</pre></span><pre>        &gt;&gt;&gt; Number(max=10.5).to_python('11.5')</pre></div>
<div class="nocov"><span class="num"><pre> 988</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre> 989</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre> 990</pre></span><pre>        Invalid: Please enter a number that is 10.5 or smaller</pre></div>
<div class="nocov"><span class="num"><pre> 991</pre></span><pre>        &gt;&gt;&gt; Number().to_python('infinity')</pre></div>
<div class="nocov"><span class="num"><pre> 992</pre></span><pre>        inf</pre></div>
<div class="skip"><span class="num"><pre> 993</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 994</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre> 995</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 996</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre> 997</pre></span><pre>        'number': _(&quot;Please enter a number&quot;)</pre></div>
<div class="nocov"><span class="num"><pre> 998</pre></span><pre>    }</pre></div>
<div class="skip"><span class="num"><pre> 999</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1000</pre></span><pre>    def _to_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre>1001</pre></span><pre>        try:</pre></div>
<div class="nocov"><span class="num"><pre>1002</pre></span><pre>            value = float(value)</pre></div>
<div class="nocov"><span class="num"><pre>1003</pre></span><pre>            try:</pre></div>
<div class="nocov"><span class="num"><pre>1004</pre></span><pre>                int_value = int(value)</pre></div>
<div class="nocov"><span class="num"><pre>1005</pre></span><pre>            except OverflowError:</pre></div>
<div class="nocov"><span class="num"><pre>1006</pre></span><pre>                int_value = None</pre></div>
<div class="nocov"><span class="num"><pre>1007</pre></span><pre>            if value == int_value:</pre></div>
<div class="nocov"><span class="num"><pre>1008</pre></span><pre>                return int_value</pre></div>
<div class="nocov"><span class="num"><pre>1009</pre></span><pre>            return value</pre></div>
<div class="nocov"><span class="num"><pre>1010</pre></span><pre>        except ValueError:</pre></div>
<div class="nocov"><span class="num"><pre>1011</pre></span><pre>            raise Invalid(self.message('number', state),</pre></div>
<div class="nocov"><span class="num"><pre>1012</pre></span><pre>                          value, state)</pre></div>
<div class="skip"><span class="num"><pre>1013</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>1014</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1015</pre></span><pre>class String(FancyValidator):</pre></div>
<div class="nocov"><span class="num"><pre>1016</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>1017</pre></span><pre>    Converts things to string, but treats empty things as the empty</pre></div>
<div class="nocov"><span class="num"><pre>1018</pre></span><pre>    string.</pre></div>
<div class="skip"><span class="num"><pre>1019</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1020</pre></span><pre>    Also takes a `max` and `min` argument, and the string length must</pre></div>
<div class="nocov"><span class="num"><pre>1021</pre></span><pre>    fall in that range.</pre></div>
<div class="skip"><span class="num"><pre>1022</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1023</pre></span><pre>    Also you may give an `encoding` argument, which will encode any</pre></div>
<div class="nocov"><span class="num"><pre>1024</pre></span><pre>    unicode that is found.  Lists and tuples are joined with</pre></div>
<div class="nocov"><span class="num"><pre>1025</pre></span><pre>    `list_joiner` (default ``', '``) in ``from_python``.</pre></div>
<div class="skip"><span class="num"><pre>1026</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1027</pre></span><pre>    ::</pre></div>
<div class="skip"><span class="num"><pre>1028</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1029</pre></span><pre>        &gt;&gt;&gt; String(min=2).to_python('a')</pre></div>
<div class="nocov"><span class="num"><pre>1030</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1031</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1032</pre></span><pre>        Invalid: Enter a value 2 characters long or more</pre></div>
<div class="nocov"><span class="num"><pre>1033</pre></span><pre>        &gt;&gt;&gt; String(max=10).to_python('xxxxxxxxxxx')</pre></div>
<div class="nocov"><span class="num"><pre>1034</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1035</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1036</pre></span><pre>        Invalid: Enter a value less than 10 characters long</pre></div>
<div class="nocov"><span class="num"><pre>1037</pre></span><pre>        &gt;&gt;&gt; String().from_python(None)</pre></div>
<div class="nocov"><span class="num"><pre>1038</pre></span><pre>        ''</pre></div>
<div class="nocov"><span class="num"><pre>1039</pre></span><pre>        &gt;&gt;&gt; String().from_python([])</pre></div>
<div class="nocov"><span class="num"><pre>1040</pre></span><pre>        ''</pre></div>
<div class="nocov"><span class="num"><pre>1041</pre></span><pre>        &gt;&gt;&gt; String().to_python(None)</pre></div>
<div class="nocov"><span class="num"><pre>1042</pre></span><pre>        ''</pre></div>
<div class="nocov"><span class="num"><pre>1043</pre></span><pre>        &gt;&gt;&gt; String(min=3).to_python(None)</pre></div>
<div class="nocov"><span class="num"><pre>1044</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1045</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1046</pre></span><pre>        Invalid: Please enter a value</pre></div>
<div class="nocov"><span class="num"><pre>1047</pre></span><pre>        &gt;&gt;&gt; String(min=1).to_python('')</pre></div>
<div class="nocov"><span class="num"><pre>1048</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1049</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1050</pre></span><pre>        Invalid: Please enter a value</pre></div>
<div class="skip"><span class="num"><pre>1051</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1052</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>1053</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1054</pre></span><pre>    min = None</pre></div>
<div class="nocov"><span class="num"><pre>1055</pre></span><pre>    max = None</pre></div>
<div class="nocov"><span class="num"><pre>1056</pre></span><pre>    not_empty = None</pre></div>
<div class="nocov"><span class="num"><pre>1057</pre></span><pre>    encoding = None</pre></div>
<div class="nocov"><span class="num"><pre>1058</pre></span><pre>    list_joiner = ', '</pre></div>
<div class="skip"><span class="num"><pre>1059</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1060</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre>1061</pre></span><pre>        'tooLong': _(&quot;Enter a value less than %(max)i characters long&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>1062</pre></span><pre>        'tooShort': _(&quot;Enter a value %(min)i characters long or more&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>1063</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre>1064</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1065</pre></span><pre>    def __initargs__(self, new_attrs):</pre></div>
<div class="cov"><span class="num"><pre>1066</pre></span><pre>        if self.not_empty is None and self.min:</pre></div>
<div class="cov"><span class="num"><pre>1067</pre></span><pre>            self.not_empty = True</pre></div>
<div class="skip"><span class="num"><pre>1068</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1069</pre></span><pre>    def _to_python(self, value, state):</pre></div>
<div class="cov"><span class="num"><pre>1070</pre></span><pre>        if not value:</pre></div>
<div class="nocov"><span class="num"><pre>1071</pre></span><pre>            value = ''</pre></div>
<div class="cov"><span class="num"><pre>1072</pre></span><pre>        if not isinstance(value, basestring):</pre></div>
<div class="nocov"><span class="num"><pre>1073</pre></span><pre>            try:</pre></div>
<div class="nocov"><span class="num"><pre>1074</pre></span><pre>                value = str(value)</pre></div>
<div class="nocov"><span class="num"><pre>1075</pre></span><pre>            except UnicodeEncodeError:</pre></div>
<div class="nocov"><span class="num"><pre>1076</pre></span><pre>                value = unicode(value)</pre></div>
<div class="cov"><span class="num"><pre>1077</pre></span><pre>        if self.encoding is not None and isinstance(value, unicode):</pre></div>
<div class="nocov"><span class="num"><pre>1078</pre></span><pre>            value = value.encode(self.encoding)</pre></div>
<div class="cov"><span class="num"><pre>1079</pre></span><pre>        return value</pre></div>
<div class="skip"><span class="num"><pre>1080</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1081</pre></span><pre>    def _from_python(self, value, state):</pre></div>
<div class="cov"><span class="num"><pre>1082</pre></span><pre>        if not value and value != 0:</pre></div>
<div class="nocov"><span class="num"><pre>1083</pre></span><pre>            value = ''</pre></div>
<div class="cov"><span class="num"><pre>1084</pre></span><pre>        if not isinstance(value, basestring):</pre></div>
<div class="cov"><span class="num"><pre>1085</pre></span><pre>            if isinstance(value, (list, tuple)):</pre></div>
<div class="cov"><span class="num"><pre>1086</pre></span><pre>                value = self.list_joiner.join([</pre></div>
<div class="cov"><span class="num"><pre>1087</pre></span><pre>                    self._from_python(v, state) for v in value])</pre></div>
<div class="cov"><span class="num"><pre>1088</pre></span><pre>            try:</pre></div>
<div class="cov"><span class="num"><pre>1089</pre></span><pre>                value = str(value)</pre></div>
<div class="nocov"><span class="num"><pre>1090</pre></span><pre>            except UnicodeEncodeError:</pre></div>
<div class="nocov"><span class="num"><pre>1091</pre></span><pre>                value = unicode(value)</pre></div>
<div class="cov"><span class="num"><pre>1092</pre></span><pre>        if self.encoding is not None and isinstance(value, unicode):</pre></div>
<div class="nocov"><span class="num"><pre>1093</pre></span><pre>            value = value.encode(self.encoding)</pre></div>
<div class="cov"><span class="num"><pre>1094</pre></span><pre>        if self.strip:</pre></div>
<div class="nocov"><span class="num"><pre>1095</pre></span><pre>            value = value.strip()</pre></div>
<div class="cov"><span class="num"><pre>1096</pre></span><pre>        return value</pre></div>
<div class="skip"><span class="num"><pre>1097</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1098</pre></span><pre>    def validate_other(self, value, state):</pre></div>
<div class="cov"><span class="num"><pre>1099</pre></span><pre>        if (self.max is not None and value is not None</pre></div>
<div class="cov"><span class="num"><pre>1100</pre></span><pre>            and len(value) &gt; self.max):</pre></div>
<div class="cov"><span class="num"><pre>1101</pre></span><pre>            raise Invalid(self.message('tooLong', state,</pre></div>
<div class="cov"><span class="num"><pre>1102</pre></span><pre>                                       max=self.max),</pre></div>
<div class="cov"><span class="num"><pre>1103</pre></span><pre>                          value, state)</pre></div>
<div class="cov"><span class="num"><pre>1104</pre></span><pre>        if (self.min is not None</pre></div>
<div class="cov"><span class="num"><pre>1105</pre></span><pre>            and (not value or len(value) &lt; self.min)):</pre></div>
<div class="cov"><span class="num"><pre>1106</pre></span><pre>            raise Invalid(self.message('tooShort', state,</pre></div>
<div class="cov"><span class="num"><pre>1107</pre></span><pre>                                       min=self.min),</pre></div>
<div class="cov"><span class="num"><pre>1108</pre></span><pre>                          value, state)</pre></div>
<div class="skip"><span class="num"><pre>1109</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1110</pre></span><pre>    def empty_value(self, value):</pre></div>
<div class="cov"><span class="num"><pre>1111</pre></span><pre>        return ''</pre></div>
<div class="skip"><span class="num"><pre>1112</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1113</pre></span><pre>class UnicodeString(String):</pre></div>
<div class="nocov"><span class="num"><pre>1114</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>1115</pre></span><pre>    Converts things to unicode string, this is a specialization of</pre></div>
<div class="nocov"><span class="num"><pre>1116</pre></span><pre>    the String class.</pre></div>
<div class="skip"><span class="num"><pre>1117</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1118</pre></span><pre>    In addition to the String arguments, an encoding argument is also</pre></div>
<div class="nocov"><span class="num"><pre>1119</pre></span><pre>    accepted. By default the encoding will be utf-8. You can overwrite</pre></div>
<div class="nocov"><span class="num"><pre>1120</pre></span><pre>    this using the encoding parameter. You can also set inputEncoding</pre></div>
<div class="nocov"><span class="num"><pre>1121</pre></span><pre>    and outputEncoding differently. An inputEncoding of None means</pre></div>
<div class="nocov"><span class="num"><pre>1122</pre></span><pre>    &quot;do not decode&quot;, an outputEncoding of None means &quot;do not encode&quot;.</pre></div>
<div class="skip"><span class="num"><pre>1123</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1124</pre></span><pre>    All converted strings are returned as Unicode strings.</pre></div>
<div class="skip"><span class="num"><pre>1125</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1126</pre></span><pre>    ::</pre></div>
<div class="skip"><span class="num"><pre>1127</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1128</pre></span><pre>        &gt;&gt;&gt; UnicodeString().to_python(None)</pre></div>
<div class="nocov"><span class="num"><pre>1129</pre></span><pre>        u''</pre></div>
<div class="nocov"><span class="num"><pre>1130</pre></span><pre>        &gt;&gt;&gt; UnicodeString().to_python([])</pre></div>
<div class="nocov"><span class="num"><pre>1131</pre></span><pre>        u''</pre></div>
<div class="nocov"><span class="num"><pre>1132</pre></span><pre>        &gt;&gt;&gt; UnicodeString(encoding='utf-7').to_python('Ni Ni Ni')</pre></div>
<div class="nocov"><span class="num"><pre>1133</pre></span><pre>        u'Ni Ni Ni'</pre></div>
<div class="skip"><span class="num"><pre>1134</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1135</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>1136</pre></span><pre>    encoding = 'utf-8'</pre></div>
<div class="nocov"><span class="num"><pre>1137</pre></span><pre>    inputEncoding = NoDefault</pre></div>
<div class="nocov"><span class="num"><pre>1138</pre></span><pre>    outputEncoding = NoDefault</pre></div>
<div class="nocov"><span class="num"><pre>1139</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre>1140</pre></span><pre>        'badEncoding' : _(&quot;Invalid data or incorrect encoding&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>1141</pre></span><pre>    }</pre></div>
<div class="skip"><span class="num"><pre>1142</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1143</pre></span><pre>    def __init__(self, **kw):</pre></div>
<div class="cov"><span class="num"><pre>1144</pre></span><pre>        String.__init__(self, **kw)</pre></div>
<div class="cov"><span class="num"><pre>1145</pre></span><pre>        if self.inputEncoding is NoDefault:</pre></div>
<div class="cov"><span class="num"><pre>1146</pre></span><pre>            self.inputEncoding = self.encoding</pre></div>
<div class="cov"><span class="num"><pre>1147</pre></span><pre>        if self.outputEncoding is NoDefault:</pre></div>
<div class="cov"><span class="num"><pre>1148</pre></span><pre>            self.outputEncoding = self.encoding</pre></div>
<div class="skip"><span class="num"><pre>1149</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1150</pre></span><pre>    def _to_python(self, value, state):</pre></div>
<div class="cov"><span class="num"><pre>1151</pre></span><pre>        if not value:</pre></div>
<div class="nocov"><span class="num"><pre>1152</pre></span><pre>            return u''</pre></div>
<div class="cov"><span class="num"><pre>1153</pre></span><pre>        if isinstance(value, unicode):</pre></div>
<div class="cov"><span class="num"><pre>1154</pre></span><pre>            return value</pre></div>
<div class="cov"><span class="num"><pre>1155</pre></span><pre>        if not isinstance(value, unicode):</pre></div>
<div class="cov"><span class="num"><pre>1156</pre></span><pre>            if hasattr(value, '__unicode__'):</pre></div>
<div class="nocov"><span class="num"><pre>1157</pre></span><pre>                value = unicode(value)</pre></div>
<div class="nocov"><span class="num"><pre>1158</pre></span><pre>                return value</pre></div>
<div class="cov"><span class="num"><pre>1159</pre></span><pre>            else:</pre></div>
<div class="cov"><span class="num"><pre>1160</pre></span><pre>                value = str(value)</pre></div>
<div class="cov"><span class="num"><pre>1161</pre></span><pre>        if self.inputEncoding:</pre></div>
<div class="cov"><span class="num"><pre>1162</pre></span><pre>            try:</pre></div>
<div class="cov"><span class="num"><pre>1163</pre></span><pre>                value = unicode(value, self.inputEncoding)</pre></div>
<div class="nocov"><span class="num"><pre>1164</pre></span><pre>            except UnicodeDecodeError:</pre></div>
<div class="nocov"><span class="num"><pre>1165</pre></span><pre>                raise Invalid(self.message('badEncoding', state), value, state)</pre></div>
<div class="nocov"><span class="num"><pre>1166</pre></span><pre>            except TypeError:</pre></div>
<div class="nocov"><span class="num"><pre>1167</pre></span><pre>                raise Invalid(self.message('badType', state, type=type(value),</pre></div>
<div class="nocov"><span class="num"><pre>1168</pre></span><pre>                    value=value), value, state)</pre></div>
<div class="cov"><span class="num"><pre>1169</pre></span><pre>        return value</pre></div>
<div class="skip"><span class="num"><pre>1170</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1171</pre></span><pre>    def _from_python(self, value, state):</pre></div>
<div class="cov"><span class="num"><pre>1172</pre></span><pre>        if not isinstance(value, unicode):</pre></div>
<div class="cov"><span class="num"><pre>1173</pre></span><pre>            if hasattr(value, '__unicode__'):</pre></div>
<div class="nocov"><span class="num"><pre>1174</pre></span><pre>                value = unicode(value)</pre></div>
<div class="cov"><span class="num"><pre>1175</pre></span><pre>            else:</pre></div>
<div class="cov"><span class="num"><pre>1176</pre></span><pre>                value = str(value)</pre></div>
<div class="cov"><span class="num"><pre>1177</pre></span><pre>        if self.outputEncoding and isinstance(value, unicode):</pre></div>
<div class="cov"><span class="num"><pre>1178</pre></span><pre>            value = value.encode(self.outputEncoding)</pre></div>
<div class="cov"><span class="num"><pre>1179</pre></span><pre>        return value</pre></div>
<div class="skip"><span class="num"><pre>1180</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1181</pre></span><pre>    def empty_value(self, value):</pre></div>
<div class="cov"><span class="num"><pre>1182</pre></span><pre>        return u''</pre></div>
<div class="skip"><span class="num"><pre>1183</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1184</pre></span><pre>class Set(FancyValidator):</pre></div>
<div class="skip"><span class="num"><pre>1185</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1186</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>1187</pre></span><pre>    This is for when you think you may return multiple values for a</pre></div>
<div class="nocov"><span class="num"><pre>1188</pre></span><pre>    certain field.</pre></div>
<div class="skip"><span class="num"><pre>1189</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1190</pre></span><pre>    This way the result will always be a list, even if there's only</pre></div>
<div class="nocov"><span class="num"><pre>1191</pre></span><pre>    one result.  It's equivalent to ForEach(convertToList=True).</pre></div>
<div class="skip"><span class="num"><pre>1192</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1193</pre></span><pre>    If you give ``use_set=True``, then it will return an actual</pre></div>
<div class="nocov"><span class="num"><pre>1194</pre></span><pre>    ``set`` object.</pre></div>
<div class="skip"><span class="num"><pre>1195</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1196</pre></span><pre>    ::</pre></div>
<div class="skip"><span class="num"><pre>1197</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1198</pre></span><pre>       &gt;&gt;&gt; Set.to_python(None)</pre></div>
<div class="nocov"><span class="num"><pre>1199</pre></span><pre>       []</pre></div>
<div class="nocov"><span class="num"><pre>1200</pre></span><pre>       &gt;&gt;&gt; Set.to_python('this')</pre></div>
<div class="nocov"><span class="num"><pre>1201</pre></span><pre>       ['this']</pre></div>
<div class="nocov"><span class="num"><pre>1202</pre></span><pre>       &gt;&gt;&gt; Set.to_python(('this', 'that'))</pre></div>
<div class="nocov"><span class="num"><pre>1203</pre></span><pre>       ['this', 'that']</pre></div>
<div class="nocov"><span class="num"><pre>1204</pre></span><pre>       &gt;&gt;&gt; s = Set(use_set=True)</pre></div>
<div class="nocov"><span class="num"><pre>1205</pre></span><pre>       &gt;&gt;&gt; s.to_python(None)</pre></div>
<div class="nocov"><span class="num"><pre>1206</pre></span><pre>       set([])</pre></div>
<div class="nocov"><span class="num"><pre>1207</pre></span><pre>       &gt;&gt;&gt; s.to_python('this')</pre></div>
<div class="nocov"><span class="num"><pre>1208</pre></span><pre>       set(['this'])</pre></div>
<div class="nocov"><span class="num"><pre>1209</pre></span><pre>       &gt;&gt;&gt; s.to_python(('this',))</pre></div>
<div class="nocov"><span class="num"><pre>1210</pre></span><pre>       set(['this'])</pre></div>
<div class="nocov"><span class="num"><pre>1211</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>1212</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1213</pre></span><pre>    use_set = False</pre></div>
<div class="skip"><span class="num"><pre>1214</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1215</pre></span><pre>    if_missing = ()</pre></div>
<div class="skip"><span class="num"><pre>1216</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1217</pre></span><pre>    def _to_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre>1218</pre></span><pre>        if self.use_set:</pre></div>
<div class="nocov"><span class="num"><pre>1219</pre></span><pre>            if isinstance(value, (set, sets.Set)):</pre></div>
<div class="nocov"><span class="num"><pre>1220</pre></span><pre>                return value</pre></div>
<div class="nocov"><span class="num"><pre>1221</pre></span><pre>            elif isinstance(value, (list, tuple)):</pre></div>
<div class="nocov"><span class="num"><pre>1222</pre></span><pre>                return set(value)</pre></div>
<div class="nocov"><span class="num"><pre>1223</pre></span><pre>            elif value is None:</pre></div>
<div class="nocov"><span class="num"><pre>1224</pre></span><pre>                return set()</pre></div>
<div class="nocov"><span class="num"><pre>1225</pre></span><pre>            else:</pre></div>
<div class="nocov"><span class="num"><pre>1226</pre></span><pre>                return set([value])</pre></div>
<div class="nocov"><span class="num"><pre>1227</pre></span><pre>        else:</pre></div>
<div class="nocov"><span class="num"><pre>1228</pre></span><pre>            if isinstance(value, list):</pre></div>
<div class="nocov"><span class="num"><pre>1229</pre></span><pre>                return value</pre></div>
<div class="nocov"><span class="num"><pre>1230</pre></span><pre>            elif sets and isinstance(value, (set, sets.Set)):</pre></div>
<div class="nocov"><span class="num"><pre>1231</pre></span><pre>                return list(value)</pre></div>
<div class="nocov"><span class="num"><pre>1232</pre></span><pre>            elif isinstance(value, tuple):</pre></div>
<div class="nocov"><span class="num"><pre>1233</pre></span><pre>                return list(value)</pre></div>
<div class="nocov"><span class="num"><pre>1234</pre></span><pre>            elif value is None:</pre></div>
<div class="nocov"><span class="num"><pre>1235</pre></span><pre>                return []</pre></div>
<div class="nocov"><span class="num"><pre>1236</pre></span><pre>            else:</pre></div>
<div class="nocov"><span class="num"><pre>1237</pre></span><pre>                return [value]</pre></div>
<div class="skip"><span class="num"><pre>1238</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1239</pre></span><pre>    def empty_value(self, value):</pre></div>
<div class="nocov"><span class="num"><pre>1240</pre></span><pre>        if self.use_set:</pre></div>
<div class="nocov"><span class="num"><pre>1241</pre></span><pre>            return set()</pre></div>
<div class="nocov"><span class="num"><pre>1242</pre></span><pre>        else:</pre></div>
<div class="nocov"><span class="num"><pre>1243</pre></span><pre>            return []</pre></div>
<div class="skip"><span class="num"><pre>1244</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1245</pre></span><pre>class Email(FancyValidator):</pre></div>
<div class="nocov"><span class="num"><pre>1246</pre></span><pre>    r&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>1247</pre></span><pre>    Validate an email address.</pre></div>
<div class="skip"><span class="num"><pre>1248</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1249</pre></span><pre>    If you pass ``resolve_domain=True``, then it will try to resolve</pre></div>
<div class="nocov"><span class="num"><pre>1250</pre></span><pre>    the domain name to make sure it's valid.  This takes longer, of</pre></div>
<div class="nocov"><span class="num"><pre>1251</pre></span><pre>    course.  You must have the `pyDNS &lt;http://pydns.sf.net&gt;`__ modules</pre></div>
<div class="nocov"><span class="num"><pre>1252</pre></span><pre>    installed to look up DNS (MX and A) records.</pre></div>
<div class="skip"><span class="num"><pre>1253</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1254</pre></span><pre>    ::</pre></div>
<div class="skip"><span class="num"><pre>1255</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1256</pre></span><pre>        &gt;&gt;&gt; e = Email()</pre></div>
<div class="nocov"><span class="num"><pre>1257</pre></span><pre>        &gt;&gt;&gt; e.to_python(' test@foo.com ')</pre></div>
<div class="nocov"><span class="num"><pre>1258</pre></span><pre>        'test@foo.com'</pre></div>
<div class="nocov"><span class="num"><pre>1259</pre></span><pre>        &gt;&gt;&gt; e.to_python('test')</pre></div>
<div class="nocov"><span class="num"><pre>1260</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1261</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1262</pre></span><pre>        Invalid: An email address must contain a single @</pre></div>
<div class="nocov"><span class="num"><pre>1263</pre></span><pre>        &gt;&gt;&gt; e.to_python('test@foobar')</pre></div>
<div class="nocov"><span class="num"><pre>1264</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1265</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1266</pre></span><pre>        Invalid: The domain portion of the email address is invalid (the portion after the @: foobar)</pre></div>
<div class="nocov"><span class="num"><pre>1267</pre></span><pre>        &gt;&gt;&gt; e.to_python('test@foobar.com.5')</pre></div>
<div class="nocov"><span class="num"><pre>1268</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1269</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1270</pre></span><pre>        Invalid: The domain portion of the email address is invalid (the portion after the @: foobar.com.5)</pre></div>
<div class="nocov"><span class="num"><pre>1271</pre></span><pre>        &gt;&gt;&gt; e.to_python('test@foo..bar.com')</pre></div>
<div class="nocov"><span class="num"><pre>1272</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1273</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1274</pre></span><pre>        Invalid: The domain portion of the email address is invalid (the portion after the @: foo..bar.com)</pre></div>
<div class="nocov"><span class="num"><pre>1275</pre></span><pre>        &gt;&gt;&gt; e.to_python('test@.foo.bar.com')</pre></div>
<div class="nocov"><span class="num"><pre>1276</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1277</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1278</pre></span><pre>        Invalid: The domain portion of the email address is invalid (the portion after the @: .foo.bar.com)</pre></div>
<div class="nocov"><span class="num"><pre>1279</pre></span><pre>        &gt;&gt;&gt; e.to_python('nobody@xn--m7r7ml7t24h.com')</pre></div>
<div class="nocov"><span class="num"><pre>1280</pre></span><pre>        'nobody@xn--m7r7ml7t24h.com'</pre></div>
<div class="nocov"><span class="num"><pre>1281</pre></span><pre>        &gt;&gt;&gt; e.to_python('o*reilly@test.com')</pre></div>
<div class="nocov"><span class="num"><pre>1282</pre></span><pre>        'o*reilly@test.com'</pre></div>
<div class="nocov"><span class="num"><pre>1283</pre></span><pre>        &gt;&gt;&gt; e = Email(resolve_domain=True)</pre></div>
<div class="nocov"><span class="num"><pre>1284</pre></span><pre>        &gt;&gt;&gt; e.resolve_domain</pre></div>
<div class="nocov"><span class="num"><pre>1285</pre></span><pre>        True</pre></div>
<div class="nocov"><span class="num"><pre>1286</pre></span><pre>        &gt;&gt;&gt; e.to_python('doesnotexist@colorstudy.com')</pre></div>
<div class="nocov"><span class="num"><pre>1287</pre></span><pre>        'doesnotexist@colorstudy.com'</pre></div>
<div class="nocov"><span class="num"><pre>1288</pre></span><pre>        &gt;&gt;&gt; e.to_python('test@forums.nyu.edu')</pre></div>
<div class="nocov"><span class="num"><pre>1289</pre></span><pre>        'test@forums.nyu.edu'</pre></div>
<div class="nocov"><span class="num"><pre>1290</pre></span><pre>        &gt;&gt;&gt; # NOTE: If you do not have PyDNS installed this example won't work:</pre></div>
<div class="nocov"><span class="num"><pre>1291</pre></span><pre>        &gt;&gt;&gt; e.to_python('test@thisdomaindoesnotexistithinkforsure.com')</pre></div>
<div class="nocov"><span class="num"><pre>1292</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1293</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1294</pre></span><pre>        Invalid: The domain of the email address does not exist (the portion after the @: thisdomaindoesnotexistithinkforsure.com)</pre></div>
<div class="nocov"><span class="num"><pre>1295</pre></span><pre>        &gt;&gt;&gt; e.to_python(u'test@google.com')</pre></div>
<div class="nocov"><span class="num"><pre>1296</pre></span><pre>        u'test@google.com'</pre></div>
<div class="nocov"><span class="num"><pre>1297</pre></span><pre>        &gt;&gt;&gt; e = Email(not_empty=False)</pre></div>
<div class="nocov"><span class="num"><pre>1298</pre></span><pre>        &gt;&gt;&gt; e.to_python('')</pre></div>
<div class="skip"><span class="num"><pre>1299</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1300</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>1301</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1302</pre></span><pre>    resolve_domain = False</pre></div>
<div class="skip"><span class="num"><pre>1303</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1304</pre></span><pre>    usernameRE = re.compile(r&quot;^[^ \t\n\r@&lt;&gt;()]+$&quot;, re.I)</pre></div>
<div class="nocov"><span class="num"><pre>1305</pre></span><pre>    domainRE = re.compile(r'''</pre></div>
<div class="nocov"><span class="num"><pre>1306</pre></span><pre>        ^(?:[a-z0-9][a-z0-9\-]{0,62}\.)+ # (sub)domain - alpha followed by 62max chars (63 total)</pre></div>
<div class="nocov"><span class="num"><pre>1307</pre></span><pre>        [a-z]{2,}$                       # TLD</pre></div>
<div class="nocov"><span class="num"><pre>1308</pre></span><pre>    ''', re.I | re.VERBOSE)</pre></div>
<div class="skip"><span class="num"><pre>1309</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1310</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre>1311</pre></span><pre>        'empty': _('Please enter an email address'),</pre></div>
<div class="nocov"><span class="num"><pre>1312</pre></span><pre>        'noAt': _('An email address must contain a single @'),</pre></div>
<div class="nocov"><span class="num"><pre>1313</pre></span><pre>        'badUsername': _('The username portion of the email address is invalid (the portion before the @: %(username)s)'),</pre></div>
<div class="nocov"><span class="num"><pre>1314</pre></span><pre>        'socketError': _('An error occured when trying to connect to the server: %(error)s'),</pre></div>
<div class="nocov"><span class="num"><pre>1315</pre></span><pre>        'badDomain': _('The domain portion of the email address is invalid (the portion after the @: %(domain)s)'),</pre></div>
<div class="nocov"><span class="num"><pre>1316</pre></span><pre>        'domainDoesNotExist': _('The domain of the email address does not exist (the portion after the @: %(domain)s)'),</pre></div>
<div class="nocov"><span class="num"><pre>1317</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre>1318</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1319</pre></span><pre>    def __init__(self, *args, **kw):</pre></div>
<div class="cov"><span class="num"><pre>1320</pre></span><pre>        FancyValidator.__init__(self, *args, **kw)</pre></div>
<div class="cov"><span class="num"><pre>1321</pre></span><pre>        if self.resolve_domain:</pre></div>
<div class="nocov"><span class="num"><pre>1322</pre></span><pre>            if not have_dns:</pre></div>
<div class="nocov"><span class="num"><pre>1323</pre></span><pre>                import warnings</pre></div>
<div class="nocov"><span class="num"><pre>1324</pre></span><pre>                warnings.warn(</pre></div>
<div class="nocov"><span class="num"><pre>1325</pre></span><pre>                    &quot;pyDNS &lt;http://pydns.sf.net&gt; is not installed on &quot;</pre></div>
<div class="nocov"><span class="num"><pre>1326</pre></span><pre>                    &quot;your system (or the DNS package cannot be found).  &quot;</pre></div>
<div class="nocov"><span class="num"><pre>1327</pre></span><pre>                    &quot;I cannot resolve domain names in addresses&quot;)</pre></div>
<div class="nocov"><span class="num"><pre>1328</pre></span><pre>                raise ImportError, &quot;no module named DNS&quot;</pre></div>
<div class="skip"><span class="num"><pre>1329</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1330</pre></span><pre>    def validate_python(self, value, state):</pre></div>
<div class="cov"><span class="num"><pre>1331</pre></span><pre>        if not value:</pre></div>
<div class="nocov"><span class="num"><pre>1332</pre></span><pre>            raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>1333</pre></span><pre>                self.message('empty', state),</pre></div>
<div class="nocov"><span class="num"><pre>1334</pre></span><pre>                value, state)</pre></div>
<div class="cov"><span class="num"><pre>1335</pre></span><pre>        value = value.strip()</pre></div>
<div class="cov"><span class="num"><pre>1336</pre></span><pre>        splitted = value.split('@', 1)</pre></div>
<div class="cov"><span class="num"><pre>1337</pre></span><pre>        try:</pre></div>
<div class="cov"><span class="num"><pre>1338</pre></span><pre>            username, domain=splitted</pre></div>
<div class="nocov"><span class="num"><pre>1339</pre></span><pre>        except ValueError:</pre></div>
<div class="nocov"><span class="num"><pre>1340</pre></span><pre>            raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>1341</pre></span><pre>                self.message('noAt', state),</pre></div>
<div class="nocov"><span class="num"><pre>1342</pre></span><pre>                value, state)</pre></div>
<div class="cov"><span class="num"><pre>1343</pre></span><pre>        if not self.usernameRE.search(username):</pre></div>
<div class="nocov"><span class="num"><pre>1344</pre></span><pre>            raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>1345</pre></span><pre>                self.message('badUsername', state,</pre></div>
<div class="nocov"><span class="num"><pre>1346</pre></span><pre>                             username=username),</pre></div>
<div class="nocov"><span class="num"><pre>1347</pre></span><pre>                value, state)</pre></div>
<div class="cov"><span class="num"><pre>1348</pre></span><pre>        if not self.domainRE.search(domain):</pre></div>
<div class="nocov"><span class="num"><pre>1349</pre></span><pre>            raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>1350</pre></span><pre>                self.message('badDomain', state,</pre></div>
<div class="nocov"><span class="num"><pre>1351</pre></span><pre>                             domain=domain),</pre></div>
<div class="nocov"><span class="num"><pre>1352</pre></span><pre>                value, state)</pre></div>
<div class="cov"><span class="num"><pre>1353</pre></span><pre>        if self.resolve_domain:</pre></div>
<div class="nocov"><span class="num"><pre>1354</pre></span><pre>            assert have_dns, &quot;pyDNS should be available&quot;</pre></div>
<div class="nocov"><span class="num"><pre>1355</pre></span><pre>            try:</pre></div>
<div class="nocov"><span class="num"><pre>1356</pre></span><pre>                a=DNS.DnsRequest(domain, qtype='mx').req().answers</pre></div>
<div class="nocov"><span class="num"><pre>1357</pre></span><pre>                if not a:</pre></div>
<div class="nocov"><span class="num"><pre>1358</pre></span><pre>                    a=DNS.DnsRequest(domain, qtype='a').req().answers</pre></div>
<div class="nocov"><span class="num"><pre>1359</pre></span><pre>                dnsdomains=[x['data'] for x in a]</pre></div>
<div class="nocov"><span class="num"><pre>1360</pre></span><pre>            except (socket.error, DNS.DNSError), e:</pre></div>
<div class="nocov"><span class="num"><pre>1361</pre></span><pre>                raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>1362</pre></span><pre>	            self.message('socketError', state, error=e),</pre></div>
<div class="nocov"><span class="num"><pre>1363</pre></span><pre>		    value, state)</pre></div>
<div class="nocov"><span class="num"><pre>1364</pre></span><pre>            if not dnsdomains:</pre></div>
<div class="nocov"><span class="num"><pre>1365</pre></span><pre>                raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>1366</pre></span><pre>                    self.message('domainDoesNotExist', state,</pre></div>
<div class="nocov"><span class="num"><pre>1367</pre></span><pre>                                 domain=domain),</pre></div>
<div class="nocov"><span class="num"><pre>1368</pre></span><pre>                    value, state)</pre></div>
<div class="skip"><span class="num"><pre>1369</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1370</pre></span><pre>    def _to_python(self, value, state):</pre></div>
<div class="cov"><span class="num"><pre>1371</pre></span><pre>        return value.strip()</pre></div>
<div class="skip"><span class="num"><pre>1372</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1373</pre></span><pre>class URL(FancyValidator):</pre></div>
<div class="skip"><span class="num"><pre>1374</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1375</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>1376</pre></span><pre>    Validate a URL, either http://... or https://.  If check_exists</pre></div>
<div class="nocov"><span class="num"><pre>1377</pre></span><pre>    is true, then we'll actually make a request for the page.</pre></div>
<div class="skip"><span class="num"><pre>1378</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1379</pre></span><pre>    If add_http is true, then if no scheme is present we'll add</pre></div>
<div class="nocov"><span class="num"><pre>1380</pre></span><pre>    http://</pre></div>
<div class="skip"><span class="num"><pre>1381</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1382</pre></span><pre>    ::</pre></div>
<div class="skip"><span class="num"><pre>1383</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1384</pre></span><pre>        &gt;&gt;&gt; u = URL(add_http=True)</pre></div>
<div class="nocov"><span class="num"><pre>1385</pre></span><pre>        &gt;&gt;&gt; u.to_python('foo.com')</pre></div>
<div class="nocov"><span class="num"><pre>1386</pre></span><pre>        'http://foo.com'</pre></div>
<div class="nocov"><span class="num"><pre>1387</pre></span><pre>        &gt;&gt;&gt; u.to_python('http://hahaha.ha/bar.html')</pre></div>
<div class="nocov"><span class="num"><pre>1388</pre></span><pre>        'http://hahaha.ha/bar.html'</pre></div>
<div class="nocov"><span class="num"><pre>1389</pre></span><pre>        &gt;&gt;&gt; u.to_python('http://xn--m7r7ml7t24h.com')</pre></div>
<div class="nocov"><span class="num"><pre>1390</pre></span><pre>        'http://xn--m7r7ml7t24h.com'</pre></div>
<div class="nocov"><span class="num"><pre>1391</pre></span><pre>        &gt;&gt;&gt; u.to_python('http://foo.com/test?bar=baz&amp;fleem=morx')</pre></div>
<div class="nocov"><span class="num"><pre>1392</pre></span><pre>        'http://foo.com/test?bar=baz&amp;fleem=morx'</pre></div>
<div class="nocov"><span class="num"><pre>1393</pre></span><pre>        &gt;&gt;&gt; u.to_python('http://foo.com/login?came_from=http%3A%2F%2Ffoo.com%2Ftest')</pre></div>
<div class="nocov"><span class="num"><pre>1394</pre></span><pre>        'http://foo.com/login?came_from=http%3A%2F%2Ffoo.com%2Ftest'</pre></div>
<div class="nocov"><span class="num"><pre>1395</pre></span><pre>        &gt;&gt;&gt; u.to_python('http://foo.com:8000/test.html')</pre></div>
<div class="nocov"><span class="num"><pre>1396</pre></span><pre>        'http://foo.com:8000/test.html'</pre></div>
<div class="nocov"><span class="num"><pre>1397</pre></span><pre>        &gt;&gt;&gt; u.to_python('http://foo.com/something\\nelse')</pre></div>
<div class="nocov"><span class="num"><pre>1398</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1399</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1400</pre></span><pre>        Invalid: That is not a valid URL</pre></div>
<div class="nocov"><span class="num"><pre>1401</pre></span><pre>        &gt;&gt;&gt; u.to_python('https://test.com')</pre></div>
<div class="nocov"><span class="num"><pre>1402</pre></span><pre>        'https://test.com'</pre></div>
<div class="nocov"><span class="num"><pre>1403</pre></span><pre>        &gt;&gt;&gt; u.to_python('http://test')</pre></div>
<div class="nocov"><span class="num"><pre>1404</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1405</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1406</pre></span><pre>        Invalid: You must provide a full domain name (like test.com)</pre></div>
<div class="nocov"><span class="num"><pre>1407</pre></span><pre>        &gt;&gt;&gt; u.to_python('http://test..com')</pre></div>
<div class="nocov"><span class="num"><pre>1408</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1409</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1410</pre></span><pre>        Invalid: That is not a valid URL</pre></div>
<div class="nocov"><span class="num"><pre>1411</pre></span><pre>        &gt;&gt;&gt; u = URL(add_http=False, check_exists=True)</pre></div>
<div class="nocov"><span class="num"><pre>1412</pre></span><pre>        &gt;&gt;&gt; u.to_python('http://google.com')</pre></div>
<div class="nocov"><span class="num"><pre>1413</pre></span><pre>        'http://google.com'</pre></div>
<div class="nocov"><span class="num"><pre>1414</pre></span><pre>        &gt;&gt;&gt; u.to_python('google.com')</pre></div>
<div class="nocov"><span class="num"><pre>1415</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1416</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1417</pre></span><pre>        Invalid: You must start your URL with http://, https://, etc</pre></div>
<div class="nocov"><span class="num"><pre>1418</pre></span><pre>        &gt;&gt;&gt; u.to_python('http://ianbicking.org/doesnotexist.html')</pre></div>
<div class="nocov"><span class="num"><pre>1419</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1420</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1421</pre></span><pre>        Invalid: The server responded that the page could not be found</pre></div>
<div class="nocov"><span class="num"><pre>1422</pre></span><pre>        &gt;&gt;&gt; u.to_python('http://this.domain.does.not.exist.example.org/test.html')</pre></div>
<div class="nocov"><span class="num"><pre>1423</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1424</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1425</pre></span><pre>        Invalid: An error occured when trying to connect to the server: ...</pre></div>
<div class="skip"><span class="num"><pre>1426</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1427</pre></span><pre>    If you want to allow addresses without a TLD (e.g., ``localhost``) you can do::</pre></div>
<div class="skip"><span class="num"><pre>1428</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1429</pre></span><pre>        &gt;&gt;&gt; URL(require_tld=False).to_python('http://localhost')</pre></div>
<div class="nocov"><span class="num"><pre>1430</pre></span><pre>        'http://localhost'</pre></div>
<div class="skip"><span class="num"><pre>1431</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1432</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>1433</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1434</pre></span><pre>    check_exists = False</pre></div>
<div class="nocov"><span class="num"><pre>1435</pre></span><pre>    add_http = True</pre></div>
<div class="nocov"><span class="num"><pre>1436</pre></span><pre>    require_tld = True</pre></div>
<div class="skip"><span class="num"><pre>1437</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1438</pre></span><pre>    url_re = re.compile(r'''</pre></div>
<div class="nocov"><span class="num"><pre>1439</pre></span><pre>        ^(http|https)://</pre></div>
<div class="nocov"><span class="num"><pre>1440</pre></span><pre>        (?:[%:\w]*@)?                           # authenticator</pre></div>
<div class="nocov"><span class="num"><pre>1441</pre></span><pre>        (?P&lt;domain&gt;[a-z0-9][a-z0-9\-]{1,62}\.)* # (sub)domain - alpha followed by 62max chars (63 total)</pre></div>
<div class="nocov"><span class="num"><pre>1442</pre></span><pre>        (?P&lt;tld&gt;[a-z]{2,})                      # TLD</pre></div>
<div class="nocov"><span class="num"><pre>1443</pre></span><pre>        (?::[0-9]+)?                            # port</pre></div>
<div class="skip"><span class="num"><pre>1444</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>1445</pre></span><pre>        # files/delims/etc</pre></div>
<div class="nocov"><span class="num"><pre>1446</pre></span><pre>        (?P&lt;path&gt;/[a-z0-9\-\._~:/\?#\[\]@!%\$&amp;\'\(\)\*\+,;=]*)?</pre></div>
<div class="nocov"><span class="num"><pre>1447</pre></span><pre>        $</pre></div>
<div class="nocov"><span class="num"><pre>1448</pre></span><pre>    ''', re.I | re.VERBOSE)</pre></div>
<div class="skip"><span class="num"><pre>1449</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1450</pre></span><pre>    scheme_re = re.compile(r'^[a-zA-Z]+:')</pre></div>
<div class="skip"><span class="num"><pre>1451</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1452</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre>1453</pre></span><pre>        'noScheme': _('You must start your URL with http://, https://, etc'),</pre></div>
<div class="nocov"><span class="num"><pre>1454</pre></span><pre>        'badURL': _('That is not a valid URL'),</pre></div>
<div class="nocov"><span class="num"><pre>1455</pre></span><pre>        'httpError': _('An error occurred when trying to access the URL: %(error)s'),</pre></div>
<div class="nocov"><span class="num"><pre>1456</pre></span><pre>        'socketError': _('An error occured when trying to connect to the server: %(error)s'),</pre></div>
<div class="nocov"><span class="num"><pre>1457</pre></span><pre>        'notFound': _('The server responded that the page could not be found'),</pre></div>
<div class="nocov"><span class="num"><pre>1458</pre></span><pre>        'status': _('The server responded with a bad status code (%(status)s)'),</pre></div>
<div class="nocov"><span class="num"><pre>1459</pre></span><pre>        'noTLD': _('You must provide a full domain name (like %(domain)s.com)'),</pre></div>
<div class="nocov"><span class="num"><pre>1460</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre>1461</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1462</pre></span><pre>    def _to_python(self, value, state):</pre></div>
<div class="cov"><span class="num"><pre>1463</pre></span><pre>        value = value.strip()</pre></div>
<div class="cov"><span class="num"><pre>1464</pre></span><pre>        if self.add_http:</pre></div>
<div class="cov"><span class="num"><pre>1465</pre></span><pre>            if not self.scheme_re.search(value):</pre></div>
<div class="cov"><span class="num"><pre>1466</pre></span><pre>                value = 'http://' + value</pre></div>
<div class="cov"><span class="num"><pre>1467</pre></span><pre>        match = self.scheme_re.search(value)</pre></div>
<div class="cov"><span class="num"><pre>1468</pre></span><pre>        if not match:</pre></div>
<div class="cov"><span class="num"><pre>1469</pre></span><pre>            raise Invalid(</pre></div>
<div class="cov"><span class="num"><pre>1470</pre></span><pre>                self.message('noScheme', state),</pre></div>
<div class="cov"><span class="num"><pre>1471</pre></span><pre>                value, state)</pre></div>
<div class="cov"><span class="num"><pre>1472</pre></span><pre>        value = match.group(0).lower() + value[len(match.group(0)):]</pre></div>
<div class="cov"><span class="num"><pre>1473</pre></span><pre>        match = self.url_re.search(value)</pre></div>
<div class="cov"><span class="num"><pre>1474</pre></span><pre>        if not match:</pre></div>
<div class="cov"><span class="num"><pre>1475</pre></span><pre>            raise Invalid(</pre></div>
<div class="cov"><span class="num"><pre>1476</pre></span><pre>                self.message('badURL', state),</pre></div>
<div class="cov"><span class="num"><pre>1477</pre></span><pre>                value, state)</pre></div>
<div class="cov"><span class="num"><pre>1478</pre></span><pre>        if self.require_tld and not match.group('domain'):</pre></div>
<div class="nocov"><span class="num"><pre>1479</pre></span><pre>            raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>1480</pre></span><pre>                self.message('noTLD', state, domain=match.group('tld')),</pre></div>
<div class="nocov"><span class="num"><pre>1481</pre></span><pre>                value, state)</pre></div>
<div class="cov"><span class="num"><pre>1482</pre></span><pre>        if self.check_exists and (value.startswith('http://')</pre></div>
<div class="cov"><span class="num"><pre>1483</pre></span><pre>                                  or value.startswith('https://')):</pre></div>
<div class="nocov"><span class="num"><pre>1484</pre></span><pre>            self._check_url_exists(value, state)</pre></div>
<div class="cov"><span class="num"><pre>1485</pre></span><pre>        return value</pre></div>
<div class="skip"><span class="num"><pre>1486</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1487</pre></span><pre>    def _check_url_exists(self, url, state):</pre></div>
<div class="nocov"><span class="num"><pre>1488</pre></span><pre>        global httplib, urlparse, socket</pre></div>
<div class="nocov"><span class="num"><pre>1489</pre></span><pre>        if httplib is None:</pre></div>
<div class="nocov"><span class="num"><pre>1490</pre></span><pre>            import httplib</pre></div>
<div class="nocov"><span class="num"><pre>1491</pre></span><pre>        if urlparse is None:</pre></div>
<div class="nocov"><span class="num"><pre>1492</pre></span><pre>            import urlparse</pre></div>
<div class="nocov"><span class="num"><pre>1493</pre></span><pre>        if socket is None:</pre></div>
<div class="nocov"><span class="num"><pre>1494</pre></span><pre>            import socket</pre></div>
<div class="nocov"><span class="num"><pre>1495</pre></span><pre>        scheme, netloc, path, params, query, fragment = urlparse.urlparse(</pre></div>
<div class="nocov"><span class="num"><pre>1496</pre></span><pre>            url, 'http')</pre></div>
<div class="nocov"><span class="num"><pre>1497</pre></span><pre>        if scheme == 'http':</pre></div>
<div class="nocov"><span class="num"><pre>1498</pre></span><pre>            ConnClass = httplib.HTTPConnection</pre></div>
<div class="nocov"><span class="num"><pre>1499</pre></span><pre>        else:</pre></div>
<div class="nocov"><span class="num"><pre>1500</pre></span><pre>            ConnClass = httplib.HTTPSConnection</pre></div>
<div class="nocov"><span class="num"><pre>1501</pre></span><pre>        try:</pre></div>
<div class="nocov"><span class="num"><pre>1502</pre></span><pre>            conn = ConnClass(netloc)</pre></div>
<div class="nocov"><span class="num"><pre>1503</pre></span><pre>            if params:</pre></div>
<div class="nocov"><span class="num"><pre>1504</pre></span><pre>                path += ';' + params</pre></div>
<div class="nocov"><span class="num"><pre>1505</pre></span><pre>            if query:</pre></div>
<div class="nocov"><span class="num"><pre>1506</pre></span><pre>                path += '?' + query</pre></div>
<div class="nocov"><span class="num"><pre>1507</pre></span><pre>            conn.request('HEAD', path)</pre></div>
<div class="nocov"><span class="num"><pre>1508</pre></span><pre>            res = conn.getresponse()</pre></div>
<div class="nocov"><span class="num"><pre>1509</pre></span><pre>        except httplib.HTTPException, e:</pre></div>
<div class="nocov"><span class="num"><pre>1510</pre></span><pre>            raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>1511</pre></span><pre>                self.message('httpError', state, error=e),</pre></div>
<div class="nocov"><span class="num"><pre>1512</pre></span><pre>                state, url)</pre></div>
<div class="nocov"><span class="num"><pre>1513</pre></span><pre>        except socket.error, e:</pre></div>
<div class="nocov"><span class="num"><pre>1514</pre></span><pre>            raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>1515</pre></span><pre>                self.message('socketError', state, error=e),</pre></div>
<div class="nocov"><span class="num"><pre>1516</pre></span><pre>                state, url)</pre></div>
<div class="nocov"><span class="num"><pre>1517</pre></span><pre>        else:</pre></div>
<div class="nocov"><span class="num"><pre>1518</pre></span><pre>            if res.status == 404:</pre></div>
<div class="nocov"><span class="num"><pre>1519</pre></span><pre>                raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>1520</pre></span><pre>                    self.message('notFound', state),</pre></div>
<div class="nocov"><span class="num"><pre>1521</pre></span><pre>                    state, url)</pre></div>
<div class="nocov"><span class="num"><pre>1522</pre></span><pre>            if (res.status &lt; 200</pre></div>
<div class="nocov"><span class="num"><pre>1523</pre></span><pre>                or res.status &gt;= 500):</pre></div>
<div class="nocov"><span class="num"><pre>1524</pre></span><pre>                raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>1525</pre></span><pre>                    self.message('status', state, status=res.status),</pre></div>
<div class="nocov"><span class="num"><pre>1526</pre></span><pre>                    state, url)</pre></div>
<div class="skip"><span class="num"><pre>1527</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>1528</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1529</pre></span><pre>class XRI(FancyValidator):</pre></div>
<div class="nocov"><span class="num"><pre>1530</pre></span><pre>    r&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>1531</pre></span><pre>    Validator for XRIs.</pre></div>
<div class="skip"><span class="num"><pre>1532</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1533</pre></span><pre>    It supports both i-names and i-numbers, of the first version of the XRI</pre></div>
<div class="nocov"><span class="num"><pre>1534</pre></span><pre>    standard.</pre></div>
<div class="skip"><span class="num"><pre>1535</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1536</pre></span><pre>    ::</pre></div>
<div class="skip"><span class="num"><pre>1537</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1538</pre></span><pre>        &gt;&gt;&gt; inames = XRI(xri_type=&quot;i-name&quot;)</pre></div>
<div class="nocov"><span class="num"><pre>1539</pre></span><pre>        &gt;&gt;&gt; inames.to_python(&quot;   =John.Smith &quot;)</pre></div>
<div class="nocov"><span class="num"><pre>1540</pre></span><pre>        '=John.Smith'</pre></div>
<div class="nocov"><span class="num"><pre>1541</pre></span><pre>        &gt;&gt;&gt; inames.to_python(&quot;@Free.Software.Foundation&quot;)</pre></div>
<div class="nocov"><span class="num"><pre>1542</pre></span><pre>        '@Free.Software.Foundation'</pre></div>
<div class="nocov"><span class="num"><pre>1543</pre></span><pre>        &gt;&gt;&gt; inames.to_python(&quot;Python.Software.Foundation&quot;)</pre></div>
<div class="nocov"><span class="num"><pre>1544</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1545</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1546</pre></span><pre>        Invalid: The type of i-name is not defined; it may be either individual or organizational</pre></div>
<div class="nocov"><span class="num"><pre>1547</pre></span><pre>        &gt;&gt;&gt; inames.to_python(&quot;http://example.org&quot;)</pre></div>
<div class="nocov"><span class="num"><pre>1548</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1549</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1550</pre></span><pre>        Invalid: The type of i-name is not defined; it may be either individual or organizational</pre></div>
<div class="nocov"><span class="num"><pre>1551</pre></span><pre>        &gt;&gt;&gt; inames.to_python(&quot;=!2C43.1A9F.B6F6.E8E6&quot;)</pre></div>
<div class="nocov"><span class="num"><pre>1552</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1553</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1554</pre></span><pre>        Invalid: &quot;!2C43.1A9F.B6F6.E8E6&quot; is an invalid i-name</pre></div>
<div class="nocov"><span class="num"><pre>1555</pre></span><pre>        &gt;&gt;&gt; iname_with_schema = XRI(True, xri_type=&quot;i-name&quot;)</pre></div>
<div class="nocov"><span class="num"><pre>1556</pre></span><pre>        &gt;&gt;&gt; iname_with_schema.to_python(&quot;=Richard.Stallman&quot;)</pre></div>
<div class="nocov"><span class="num"><pre>1557</pre></span><pre>        'xri://=Richard.Stallman'</pre></div>
<div class="nocov"><span class="num"><pre>1558</pre></span><pre>        &gt;&gt;&gt; inames.to_python(&quot;=John Smith&quot;)</pre></div>
<div class="nocov"><span class="num"><pre>1559</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1560</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1561</pre></span><pre>        Invalid: &quot;John Smith&quot; is an invalid i-name</pre></div>
<div class="nocov"><span class="num"><pre>1562</pre></span><pre>        &gt;&gt;&gt; inumbers = XRI(xri_type=&quot;i-number&quot;)</pre></div>
<div class="nocov"><span class="num"><pre>1563</pre></span><pre>        &gt;&gt;&gt; inumbers.to_python(&quot;!!1000!de21.4536.2cb2.8074&quot;)</pre></div>
<div class="nocov"><span class="num"><pre>1564</pre></span><pre>        '!!1000!de21.4536.2cb2.8074'</pre></div>
<div class="nocov"><span class="num"><pre>1565</pre></span><pre>        &gt;&gt;&gt; inumbers.to_python(&quot;@!1000.9554.fabd.129c!2847.df3c&quot;)</pre></div>
<div class="nocov"><span class="num"><pre>1566</pre></span><pre>        '@!1000.9554.fabd.129c!2847.df3c'</pre></div>
<div class="skip"><span class="num"><pre>1567</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1568</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>1569</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1570</pre></span><pre>    iname_valid_pattern = re.compile(r&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>1571</pre></span><pre>    ^</pre></div>
<div class="nocov"><span class="num"><pre>1572</pre></span><pre>    [\w]+                  # A global alphanumeric i-name</pre></div>
<div class="nocov"><span class="num"><pre>1573</pre></span><pre>    (\.[\w]+)*             # An i-name with dots</pre></div>
<div class="nocov"><span class="num"><pre>1574</pre></span><pre>    (\*[\w]+(\.[\w]+)*)*   # A community i-name</pre></div>
<div class="nocov"><span class="num"><pre>1575</pre></span><pre>    $</pre></div>
<div class="nocov"><span class="num"><pre>1576</pre></span><pre>    &quot;&quot;&quot;, re.VERBOSE|re.UNICODE)</pre></div>
<div class="skip"><span class="num"><pre>1577</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>1578</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1579</pre></span><pre>    iname_invalid_start = re.compile(r&quot;^[\d\.-]&quot;, re.UNICODE)</pre></div>
<div class="nocov"><span class="num"><pre>1580</pre></span><pre>    &quot;&quot;&quot;@cvar: These characters must not be at the beggining of the i-name&quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>1581</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1582</pre></span><pre>    inumber_pattern = re.compile(r&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>1583</pre></span><pre>    ^</pre></div>
<div class="nocov"><span class="num"><pre>1584</pre></span><pre>    (</pre></div>
<div class="nocov"><span class="num"><pre>1585</pre></span><pre>    [=@]!       # It's a personal or organization i-number</pre></div>
<div class="nocov"><span class="num"><pre>1586</pre></span><pre>    |</pre></div>
<div class="nocov"><span class="num"><pre>1587</pre></span><pre>    !!          # It's a network i-number</pre></div>
<div class="nocov"><span class="num"><pre>1588</pre></span><pre>    )</pre></div>
<div class="nocov"><span class="num"><pre>1589</pre></span><pre>    [\dA-F]{1,4}(\.[\dA-F]{1,4}){0,3}       # A global i-number</pre></div>
<div class="nocov"><span class="num"><pre>1590</pre></span><pre>    (![\dA-F]{1,4}(\.[\dA-F]{1,4}){0,3})*   # Zero or more sub i-numbers</pre></div>
<div class="nocov"><span class="num"><pre>1591</pre></span><pre>    $</pre></div>
<div class="nocov"><span class="num"><pre>1592</pre></span><pre>    &quot;&quot;&quot;, re.VERBOSE|re.IGNORECASE)</pre></div>
<div class="skip"><span class="num"><pre>1593</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1594</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre>1595</pre></span><pre>        'noType': _(&quot;The type of i-name is not defined; it may be either individual or organizational&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>1596</pre></span><pre>        'repeatedChar': _(&quot;Dots and dashes may not be repeated consecutively&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>1597</pre></span><pre>        'badIname': _('&quot;%(iname)s&quot; is an invalid i-name'),</pre></div>
<div class="nocov"><span class="num"><pre>1598</pre></span><pre>        'badInameStart': _(&quot;i-names may not start with numbers nor punctuation &quot;</pre></div>
<div class="nocov"><span class="num"><pre>1599</pre></span><pre>                           &quot;marks&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>1600</pre></span><pre>        'badInumber': _('&quot;%(inumber)s&quot; is an invalid i-number'),</pre></div>
<div class="nocov"><span class="num"><pre>1601</pre></span><pre>        'badType': _(&quot;The XRI must be a string (not a %(type)s: %(value)r)&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>1602</pre></span><pre>        'badXri': _('&quot;%(xri_type)s&quot; is not a valid type of XRI')</pre></div>
<div class="nocov"><span class="num"><pre>1603</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre>1604</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1605</pre></span><pre>    def __init__(self, add_xri=False, xri_type=&quot;i-name&quot;, **kwargs):</pre></div>
<div class="nocov"><span class="num"><pre>1606</pre></span><pre>        &quot;&quot;&quot;Create an XRI validator.</pre></div>
<div class="skip"><span class="num"><pre>1607</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1608</pre></span><pre>        @param add_xri: Should the schema be added if not present? Officially</pre></div>
<div class="nocov"><span class="num"><pre>1609</pre></span><pre>            it's optional.</pre></div>
<div class="nocov"><span class="num"><pre>1610</pre></span><pre>        @type add_xri: C{bool}</pre></div>
<div class="nocov"><span class="num"><pre>1611</pre></span><pre>        @param xri_type: What type of XRI should be validated? Possible values:</pre></div>
<div class="nocov"><span class="num"><pre>1612</pre></span><pre>            C{i-name} or C{i-number}.</pre></div>
<div class="nocov"><span class="num"><pre>1613</pre></span><pre>        @type xri_type: C{str}</pre></div>
<div class="skip"><span class="num"><pre>1614</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1615</pre></span><pre>        &quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>1616</pre></span><pre>        self.add_xri = add_xri</pre></div>
<div class="cov"><span class="num"><pre>1617</pre></span><pre>        assert xri_type in ('i-name', 'i-number'), \</pre></div>
<div class="cov"><span class="num"><pre>1618</pre></span><pre>                           ('xri_type must be &quot;i-name&quot; or &quot;i-number&quot;')</pre></div>
<div class="cov"><span class="num"><pre>1619</pre></span><pre>        self.xri_type = xri_type</pre></div>
<div class="cov"><span class="num"><pre>1620</pre></span><pre>        super(XRI, self).__init__(**kwargs)</pre></div>
<div class="skip"><span class="num"><pre>1621</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1622</pre></span><pre>    def _to_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre>1623</pre></span><pre>        &quot;&quot;&quot;Prepend the 'xri://' schema if necessary and then remove trailing</pre></div>
<div class="nocov"><span class="num"><pre>1624</pre></span><pre>        spaces&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>1625</pre></span><pre>        value = value.strip()</pre></div>
<div class="cov"><span class="num"><pre>1626</pre></span><pre>        if self.add_xri and not value.startswith(&quot;xri://&quot;):</pre></div>
<div class="cov"><span class="num"><pre>1627</pre></span><pre>            value = &quot;xri://&quot; + value</pre></div>
<div class="cov"><span class="num"><pre>1628</pre></span><pre>        return value</pre></div>
<div class="skip"><span class="num"><pre>1629</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1630</pre></span><pre>    def validate_python(self, value, state=None):</pre></div>
<div class="nocov"><span class="num"><pre>1631</pre></span><pre>        &quot;&quot;&quot;Validate an XRI</pre></div>
<div class="skip"><span class="num"><pre>1632</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1633</pre></span><pre>        @raise Invalid: If at least one of the following conditions in met:</pre></div>
<div class="nocov"><span class="num"><pre>1634</pre></span><pre>            - C{value} is not a string.</pre></div>
<div class="nocov"><span class="num"><pre>1635</pre></span><pre>            - The XRI is not a personal, organizational or network one.</pre></div>
<div class="nocov"><span class="num"><pre>1636</pre></span><pre>            - The relevant validator (i-name or i-number) considers the XRI</pre></div>
<div class="nocov"><span class="num"><pre>1637</pre></span><pre>                is not valid.</pre></div>
<div class="skip"><span class="num"><pre>1638</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1639</pre></span><pre>        &quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>1640</pre></span><pre>        if not (isinstance(value, str) or isinstance(value, unicode)):</pre></div>
<div class="cov"><span class="num"><pre>1641</pre></span><pre>            raise Invalid(self.message(&quot;badType&quot;, state, type=str(type(value)),</pre></div>
<div class="cov"><span class="num"><pre>1642</pre></span><pre>                                       value=value),</pre></div>
<div class="cov"><span class="num"><pre>1643</pre></span><pre>                          value, state)</pre></div>
<div class="skip"><span class="num"><pre>1644</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>1645</pre></span><pre>        # Let's remove the schema, if any</pre></div>
<div class="cov"><span class="num"><pre>1646</pre></span><pre>        if value.startswith(&quot;xri://&quot;):</pre></div>
<div class="cov"><span class="num"><pre>1647</pre></span><pre>            value = value[6:]</pre></div>
<div class="skip"><span class="num"><pre>1648</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>1649</pre></span><pre>        if not value[0] in ('@', '=') and not (self.xri_type == &quot;i-number&quot; \</pre></div>
<div class="cov"><span class="num"><pre>1650</pre></span><pre>        and value[0] == '!'):</pre></div>
<div class="cov"><span class="num"><pre>1651</pre></span><pre>            raise Invalid(self.message(&quot;noType&quot;, state), value, state)</pre></div>
<div class="skip"><span class="num"><pre>1652</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>1653</pre></span><pre>        if self.xri_type == &quot;i-name&quot;:</pre></div>
<div class="cov"><span class="num"><pre>1654</pre></span><pre>            self._validate_iname(value, state)</pre></div>
<div class="cov"><span class="num"><pre>1655</pre></span><pre>        else:</pre></div>
<div class="cov"><span class="num"><pre>1656</pre></span><pre>            self._validate_inumber(value, state)</pre></div>
<div class="skip"><span class="num"><pre>1657</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1658</pre></span><pre>    def _validate_iname(self, iname, state):</pre></div>
<div class="nocov"><span class="num"><pre>1659</pre></span><pre>        &quot;&quot;&quot;Validate an i-name&quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>1660</pre></span><pre>        # The type is not required here:</pre></div>
<div class="cov"><span class="num"><pre>1661</pre></span><pre>        iname = iname[1:]</pre></div>
<div class="cov"><span class="num"><pre>1662</pre></span><pre>        if &quot;..&quot; in iname or &quot;--&quot; in iname:</pre></div>
<div class="cov"><span class="num"><pre>1663</pre></span><pre>            raise Invalid(self.message(&quot;repeatedChar&quot;, state), iname, state)</pre></div>
<div class="cov"><span class="num"><pre>1664</pre></span><pre>        if self.iname_invalid_start.match(iname):</pre></div>
<div class="cov"><span class="num"><pre>1665</pre></span><pre>            raise Invalid(self.message(&quot;badInameStart&quot;, state), iname, state)</pre></div>
<div class="cov"><span class="num"><pre>1666</pre></span><pre>        if not self.iname_valid_pattern.match(iname) or &quot;_&quot; in iname:</pre></div>
<div class="cov"><span class="num"><pre>1667</pre></span><pre>            raise Invalid(self.message(&quot;badIname&quot;, state, iname=iname), iname,</pre></div>
<div class="cov"><span class="num"><pre>1668</pre></span><pre>                          state)</pre></div>
<div class="skip"><span class="num"><pre>1669</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1670</pre></span><pre>    def _validate_inumber(self, inumber, state):</pre></div>
<div class="nocov"><span class="num"><pre>1671</pre></span><pre>        &quot;&quot;&quot;Validate an i-number&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>1672</pre></span><pre>        if not self.__class__.inumber_pattern.match(inumber):</pre></div>
<div class="nocov"><span class="num"><pre>1673</pre></span><pre>            raise Invalid(self.message(&quot;badInumber&quot;, state, inumber=inumber,</pre></div>
<div class="nocov"><span class="num"><pre>1674</pre></span><pre>                                       value=inumber),</pre></div>
<div class="nocov"><span class="num"><pre>1675</pre></span><pre>                          inumber, state)</pre></div>
<div class="skip"><span class="num"><pre>1676</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>1677</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1678</pre></span><pre>class OpenId(FancyValidator):</pre></div>
<div class="nocov"><span class="num"><pre>1679</pre></span><pre>    r&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>1680</pre></span><pre>    OpenId validator.</pre></div>
<div class="skip"><span class="num"><pre>1681</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1682</pre></span><pre>    ::</pre></div>
<div class="nocov"><span class="num"><pre>1683</pre></span><pre>        &gt;&gt;&gt; v = OpenId(add_schema=True)</pre></div>
<div class="nocov"><span class="num"><pre>1684</pre></span><pre>        &gt;&gt;&gt; v.to_python(' example.net ')</pre></div>
<div class="nocov"><span class="num"><pre>1685</pre></span><pre>        'http://example.net'</pre></div>
<div class="nocov"><span class="num"><pre>1686</pre></span><pre>        &gt;&gt;&gt; v.to_python('@TurboGears')</pre></div>
<div class="nocov"><span class="num"><pre>1687</pre></span><pre>        'xri://@TurboGears'</pre></div>
<div class="nocov"><span class="num"><pre>1688</pre></span><pre>        &gt;&gt;&gt; w = OpenId(add_schema=False)</pre></div>
<div class="nocov"><span class="num"><pre>1689</pre></span><pre>        &gt;&gt;&gt; w.to_python(' example.net ')</pre></div>
<div class="nocov"><span class="num"><pre>1690</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1691</pre></span><pre>        ...</pre></div>
<div class="nocov"><span class="num"><pre>1692</pre></span><pre>        Invalid: &quot;example.net&quot; is not a valid OpenId (it is neither an URL nor an XRI)</pre></div>
<div class="nocov"><span class="num"><pre>1693</pre></span><pre>        &gt;&gt;&gt; w.to_python('!!1000')</pre></div>
<div class="nocov"><span class="num"><pre>1694</pre></span><pre>        '!!1000'</pre></div>
<div class="nocov"><span class="num"><pre>1695</pre></span><pre>        &gt;&gt;&gt; w.to_python('look@me.com')</pre></div>
<div class="nocov"><span class="num"><pre>1696</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1697</pre></span><pre>        ...</pre></div>
<div class="nocov"><span class="num"><pre>1698</pre></span><pre>        Invalid: &quot;look@me.com&quot; is not a valid OpenId (it is neither an URL nor an XRI)</pre></div>
<div class="skip"><span class="num"><pre>1699</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1700</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>1701</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1702</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre>1703</pre></span><pre>        'badId': _('&quot;%(id)s&quot; is not a valid OpenId (it is neither an URL nor an XRI)')</pre></div>
<div class="nocov"><span class="num"><pre>1704</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre>1705</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1706</pre></span><pre>    def __init__(self, add_schema=False, **kwargs):</pre></div>
<div class="nocov"><span class="num"><pre>1707</pre></span><pre>        &quot;&quot;&quot;Create an OpenId validator.</pre></div>
<div class="skip"><span class="num"><pre>1708</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1709</pre></span><pre>        @param add_schema: Should the schema be added if not present?</pre></div>
<div class="nocov"><span class="num"><pre>1710</pre></span><pre>        @type add_schema: C{bool}</pre></div>
<div class="skip"><span class="num"><pre>1711</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1712</pre></span><pre>        &quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>1713</pre></span><pre>        self.url_validator = URL(add_http=add_schema)</pre></div>
<div class="cov"><span class="num"><pre>1714</pre></span><pre>        self.iname_validator = XRI(add_schema, xri_type=&quot;i-name&quot;)</pre></div>
<div class="cov"><span class="num"><pre>1715</pre></span><pre>        self.inumber_validator = XRI(add_schema, xri_type=&quot;i-number&quot;)</pre></div>
<div class="skip"><span class="num"><pre>1716</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1717</pre></span><pre>    def _to_python(self, value, state):</pre></div>
<div class="cov"><span class="num"><pre>1718</pre></span><pre>        value = value.strip()</pre></div>
<div class="cov"><span class="num"><pre>1719</pre></span><pre>        try:</pre></div>
<div class="cov"><span class="num"><pre>1720</pre></span><pre>            return self.url_validator.to_python(value, state)</pre></div>
<div class="cov"><span class="num"><pre>1721</pre></span><pre>        except Invalid:</pre></div>
<div class="cov"><span class="num"><pre>1722</pre></span><pre>            try:</pre></div>
<div class="cov"><span class="num"><pre>1723</pre></span><pre>                return self.iname_validator.to_python(value, state)</pre></div>
<div class="cov"><span class="num"><pre>1724</pre></span><pre>            except Invalid:</pre></div>
<div class="cov"><span class="num"><pre>1725</pre></span><pre>                try:</pre></div>
<div class="cov"><span class="num"><pre>1726</pre></span><pre>                    return self.inumber_validator.to_python(value, state)</pre></div>
<div class="cov"><span class="num"><pre>1727</pre></span><pre>                except Invalid:</pre></div>
<div class="cov"><span class="num"><pre>1728</pre></span><pre>                    pass</pre></div>
<div class="skip"><span class="num"><pre>1729</pre></span><pre>        # It's not an OpenId!</pre></div>
<div class="cov"><span class="num"><pre>1730</pre></span><pre>        raise Invalid(self.message(&quot;badId&quot;, state, id=value), value, state)</pre></div>
<div class="skip"><span class="num"><pre>1731</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1732</pre></span><pre>    def validate_python(self, value, state):</pre></div>
<div class="cov"><span class="num"><pre>1733</pre></span><pre>        self._to_python(value, state)</pre></div>
<div class="skip"><span class="num"><pre>1734</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>1735</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1736</pre></span><pre>def StateProvince(*kw, **kwargs):</pre></div>
<div class="nocov"><span class="num"><pre>1737</pre></span><pre>    warnings.warn(&quot;please use formencode.national.USStateProvince&quot;, DeprecationWarning, stacklevel=2)</pre></div>
<div class="nocov"><span class="num"><pre>1738</pre></span><pre>    from formencode.national import USStateProvince</pre></div>
<div class="nocov"><span class="num"><pre>1739</pre></span><pre>    return USStateProvince(*kw, **kwargs)</pre></div>
<div class="skip"><span class="num"><pre>1740</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1741</pre></span><pre>def PhoneNumber(*kw, **kwargs):</pre></div>
<div class="nocov"><span class="num"><pre>1742</pre></span><pre>    warnings.warn(&quot;please use formencode.national.USPhoneNumber&quot;, DeprecationWarning, stacklevel=2)</pre></div>
<div class="nocov"><span class="num"><pre>1743</pre></span><pre>    from formencode.national import USPhoneNumber</pre></div>
<div class="nocov"><span class="num"><pre>1744</pre></span><pre>    return USPhoneNumber(*kw, **kwargs)</pre></div>
<div class="skip"><span class="num"><pre>1745</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1746</pre></span><pre>def IPhoneNumberValidator(*kw, **kwargs):</pre></div>
<div class="nocov"><span class="num"><pre>1747</pre></span><pre>    warnings.warn(&quot;please use formencode.national.InternationalPhoneNumber&quot;, DeprecationWarning, stacklevel=2)</pre></div>
<div class="nocov"><span class="num"><pre>1748</pre></span><pre>    from formencode.national import InternationalPhoneNumber</pre></div>
<div class="nocov"><span class="num"><pre>1749</pre></span><pre>    return InternationalPhoneNumber(*kw, **kwargs)</pre></div>
<div class="skip"><span class="num"><pre>1750</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1751</pre></span><pre>class FieldStorageUploadConverter(FancyValidator):</pre></div>
<div class="nocov"><span class="num"><pre>1752</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>1753</pre></span><pre>    Handles cgi.FieldStorage instances that are file uploads.</pre></div>
<div class="skip"><span class="num"><pre>1754</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1755</pre></span><pre>    This doesn't do any conversion, but it can detect empty upload</pre></div>
<div class="nocov"><span class="num"><pre>1756</pre></span><pre>    fields (which appear like normal fields, but have no filename when</pre></div>
<div class="nocov"><span class="num"><pre>1757</pre></span><pre>    no upload was given).</pre></div>
<div class="nocov"><span class="num"><pre>1758</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>1759</pre></span><pre>    def _to_python(self, value, state=None):</pre></div>
<div class="nocov"><span class="num"><pre>1760</pre></span><pre>        if isinstance(value, cgi.FieldStorage):</pre></div>
<div class="nocov"><span class="num"><pre>1761</pre></span><pre>            if getattr(value, 'filename', None):</pre></div>
<div class="nocov"><span class="num"><pre>1762</pre></span><pre>                return value</pre></div>
<div class="nocov"><span class="num"><pre>1763</pre></span><pre>            raise Invalid('invalid', value, state)</pre></div>
<div class="nocov"><span class="num"><pre>1764</pre></span><pre>        else:</pre></div>
<div class="nocov"><span class="num"><pre>1765</pre></span><pre>            return value</pre></div>
<div class="skip"><span class="num"><pre>1766</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1767</pre></span><pre>    def is_empty(self, value):</pre></div>
<div class="nocov"><span class="num"><pre>1768</pre></span><pre>        if isinstance(value, cgi.FieldStorage):</pre></div>
<div class="nocov"><span class="num"><pre>1769</pre></span><pre>            return not bool(getattr(value, 'filename', None))</pre></div>
<div class="nocov"><span class="num"><pre>1770</pre></span><pre>        return FancyValidator.is_empty(self, value)</pre></div>
<div class="skip"><span class="num"><pre>1771</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1772</pre></span><pre>class FileUploadKeeper(FancyValidator):</pre></div>
<div class="nocov"><span class="num"><pre>1773</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>1774</pre></span><pre>    Takes two inputs (a dictionary with keys ``static`` and</pre></div>
<div class="nocov"><span class="num"><pre>1775</pre></span><pre>    ``upload``) and converts them into one value on the Python side (a</pre></div>
<div class="nocov"><span class="num"><pre>1776</pre></span><pre>    dictionary with ``filename`` and ``content`` keys).  The upload</pre></div>
<div class="nocov"><span class="num"><pre>1777</pre></span><pre>    takes priority over the static value.  The filename may be None if</pre></div>
<div class="nocov"><span class="num"><pre>1778</pre></span><pre>    it can't be discovered.</pre></div>
<div class="skip"><span class="num"><pre>1779</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1780</pre></span><pre>    Handles uploads of both text and ``cgi.FieldStorage`` upload</pre></div>
<div class="nocov"><span class="num"><pre>1781</pre></span><pre>    values.</pre></div>
<div class="skip"><span class="num"><pre>1782</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1783</pre></span><pre>    This is basically for use when you have an upload field, and you</pre></div>
<div class="nocov"><span class="num"><pre>1784</pre></span><pre>    want to keep the upload around even if the rest of the form</pre></div>
<div class="nocov"><span class="num"><pre>1785</pre></span><pre>    submission fails.  When converting *back* to the form submission,</pre></div>
<div class="nocov"><span class="num"><pre>1786</pre></span><pre>    there may be extra values ``'original_filename'`` and</pre></div>
<div class="nocov"><span class="num"><pre>1787</pre></span><pre>    ``'original_content'``, which may want to use in your form to show</pre></div>
<div class="nocov"><span class="num"><pre>1788</pre></span><pre>    the user you still have their content around.</pre></div>
<div class="skip"><span class="num"><pre>1789</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1790</pre></span><pre>    To use this, make sure you are using variabledecode, then use</pre></div>
<div class="nocov"><span class="num"><pre>1791</pre></span><pre>    something like::</pre></div>
<div class="skip"><span class="num"><pre>1792</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1793</pre></span><pre>      &lt;input type=&quot;file&quot; name=&quot;myfield.upload&quot;&gt;</pre></div>
<div class="nocov"><span class="num"><pre>1794</pre></span><pre>      &lt;input type=&quot;hidden&quot; name=&quot;myfield.static&quot;&gt;</pre></div>
<div class="skip"><span class="num"><pre>1795</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1796</pre></span><pre>    Then in your scheme::</pre></div>
<div class="skip"><span class="num"><pre>1797</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1798</pre></span><pre>      class MyScheme(Scheme):</pre></div>
<div class="nocov"><span class="num"><pre>1799</pre></span><pre>          myfield = FileUploadKeeper()</pre></div>
<div class="skip"><span class="num"><pre>1800</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1801</pre></span><pre>    Note that big file uploads mean big hidden fields, and lots of</pre></div>
<div class="nocov"><span class="num"><pre>1802</pre></span><pre>    bytes passed back and forth in the case of an error.</pre></div>
<div class="nocov"><span class="num"><pre>1803</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>1804</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1805</pre></span><pre>    upload_key = 'upload'</pre></div>
<div class="nocov"><span class="num"><pre>1806</pre></span><pre>    static_key = 'static'</pre></div>
<div class="skip"><span class="num"><pre>1807</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1808</pre></span><pre>    def _to_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre>1809</pre></span><pre>        upload = value.get(self.upload_key)</pre></div>
<div class="nocov"><span class="num"><pre>1810</pre></span><pre>        static = value.get(self.static_key, '').strip()</pre></div>
<div class="nocov"><span class="num"><pre>1811</pre></span><pre>        filename = content = None</pre></div>
<div class="nocov"><span class="num"><pre>1812</pre></span><pre>        if isinstance(upload, cgi.FieldStorage):</pre></div>
<div class="nocov"><span class="num"><pre>1813</pre></span><pre>            filename = upload.filename</pre></div>
<div class="nocov"><span class="num"><pre>1814</pre></span><pre>            content = upload.value</pre></div>
<div class="nocov"><span class="num"><pre>1815</pre></span><pre>        elif isinstance(upload, basestring) and upload:</pre></div>
<div class="nocov"><span class="num"><pre>1816</pre></span><pre>            filename = None</pre></div>
<div class="skip"><span class="num"><pre>1817</pre></span><pre>            # @@: Should this encode upload if it is unicode?</pre></div>
<div class="nocov"><span class="num"><pre>1818</pre></span><pre>            content = upload</pre></div>
<div class="nocov"><span class="num"><pre>1819</pre></span><pre>        if not content and static:</pre></div>
<div class="nocov"><span class="num"><pre>1820</pre></span><pre>            filename, content = static.split(None, 1)</pre></div>
<div class="nocov"><span class="num"><pre>1821</pre></span><pre>            if filename == '-':</pre></div>
<div class="nocov"><span class="num"><pre>1822</pre></span><pre>                filename = ''</pre></div>
<div class="nocov"><span class="num"><pre>1823</pre></span><pre>            else:</pre></div>
<div class="nocov"><span class="num"><pre>1824</pre></span><pre>                filename = filename.decode('base64')</pre></div>
<div class="nocov"><span class="num"><pre>1825</pre></span><pre>            content = content.decode('base64')</pre></div>
<div class="nocov"><span class="num"><pre>1826</pre></span><pre>        return {'filename': filename, 'content': content}</pre></div>
<div class="skip"><span class="num"><pre>1827</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1828</pre></span><pre>    def _from_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre>1829</pre></span><pre>        filename = value.get('filename', '')</pre></div>
<div class="nocov"><span class="num"><pre>1830</pre></span><pre>        content = value.get('content', '')</pre></div>
<div class="nocov"><span class="num"><pre>1831</pre></span><pre>        if filename or content:</pre></div>
<div class="nocov"><span class="num"><pre>1832</pre></span><pre>            result = self.pack_content(filename, content)</pre></div>
<div class="nocov"><span class="num"><pre>1833</pre></span><pre>            return {self.upload_key: '',</pre></div>
<div class="nocov"><span class="num"><pre>1834</pre></span><pre>                    self.static_key: result,</pre></div>
<div class="nocov"><span class="num"><pre>1835</pre></span><pre>                    'original_filename': filename,</pre></div>
<div class="nocov"><span class="num"><pre>1836</pre></span><pre>                    'original_content': content}</pre></div>
<div class="nocov"><span class="num"><pre>1837</pre></span><pre>        else:</pre></div>
<div class="nocov"><span class="num"><pre>1838</pre></span><pre>            return {self.upload_key: '',</pre></div>
<div class="nocov"><span class="num"><pre>1839</pre></span><pre>                    self.static_key: ''}</pre></div>
<div class="skip"><span class="num"><pre>1840</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1841</pre></span><pre>    def pack_content(self, filename, content):</pre></div>
<div class="nocov"><span class="num"><pre>1842</pre></span><pre>        enc_filename = self.base64encode(filename) or '-'</pre></div>
<div class="nocov"><span class="num"><pre>1843</pre></span><pre>        enc_content = (content or '').encode('base64')</pre></div>
<div class="nocov"><span class="num"><pre>1844</pre></span><pre>        result = '%s %s' % (enc_filename, enc_content)</pre></div>
<div class="nocov"><span class="num"><pre>1845</pre></span><pre>        return result</pre></div>
<div class="skip"><span class="num"><pre>1846</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1847</pre></span><pre>class DateConverter(FancyValidator):</pre></div>
<div class="skip"><span class="num"><pre>1848</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1849</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>1850</pre></span><pre>    Validates and converts a string date, like mm/yy, dd/mm/yy,</pre></div>
<div class="nocov"><span class="num"><pre>1851</pre></span><pre>    dd-mm-yy, etc.  Using ``month_style`` you can support</pre></div>
<div class="nocov"><span class="num"><pre>1852</pre></span><pre>    ``'mm/dd/yyyy'`` or ``'dd/mm/yyyy'``.  Only these two general</pre></div>
<div class="nocov"><span class="num"><pre>1853</pre></span><pre>    styles are supported.</pre></div>
<div class="skip"><span class="num"><pre>1854</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1855</pre></span><pre>    Accepts English month names, also abbreviated.  Returns value as a</pre></div>
<div class="nocov"><span class="num"><pre>1856</pre></span><pre>    datetime object (you can get mx.DateTime objects if you use</pre></div>
<div class="nocov"><span class="num"><pre>1857</pre></span><pre>    ``datetime_module='mxDateTime'``).  Two year dates are assumed to</pre></div>
<div class="nocov"><span class="num"><pre>1858</pre></span><pre>    be within 1950-2020, with dates from 21-49 being ambiguous and</pre></div>
<div class="nocov"><span class="num"><pre>1859</pre></span><pre>    signaling an error.</pre></div>
<div class="skip"><span class="num"><pre>1860</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1861</pre></span><pre>    Use accept_day=False if you just want a month/year (like for a</pre></div>
<div class="nocov"><span class="num"><pre>1862</pre></span><pre>    credit card expiration date).</pre></div>
<div class="skip"><span class="num"><pre>1863</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1864</pre></span><pre>    ::</pre></div>
<div class="skip"><span class="num"><pre>1865</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1866</pre></span><pre>        &gt;&gt;&gt; d = DateConverter()</pre></div>
<div class="nocov"><span class="num"><pre>1867</pre></span><pre>        &gt;&gt;&gt; d.to_python('12/3/09')</pre></div>
<div class="nocov"><span class="num"><pre>1868</pre></span><pre>        datetime.date(2009, 12, 3)</pre></div>
<div class="nocov"><span class="num"><pre>1869</pre></span><pre>        &gt;&gt;&gt; d.to_python('12/3/2009')</pre></div>
<div class="nocov"><span class="num"><pre>1870</pre></span><pre>        datetime.date(2009, 12, 3)</pre></div>
<div class="nocov"><span class="num"><pre>1871</pre></span><pre>        &gt;&gt;&gt; d.to_python('2/30/04')</pre></div>
<div class="nocov"><span class="num"><pre>1872</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1873</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1874</pre></span><pre>        Invalid: That month only has 29 days</pre></div>
<div class="nocov"><span class="num"><pre>1875</pre></span><pre>        &gt;&gt;&gt; d.to_python('13/2/05')</pre></div>
<div class="nocov"><span class="num"><pre>1876</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1877</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1878</pre></span><pre>        Invalid: Please enter a month from 1 to 12</pre></div>
<div class="nocov"><span class="num"><pre>1879</pre></span><pre>        &gt;&gt;&gt; d.to_python('1/1/200')</pre></div>
<div class="nocov"><span class="num"><pre>1880</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>1881</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>1882</pre></span><pre>        Invalid: Please enter a four-digit year after 1899</pre></div>
<div class="skip"><span class="num"><pre>1883</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1884</pre></span><pre>    If you change ``month_style`` you can get European-style dates::</pre></div>
<div class="skip"><span class="num"><pre>1885</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1886</pre></span><pre>        &gt;&gt;&gt; d = DateConverter(month_style='dd/mm/yyyy')</pre></div>
<div class="nocov"><span class="num"><pre>1887</pre></span><pre>        &gt;&gt;&gt; date = d.to_python('12/3/09')</pre></div>
<div class="nocov"><span class="num"><pre>1888</pre></span><pre>        &gt;&gt;&gt; date</pre></div>
<div class="nocov"><span class="num"><pre>1889</pre></span><pre>        datetime.date(2009, 3, 12)</pre></div>
<div class="nocov"><span class="num"><pre>1890</pre></span><pre>        &gt;&gt;&gt; d.from_python(date)</pre></div>
<div class="nocov"><span class="num"><pre>1891</pre></span><pre>        '12/03/2009'</pre></div>
<div class="nocov"><span class="num"><pre>1892</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>1893</pre></span><pre>    ## @@: accepts only US-style dates</pre></div>
<div class="skip"><span class="num"><pre>1894</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1895</pre></span><pre>    accept_day = True</pre></div>
<div class="skip"><span class="num"><pre>1896</pre></span><pre>    # also allowed: 'dd/mm/yyyy'</pre></div>
<div class="nocov"><span class="num"><pre>1897</pre></span><pre>    month_style = 'mm/dd/yyyy'</pre></div>
<div class="skip"><span class="num"><pre>1898</pre></span><pre>    # Use 'datetime' to force the Python 2.3+ datetime module, or</pre></div>
<div class="skip"><span class="num"><pre>1899</pre></span><pre>    # 'mxDateTime' to force the mxDateTime module (None means use</pre></div>
<div class="skip"><span class="num"><pre>1900</pre></span><pre>    # datetime, or if not present mxDateTime)</pre></div>
<div class="nocov"><span class="num"><pre>1901</pre></span><pre>    datetime_module = None</pre></div>
<div class="skip"><span class="num"><pre>1902</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1903</pre></span><pre>    _day_date_re = re.compile(r'^\s*(\d\d?)[\-\./\\](\d\d?|jan|january|feb|febuary|mar|march|apr|april|may|jun|june|jul|july|aug|august|sep|sept|september|oct|october|nov|november|dec|december)[\-\./\\](\d\d\d?\d?)\s*$', re.I)</pre></div>
<div class="nocov"><span class="num"><pre>1904</pre></span><pre>    _month_date_re = re.compile(r'^\s*(\d\d?|jan|january|feb|febuary|mar|march|apr|april|may|jun|june|jul|july|aug|august|sep|sept|september|oct|october|nov|november|dec|december)[\-\./\\](\d\d\d?\d?)\s*$', re.I)</pre></div>
<div class="skip"><span class="num"><pre>1905</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1906</pre></span><pre>    _month_names = {</pre></div>
<div class="nocov"><span class="num"><pre>1907</pre></span><pre>        'jan': 1, 'january': 1,</pre></div>
<div class="nocov"><span class="num"><pre>1908</pre></span><pre>        'feb': 2, 'febuary': 2,</pre></div>
<div class="nocov"><span class="num"><pre>1909</pre></span><pre>        'mar': 3, 'march': 3,</pre></div>
<div class="nocov"><span class="num"><pre>1910</pre></span><pre>        'apr': 4, 'april': 4,</pre></div>
<div class="nocov"><span class="num"><pre>1911</pre></span><pre>        'may': 5,</pre></div>
<div class="nocov"><span class="num"><pre>1912</pre></span><pre>        'jun': 6, 'june': 6,</pre></div>
<div class="nocov"><span class="num"><pre>1913</pre></span><pre>        'jul': 7, 'july': 7,</pre></div>
<div class="nocov"><span class="num"><pre>1914</pre></span><pre>        'aug': 8, 'august': 8,</pre></div>
<div class="nocov"><span class="num"><pre>1915</pre></span><pre>        'sep': 9, 'sept': 9, 'september': 9,</pre></div>
<div class="nocov"><span class="num"><pre>1916</pre></span><pre>        'oct': 10, 'october': 10,</pre></div>
<div class="nocov"><span class="num"><pre>1917</pre></span><pre>        'nov': 11, 'november': 11,</pre></div>
<div class="nocov"><span class="num"><pre>1918</pre></span><pre>        'dec': 12, 'december': 12,</pre></div>
<div class="nocov"><span class="num"><pre>1919</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre>1920</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>1921</pre></span><pre>    ## @@: Feb. should be leap-year aware (but mxDateTime does catch that)</pre></div>
<div class="nocov"><span class="num"><pre>1922</pre></span><pre>    _monthDays = {</pre></div>
<div class="nocov"><span class="num"><pre>1923</pre></span><pre>        1: 31, 2: 29, 3: 31, 4: 30, 5: 31, 6: 30, 7: 31, 8: 31,</pre></div>
<div class="nocov"><span class="num"><pre>1924</pre></span><pre>        9: 30, 10: 31, 11: 30, 12: 31}</pre></div>
<div class="skip"><span class="num"><pre>1925</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1926</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre>1927</pre></span><pre>        'badFormat': _('Please enter the date in the form %(format)s'),</pre></div>
<div class="nocov"><span class="num"><pre>1928</pre></span><pre>        'monthRange': _('Please enter a month from 1 to 12'),</pre></div>
<div class="nocov"><span class="num"><pre>1929</pre></span><pre>        'invalidDay': _('Please enter a valid day'),</pre></div>
<div class="nocov"><span class="num"><pre>1930</pre></span><pre>        'dayRange': _('That month only has %(days)i days'),</pre></div>
<div class="nocov"><span class="num"><pre>1931</pre></span><pre>        'invalidDate': _('That is not a valid day (%(exception)s)'),</pre></div>
<div class="nocov"><span class="num"><pre>1932</pre></span><pre>        'unknownMonthName': _(&quot;Unknown month name: %(month)s&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>1933</pre></span><pre>        'invalidYear': _('Please enter a number for the year'),</pre></div>
<div class="nocov"><span class="num"><pre>1934</pre></span><pre>        'fourDigitYear': _('Please enter a four-digit year after 1899'),</pre></div>
<div class="nocov"><span class="num"><pre>1935</pre></span><pre>        'wrongFormat': _('Please enter the date in the form %(format)s'),</pre></div>
<div class="nocov"><span class="num"><pre>1936</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre>1937</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1938</pre></span><pre>    def __init__(self, *args, **kw):</pre></div>
<div class="cov"><span class="num"><pre>1939</pre></span><pre>        super(DateConverter, self).__init__(*args, **kw)</pre></div>
<div class="cov"><span class="num"><pre>1940</pre></span><pre>        if not self.month_style in ('dd/mm/yyyy', 'mm/dd/yyyy'):</pre></div>
<div class="nocov"><span class="num"><pre>1941</pre></span><pre>            raise TypeError(&quot;Bad month_style: %r&quot; % self.month_style)</pre></div>
<div class="skip"><span class="num"><pre>1942</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1943</pre></span><pre>    def _to_python(self, value, state):</pre></div>
<div class="cov"><span class="num"><pre>1944</pre></span><pre>        if self.accept_day:</pre></div>
<div class="cov"><span class="num"><pre>1945</pre></span><pre>            return self.convert_day(value, state)</pre></div>
<div class="nocov"><span class="num"><pre>1946</pre></span><pre>        else:</pre></div>
<div class="nocov"><span class="num"><pre>1947</pre></span><pre>            return self.convert_month(value, state)</pre></div>
<div class="skip"><span class="num"><pre>1948</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1949</pre></span><pre>    def convert_day(self, value, state):</pre></div>
<div class="cov"><span class="num"><pre>1950</pre></span><pre>        self.assert_string(value, state)</pre></div>
<div class="cov"><span class="num"><pre>1951</pre></span><pre>        match = self._day_date_re.search(value)</pre></div>
<div class="cov"><span class="num"><pre>1952</pre></span><pre>        if not match:</pre></div>
<div class="nocov"><span class="num"><pre>1953</pre></span><pre>            raise Invalid(self.message('badFormat', state,</pre></div>
<div class="nocov"><span class="num"><pre>1954</pre></span><pre>                                       format=self.month_style),</pre></div>
<div class="nocov"><span class="num"><pre>1955</pre></span><pre>                          value, state)</pre></div>
<div class="cov"><span class="num"><pre>1956</pre></span><pre>        day = int(match.group(1))</pre></div>
<div class="cov"><span class="num"><pre>1957</pre></span><pre>        try:</pre></div>
<div class="cov"><span class="num"><pre>1958</pre></span><pre>            month = int(match.group(2))</pre></div>
<div class="nocov"><span class="num"><pre>1959</pre></span><pre>        except TypeError:</pre></div>
<div class="nocov"><span class="num"><pre>1960</pre></span><pre>            month = self.make_month(match.group(2), state)</pre></div>
<div class="cov"><span class="num"><pre>1961</pre></span><pre>        else:</pre></div>
<div class="cov"><span class="num"><pre>1962</pre></span><pre>            if self.month_style == 'mm/dd/yyyy':</pre></div>
<div class="nocov"><span class="num"><pre>1963</pre></span><pre>                month, day = day, month</pre></div>
<div class="cov"><span class="num"><pre>1964</pre></span><pre>        year = self.make_year(match.group(3), state)</pre></div>
<div class="cov"><span class="num"><pre>1965</pre></span><pre>        if month &gt; 12 or month &lt; 1:</pre></div>
<div class="nocov"><span class="num"><pre>1966</pre></span><pre>            raise Invalid(self.message('monthRange', state),</pre></div>
<div class="nocov"><span class="num"><pre>1967</pre></span><pre>                          value, state)</pre></div>
<div class="cov"><span class="num"><pre>1968</pre></span><pre>        if day &lt; 1:</pre></div>
<div class="nocov"><span class="num"><pre>1969</pre></span><pre>            raise Invalid(self.message('invalidDay', state),</pre></div>
<div class="nocov"><span class="num"><pre>1970</pre></span><pre>                          value, state)</pre></div>
<div class="cov"><span class="num"><pre>1971</pre></span><pre>        if self._monthDays[month] &lt; day:</pre></div>
<div class="nocov"><span class="num"><pre>1972</pre></span><pre>            raise Invalid(self.message('dayRange', state,</pre></div>
<div class="nocov"><span class="num"><pre>1973</pre></span><pre>                                       days=self._monthDays[month]),</pre></div>
<div class="nocov"><span class="num"><pre>1974</pre></span><pre>                          value, state)</pre></div>
<div class="cov"><span class="num"><pre>1975</pre></span><pre>        dt_mod = import_datetime(self.datetime_module)</pre></div>
<div class="cov"><span class="num"><pre>1976</pre></span><pre>        try:</pre></div>
<div class="cov"><span class="num"><pre>1977</pre></span><pre>            return datetime_makedate(dt_mod, year, month, day)</pre></div>
<div class="nocov"><span class="num"><pre>1978</pre></span><pre>        except ValueError, v:</pre></div>
<div class="nocov"><span class="num"><pre>1979</pre></span><pre>            raise Invalid(self.message('invalidDate', state,</pre></div>
<div class="nocov"><span class="num"><pre>1980</pre></span><pre>                                       exception=str(v)),</pre></div>
<div class="nocov"><span class="num"><pre>1981</pre></span><pre>                          value, state)</pre></div>
<div class="skip"><span class="num"><pre>1982</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1983</pre></span><pre>    def make_month(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre>1984</pre></span><pre>        try:</pre></div>
<div class="nocov"><span class="num"><pre>1985</pre></span><pre>            return int(value)</pre></div>
<div class="nocov"><span class="num"><pre>1986</pre></span><pre>        except ValueError:</pre></div>
<div class="nocov"><span class="num"><pre>1987</pre></span><pre>            value = value.lower().strip()</pre></div>
<div class="nocov"><span class="num"><pre>1988</pre></span><pre>            if self._month_names.has_key(value):</pre></div>
<div class="nocov"><span class="num"><pre>1989</pre></span><pre>                return self._month_names[value]</pre></div>
<div class="nocov"><span class="num"><pre>1990</pre></span><pre>            else:</pre></div>
<div class="nocov"><span class="num"><pre>1991</pre></span><pre>                raise Invalid(self.message('unknownMonthName', state,</pre></div>
<div class="nocov"><span class="num"><pre>1992</pre></span><pre>                                           month=value),</pre></div>
<div class="nocov"><span class="num"><pre>1993</pre></span><pre>                              value, state)</pre></div>
<div class="skip"><span class="num"><pre>1994</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>1995</pre></span><pre>    def make_year(self, year, state):</pre></div>
<div class="cov"><span class="num"><pre>1996</pre></span><pre>        try:</pre></div>
<div class="cov"><span class="num"><pre>1997</pre></span><pre>            year = int(year)</pre></div>
<div class="nocov"><span class="num"><pre>1998</pre></span><pre>        except ValueError:</pre></div>
<div class="nocov"><span class="num"><pre>1999</pre></span><pre>            raise Invalid(self.message('invalidYear', state),</pre></div>
<div class="nocov"><span class="num"><pre>2000</pre></span><pre>                          year, state)</pre></div>
<div class="cov"><span class="num"><pre>2001</pre></span><pre>        if year &lt;= 20:</pre></div>
<div class="nocov"><span class="num"><pre>2002</pre></span><pre>            year = year + 2000</pre></div>
<div class="cov"><span class="num"><pre>2003</pre></span><pre>        if year &gt;= 50 and year &lt; 100:</pre></div>
<div class="nocov"><span class="num"><pre>2004</pre></span><pre>            year = year + 1900</pre></div>
<div class="cov"><span class="num"><pre>2005</pre></span><pre>        if (year &gt; 20 and year &lt; 50) or (year&gt;99 and year&lt;1900):</pre></div>
<div class="cov"><span class="num"><pre>2006</pre></span><pre>            raise Invalid(self.message('fourDigitYear', state),</pre></div>
<div class="cov"><span class="num"><pre>2007</pre></span><pre>                          year, state)</pre></div>
<div class="cov"><span class="num"><pre>2008</pre></span><pre>        return year</pre></div>
<div class="skip"><span class="num"><pre>2009</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2010</pre></span><pre>    def convert_month(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre>2011</pre></span><pre>        match = self._month_date_re.search(value)</pre></div>
<div class="nocov"><span class="num"><pre>2012</pre></span><pre>        if not match:</pre></div>
<div class="nocov"><span class="num"><pre>2013</pre></span><pre>            raise Invalid(self.message('wrongFormat', state,</pre></div>
<div class="nocov"><span class="num"><pre>2014</pre></span><pre>                                       format='mm/yyyy'),</pre></div>
<div class="nocov"><span class="num"><pre>2015</pre></span><pre>                          value, state)</pre></div>
<div class="nocov"><span class="num"><pre>2016</pre></span><pre>        month = self.make_month(match.group(1), state)</pre></div>
<div class="nocov"><span class="num"><pre>2017</pre></span><pre>        year = self.make_year(match.group(2), state)</pre></div>
<div class="nocov"><span class="num"><pre>2018</pre></span><pre>        if month &gt; 12 or month &lt; 1:</pre></div>
<div class="nocov"><span class="num"><pre>2019</pre></span><pre>            raise Invalid(self.message('monthRange', state),</pre></div>
<div class="nocov"><span class="num"><pre>2020</pre></span><pre>                          value, state)</pre></div>
<div class="nocov"><span class="num"><pre>2021</pre></span><pre>        dt_mod = import_datetime(self.datetime_module)</pre></div>
<div class="nocov"><span class="num"><pre>2022</pre></span><pre>        return datetime_makedate(dt_mod, year, month, 1)</pre></div>
<div class="skip"><span class="num"><pre>2023</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2024</pre></span><pre>    def _from_python(self, value, state):</pre></div>
<div class="cov"><span class="num"><pre>2025</pre></span><pre>        if self.if_empty is not NoDefault and not value:</pre></div>
<div class="nocov"><span class="num"><pre>2026</pre></span><pre>            return ''</pre></div>
<div class="cov"><span class="num"><pre>2027</pre></span><pre>        if self.accept_day:</pre></div>
<div class="cov"><span class="num"><pre>2028</pre></span><pre>            return self.unconvert_day(value, state)</pre></div>
<div class="nocov"><span class="num"><pre>2029</pre></span><pre>        else:</pre></div>
<div class="nocov"><span class="num"><pre>2030</pre></span><pre>            return self.unconvert_month(value, state)</pre></div>
<div class="skip"><span class="num"><pre>2031</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2032</pre></span><pre>    def unconvert_day(self, value, state):</pre></div>
<div class="skip"><span class="num"><pre>2033</pre></span><pre>        # @@ ib: double-check, improve</pre></div>
<div class="cov"><span class="num"><pre>2034</pre></span><pre>        if self.month_style == 'mm/dd/yyyy':</pre></div>
<div class="nocov"><span class="num"><pre>2035</pre></span><pre>            return value.strftime(&quot;%m/%d/%Y&quot;)</pre></div>
<div class="cov"><span class="num"><pre>2036</pre></span><pre>        else:</pre></div>
<div class="cov"><span class="num"><pre>2037</pre></span><pre>            return value.strftime(&quot;%d/%m/%Y&quot;)</pre></div>
<div class="skip"><span class="num"><pre>2038</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2039</pre></span><pre>    def unconvert_month(self, value, state):</pre></div>
<div class="skip"><span class="num"><pre>2040</pre></span><pre>        # @@ ib: double-check, improve</pre></div>
<div class="nocov"><span class="num"><pre>2041</pre></span><pre>        return value.strftime(&quot;%m/%Y&quot;)</pre></div>
<div class="skip"><span class="num"><pre>2042</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2043</pre></span><pre>class TimeConverter(FancyValidator):</pre></div>
<div class="skip"><span class="num"><pre>2044</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2045</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>2046</pre></span><pre>    Converts times in the format HH:MM:SSampm to (h, m, s).</pre></div>
<div class="nocov"><span class="num"><pre>2047</pre></span><pre>    Seconds are optional.</pre></div>
<div class="skip"><span class="num"><pre>2048</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2049</pre></span><pre>    For ampm, set use_ampm = True.  For seconds, use_seconds = True.</pre></div>
<div class="nocov"><span class="num"><pre>2050</pre></span><pre>    Use 'optional' for either of these to make them optional.</pre></div>
<div class="skip"><span class="num"><pre>2051</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2052</pre></span><pre>    Examples::</pre></div>
<div class="skip"><span class="num"><pre>2053</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2054</pre></span><pre>        &gt;&gt;&gt; tim = TimeConverter()</pre></div>
<div class="nocov"><span class="num"><pre>2055</pre></span><pre>        &gt;&gt;&gt; tim.to_python('8:30')</pre></div>
<div class="nocov"><span class="num"><pre>2056</pre></span><pre>        (8, 30)</pre></div>
<div class="nocov"><span class="num"><pre>2057</pre></span><pre>        &gt;&gt;&gt; tim.to_python('20:30')</pre></div>
<div class="nocov"><span class="num"><pre>2058</pre></span><pre>        (20, 30)</pre></div>
<div class="nocov"><span class="num"><pre>2059</pre></span><pre>        &gt;&gt;&gt; tim.to_python('30:00')</pre></div>
<div class="nocov"><span class="num"><pre>2060</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2061</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>2062</pre></span><pre>        Invalid: You must enter an hour in the range 0-23</pre></div>
<div class="nocov"><span class="num"><pre>2063</pre></span><pre>        &gt;&gt;&gt; tim.to_python('13:00pm')</pre></div>
<div class="nocov"><span class="num"><pre>2064</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2065</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>2066</pre></span><pre>        Invalid: You must enter an hour in the range 1-12</pre></div>
<div class="nocov"><span class="num"><pre>2067</pre></span><pre>        &gt;&gt;&gt; tim.to_python('12:-1')</pre></div>
<div class="nocov"><span class="num"><pre>2068</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2069</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>2070</pre></span><pre>        Invalid: You must enter a minute in the range 0-59</pre></div>
<div class="nocov"><span class="num"><pre>2071</pre></span><pre>        &gt;&gt;&gt; tim.to_python('12:02pm')</pre></div>
<div class="nocov"><span class="num"><pre>2072</pre></span><pre>        (12, 2)</pre></div>
<div class="nocov"><span class="num"><pre>2073</pre></span><pre>        &gt;&gt;&gt; tim.to_python('12:02am')</pre></div>
<div class="nocov"><span class="num"><pre>2074</pre></span><pre>        (0, 2)</pre></div>
<div class="nocov"><span class="num"><pre>2075</pre></span><pre>        &gt;&gt;&gt; tim.to_python('1:00PM')</pre></div>
<div class="nocov"><span class="num"><pre>2076</pre></span><pre>        (13, 0)</pre></div>
<div class="nocov"><span class="num"><pre>2077</pre></span><pre>        &gt;&gt;&gt; tim.from_python((13, 0))</pre></div>
<div class="nocov"><span class="num"><pre>2078</pre></span><pre>        '13:00:00'</pre></div>
<div class="nocov"><span class="num"><pre>2079</pre></span><pre>        &gt;&gt;&gt; tim2 = tim(use_ampm=True, use_seconds=False)</pre></div>
<div class="nocov"><span class="num"><pre>2080</pre></span><pre>        &gt;&gt;&gt; tim2.from_python((13, 0))</pre></div>
<div class="nocov"><span class="num"><pre>2081</pre></span><pre>        '1:00pm'</pre></div>
<div class="nocov"><span class="num"><pre>2082</pre></span><pre>        &gt;&gt;&gt; tim2.from_python((0, 0))</pre></div>
<div class="nocov"><span class="num"><pre>2083</pre></span><pre>        '12:00am'</pre></div>
<div class="nocov"><span class="num"><pre>2084</pre></span><pre>        &gt;&gt;&gt; tim2.from_python((12, 0))</pre></div>
<div class="nocov"><span class="num"><pre>2085</pre></span><pre>        '12:00pm'</pre></div>
<div class="skip"><span class="num"><pre>2086</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2087</pre></span><pre>    Examples with ``datetime.time``::</pre></div>
<div class="skip"><span class="num"><pre>2088</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2089</pre></span><pre>        &gt;&gt;&gt; v = TimeConverter(use_datetime=True)</pre></div>
<div class="nocov"><span class="num"><pre>2090</pre></span><pre>        &gt;&gt;&gt; a = v.to_python('18:00')</pre></div>
<div class="nocov"><span class="num"><pre>2091</pre></span><pre>        &gt;&gt;&gt; a</pre></div>
<div class="nocov"><span class="num"><pre>2092</pre></span><pre>        datetime.time(18, 0)</pre></div>
<div class="nocov"><span class="num"><pre>2093</pre></span><pre>        &gt;&gt;&gt; b = v.to_python('30:00')</pre></div>
<div class="nocov"><span class="num"><pre>2094</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2095</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>2096</pre></span><pre>        Invalid: You must enter an hour in the range 0-23</pre></div>
<div class="nocov"><span class="num"><pre>2097</pre></span><pre>        &gt;&gt;&gt; v2 = TimeConverter(prefer_ampm=True, use_datetime=True)</pre></div>
<div class="nocov"><span class="num"><pre>2098</pre></span><pre>        &gt;&gt;&gt; v2.from_python(a)</pre></div>
<div class="nocov"><span class="num"><pre>2099</pre></span><pre>        '6:00:00pm'</pre></div>
<div class="nocov"><span class="num"><pre>2100</pre></span><pre>        &gt;&gt;&gt; v3 = TimeConverter(prefer_ampm=True,</pre></div>
<div class="nocov"><span class="num"><pre>2101</pre></span><pre>        ...                    use_seconds=False, use_datetime=True)</pre></div>
<div class="nocov"><span class="num"><pre>2102</pre></span><pre>        &gt;&gt;&gt; a = v3.to_python('18:00')</pre></div>
<div class="nocov"><span class="num"><pre>2103</pre></span><pre>        &gt;&gt;&gt; a</pre></div>
<div class="nocov"><span class="num"><pre>2104</pre></span><pre>        datetime.time(18, 0)</pre></div>
<div class="nocov"><span class="num"><pre>2105</pre></span><pre>        &gt;&gt;&gt; v3.from_python(a)</pre></div>
<div class="nocov"><span class="num"><pre>2106</pre></span><pre>        '6:00pm'</pre></div>
<div class="nocov"><span class="num"><pre>2107</pre></span><pre>        &gt;&gt;&gt; a = v3.to_python('18:00:00')</pre></div>
<div class="nocov"><span class="num"><pre>2108</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2109</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>2110</pre></span><pre>        Invalid: You may not enter seconds</pre></div>
<div class="nocov"><span class="num"><pre>2111</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>2112</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2113</pre></span><pre>    use_ampm = 'optional'</pre></div>
<div class="nocov"><span class="num"><pre>2114</pre></span><pre>    prefer_ampm = False</pre></div>
<div class="nocov"><span class="num"><pre>2115</pre></span><pre>    use_seconds = 'optional'</pre></div>
<div class="nocov"><span class="num"><pre>2116</pre></span><pre>    use_datetime = False</pre></div>
<div class="skip"><span class="num"><pre>2117</pre></span><pre>    # This can be set to make it prefer mxDateTime:</pre></div>
<div class="nocov"><span class="num"><pre>2118</pre></span><pre>    datetime_module = None</pre></div>
<div class="skip"><span class="num"><pre>2119</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2120</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre>2121</pre></span><pre>        'noAMPM': _('You must indicate AM or PM'),</pre></div>
<div class="nocov"><span class="num"><pre>2122</pre></span><pre>        'tooManyColon': _('There are too many :\'s'),</pre></div>
<div class="nocov"><span class="num"><pre>2123</pre></span><pre>        'noSeconds': _('You may not enter seconds'),</pre></div>
<div class="nocov"><span class="num"><pre>2124</pre></span><pre>        'secondsRequired': _('You must enter seconds'),</pre></div>
<div class="nocov"><span class="num"><pre>2125</pre></span><pre>        'minutesRequired': _('You must enter minutes (after a :)'),</pre></div>
<div class="nocov"><span class="num"><pre>2126</pre></span><pre>        'badNumber': _('The %(part)s value you gave is not a number: %(number)r'),</pre></div>
<div class="nocov"><span class="num"><pre>2127</pre></span><pre>        'badHour': _('You must enter an hour in the range %(range)s'),</pre></div>
<div class="nocov"><span class="num"><pre>2128</pre></span><pre>        'badMinute': _('You must enter a minute in the range 0-59'),</pre></div>
<div class="nocov"><span class="num"><pre>2129</pre></span><pre>        'badSecond': _('You must enter a second in the range 0-59'),</pre></div>
<div class="nocov"><span class="num"><pre>2130</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre>2131</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2132</pre></span><pre>    def _to_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre>2133</pre></span><pre>        result = self._to_python_tuple(value, state)</pre></div>
<div class="nocov"><span class="num"><pre>2134</pre></span><pre>        if self.use_datetime:</pre></div>
<div class="nocov"><span class="num"><pre>2135</pre></span><pre>            dt_mod = import_datetime(self.datetime_module)</pre></div>
<div class="nocov"><span class="num"><pre>2136</pre></span><pre>            time_class = datetime_time(dt_mod)</pre></div>
<div class="nocov"><span class="num"><pre>2137</pre></span><pre>            return time_class(*result)</pre></div>
<div class="nocov"><span class="num"><pre>2138</pre></span><pre>        else:</pre></div>
<div class="nocov"><span class="num"><pre>2139</pre></span><pre>            return result</pre></div>
<div class="skip"><span class="num"><pre>2140</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2141</pre></span><pre>    def _to_python_tuple(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre>2142</pre></span><pre>        time = value.strip()</pre></div>
<div class="nocov"><span class="num"><pre>2143</pre></span><pre>        explicit_ampm = False</pre></div>
<div class="nocov"><span class="num"><pre>2144</pre></span><pre>        if self.use_ampm:</pre></div>
<div class="nocov"><span class="num"><pre>2145</pre></span><pre>            last_two = time[-2:].lower()</pre></div>
<div class="nocov"><span class="num"><pre>2146</pre></span><pre>            if last_two not in ('am', 'pm'):</pre></div>
<div class="nocov"><span class="num"><pre>2147</pre></span><pre>                if self.use_ampm != 'optional':</pre></div>
<div class="nocov"><span class="num"><pre>2148</pre></span><pre>                    raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>2149</pre></span><pre>                        self.message('noAMPM', state),</pre></div>
<div class="nocov"><span class="num"><pre>2150</pre></span><pre>                        value, state)</pre></div>
<div class="nocov"><span class="num"><pre>2151</pre></span><pre>                else:</pre></div>
<div class="nocov"><span class="num"><pre>2152</pre></span><pre>                    offset = 0</pre></div>
<div class="nocov"><span class="num"><pre>2153</pre></span><pre>            else:</pre></div>
<div class="nocov"><span class="num"><pre>2154</pre></span><pre>                explicit_ampm = True</pre></div>
<div class="nocov"><span class="num"><pre>2155</pre></span><pre>                if last_two == 'pm':</pre></div>
<div class="nocov"><span class="num"><pre>2156</pre></span><pre>                    offset = 12</pre></div>
<div class="nocov"><span class="num"><pre>2157</pre></span><pre>                else:</pre></div>
<div class="nocov"><span class="num"><pre>2158</pre></span><pre>                    offset = 0</pre></div>
<div class="nocov"><span class="num"><pre>2159</pre></span><pre>                time = time[:-2]</pre></div>
<div class="nocov"><span class="num"><pre>2160</pre></span><pre>        else:</pre></div>
<div class="nocov"><span class="num"><pre>2161</pre></span><pre>            offset = 0</pre></div>
<div class="nocov"><span class="num"><pre>2162</pre></span><pre>        parts = time.split(':')</pre></div>
<div class="nocov"><span class="num"><pre>2163</pre></span><pre>        if len(parts) &gt; 3:</pre></div>
<div class="nocov"><span class="num"><pre>2164</pre></span><pre>            raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>2165</pre></span><pre>                self.message('tooManyColon', state),</pre></div>
<div class="nocov"><span class="num"><pre>2166</pre></span><pre>                value, state)</pre></div>
<div class="nocov"><span class="num"><pre>2167</pre></span><pre>        if len(parts) == 3 and not self.use_seconds:</pre></div>
<div class="nocov"><span class="num"><pre>2168</pre></span><pre>            raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>2169</pre></span><pre>                self.message('noSeconds', state),</pre></div>
<div class="nocov"><span class="num"><pre>2170</pre></span><pre>                value, state)</pre></div>
<div class="nocov"><span class="num"><pre>2171</pre></span><pre>        if (len(parts) == 2</pre></div>
<div class="nocov"><span class="num"><pre>2172</pre></span><pre>            and self.use_seconds</pre></div>
<div class="nocov"><span class="num"><pre>2173</pre></span><pre>            and self.use_seconds != 'optional'):</pre></div>
<div class="nocov"><span class="num"><pre>2174</pre></span><pre>            raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>2175</pre></span><pre>                self.message('secondsRequired', state),</pre></div>
<div class="nocov"><span class="num"><pre>2176</pre></span><pre>                value, state)</pre></div>
<div class="nocov"><span class="num"><pre>2177</pre></span><pre>        if len(parts) == 1:</pre></div>
<div class="nocov"><span class="num"><pre>2178</pre></span><pre>            raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>2179</pre></span><pre>                self.message('minutesRequired', state),</pre></div>
<div class="nocov"><span class="num"><pre>2180</pre></span><pre>                value, state)</pre></div>
<div class="nocov"><span class="num"><pre>2181</pre></span><pre>        try:</pre></div>
<div class="nocov"><span class="num"><pre>2182</pre></span><pre>            hour = int(parts[0])</pre></div>
<div class="nocov"><span class="num"><pre>2183</pre></span><pre>        except ValueError:</pre></div>
<div class="nocov"><span class="num"><pre>2184</pre></span><pre>            raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>2185</pre></span><pre>                self.message('badNumber', state, number=parts[0], part='hour'),</pre></div>
<div class="nocov"><span class="num"><pre>2186</pre></span><pre>                value, state)</pre></div>
<div class="nocov"><span class="num"><pre>2187</pre></span><pre>        if explicit_ampm:</pre></div>
<div class="nocov"><span class="num"><pre>2188</pre></span><pre>            if hour &gt; 12 or hour &lt; 1:</pre></div>
<div class="nocov"><span class="num"><pre>2189</pre></span><pre>                raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>2190</pre></span><pre>                    self.message('badHour', state, number=hour, range='1-12'),</pre></div>
<div class="nocov"><span class="num"><pre>2191</pre></span><pre>                    value, state)</pre></div>
<div class="nocov"><span class="num"><pre>2192</pre></span><pre>            if hour == 12 and offset == 12:</pre></div>
<div class="skip"><span class="num"><pre>2193</pre></span><pre>                # 12pm == 12</pre></div>
<div class="nocov"><span class="num"><pre>2194</pre></span><pre>                pass</pre></div>
<div class="nocov"><span class="num"><pre>2195</pre></span><pre>            elif hour == 12 and offset == 0:</pre></div>
<div class="skip"><span class="num"><pre>2196</pre></span><pre>                # 12am == 0</pre></div>
<div class="nocov"><span class="num"><pre>2197</pre></span><pre>                hour = 0</pre></div>
<div class="nocov"><span class="num"><pre>2198</pre></span><pre>            else:</pre></div>
<div class="nocov"><span class="num"><pre>2199</pre></span><pre>                hour += offset</pre></div>
<div class="nocov"><span class="num"><pre>2200</pre></span><pre>        else:</pre></div>
<div class="nocov"><span class="num"><pre>2201</pre></span><pre>            if hour &gt; 23 or hour &lt; 0:</pre></div>
<div class="nocov"><span class="num"><pre>2202</pre></span><pre>                raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>2203</pre></span><pre>                    self.message('badHour', state,</pre></div>
<div class="nocov"><span class="num"><pre>2204</pre></span><pre>                                 number=hour, range='0-23'),</pre></div>
<div class="nocov"><span class="num"><pre>2205</pre></span><pre>                    value, state)</pre></div>
<div class="nocov"><span class="num"><pre>2206</pre></span><pre>        try:</pre></div>
<div class="nocov"><span class="num"><pre>2207</pre></span><pre>            minute = int(parts[1])</pre></div>
<div class="nocov"><span class="num"><pre>2208</pre></span><pre>        except ValueError:</pre></div>
<div class="nocov"><span class="num"><pre>2209</pre></span><pre>            raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>2210</pre></span><pre>                self.message('badNumber', state,</pre></div>
<div class="nocov"><span class="num"><pre>2211</pre></span><pre>                             number=parts[1], part='minute'),</pre></div>
<div class="nocov"><span class="num"><pre>2212</pre></span><pre>                value, state)</pre></div>
<div class="nocov"><span class="num"><pre>2213</pre></span><pre>        if minute &gt; 59 or minute &lt; 0:</pre></div>
<div class="nocov"><span class="num"><pre>2214</pre></span><pre>            raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>2215</pre></span><pre>                self.message('badMinute', state, number=minute),</pre></div>
<div class="nocov"><span class="num"><pre>2216</pre></span><pre>                value, state)</pre></div>
<div class="nocov"><span class="num"><pre>2217</pre></span><pre>        if len(parts) == 3:</pre></div>
<div class="nocov"><span class="num"><pre>2218</pre></span><pre>            try:</pre></div>
<div class="nocov"><span class="num"><pre>2219</pre></span><pre>                second = int(parts[2])</pre></div>
<div class="nocov"><span class="num"><pre>2220</pre></span><pre>            except ValueError:</pre></div>
<div class="nocov"><span class="num"><pre>2221</pre></span><pre>                raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>2222</pre></span><pre>                    self.message('badNumber', state,</pre></div>
<div class="nocov"><span class="num"><pre>2223</pre></span><pre>                                 number=parts[2], part='second'))</pre></div>
<div class="nocov"><span class="num"><pre>2224</pre></span><pre>            if second &gt; 59 or second &lt; 0:</pre></div>
<div class="nocov"><span class="num"><pre>2225</pre></span><pre>                raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>2226</pre></span><pre>                    self.message('badSecond', state, number=second),</pre></div>
<div class="nocov"><span class="num"><pre>2227</pre></span><pre>                    value, state)</pre></div>
<div class="nocov"><span class="num"><pre>2228</pre></span><pre>        else:</pre></div>
<div class="nocov"><span class="num"><pre>2229</pre></span><pre>            second = None</pre></div>
<div class="nocov"><span class="num"><pre>2230</pre></span><pre>        if second is None:</pre></div>
<div class="nocov"><span class="num"><pre>2231</pre></span><pre>            return (hour, minute)</pre></div>
<div class="nocov"><span class="num"><pre>2232</pre></span><pre>        else:</pre></div>
<div class="nocov"><span class="num"><pre>2233</pre></span><pre>            return (hour, minute, second)</pre></div>
<div class="skip"><span class="num"><pre>2234</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2235</pre></span><pre>    def _from_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre>2236</pre></span><pre>        if isinstance(value, (str, unicode)):</pre></div>
<div class="nocov"><span class="num"><pre>2237</pre></span><pre>            return value</pre></div>
<div class="nocov"><span class="num"><pre>2238</pre></span><pre>        if hasattr(value, 'hour'):</pre></div>
<div class="nocov"><span class="num"><pre>2239</pre></span><pre>            hour, minute = value.hour, value.minute</pre></div>
<div class="nocov"><span class="num"><pre>2240</pre></span><pre>            second = value.second</pre></div>
<div class="nocov"><span class="num"><pre>2241</pre></span><pre>        elif len(value) == 3:</pre></div>
<div class="nocov"><span class="num"><pre>2242</pre></span><pre>            hour, minute, second = value</pre></div>
<div class="nocov"><span class="num"><pre>2243</pre></span><pre>        elif len(value) == 2:</pre></div>
<div class="nocov"><span class="num"><pre>2244</pre></span><pre>            hour, minute = value</pre></div>
<div class="nocov"><span class="num"><pre>2245</pre></span><pre>            second = 0</pre></div>
<div class="nocov"><span class="num"><pre>2246</pre></span><pre>        ampm = ''</pre></div>
<div class="nocov"><span class="num"><pre>2247</pre></span><pre>        if ((self.use_ampm == 'optional' and self.prefer_ampm)</pre></div>
<div class="nocov"><span class="num"><pre>2248</pre></span><pre>            or (self.use_ampm and self.use_ampm != 'optional')):</pre></div>
<div class="nocov"><span class="num"><pre>2249</pre></span><pre>            ampm = 'am'</pre></div>
<div class="nocov"><span class="num"><pre>2250</pre></span><pre>            if hour &gt; 12:</pre></div>
<div class="nocov"><span class="num"><pre>2251</pre></span><pre>                hour -= 12</pre></div>
<div class="nocov"><span class="num"><pre>2252</pre></span><pre>                ampm = 'pm'</pre></div>
<div class="nocov"><span class="num"><pre>2253</pre></span><pre>            elif hour == 12:</pre></div>
<div class="nocov"><span class="num"><pre>2254</pre></span><pre>                ampm = 'pm'</pre></div>
<div class="nocov"><span class="num"><pre>2255</pre></span><pre>            elif hour == 0:</pre></div>
<div class="nocov"><span class="num"><pre>2256</pre></span><pre>                hour = 12</pre></div>
<div class="nocov"><span class="num"><pre>2257</pre></span><pre>        if self.use_seconds:</pre></div>
<div class="nocov"><span class="num"><pre>2258</pre></span><pre>            return '%i:%02i:%02i%s' % (hour, minute, second, ampm)</pre></div>
<div class="nocov"><span class="num"><pre>2259</pre></span><pre>        else:</pre></div>
<div class="nocov"><span class="num"><pre>2260</pre></span><pre>            return '%i:%02i%s' % (hour, minute, ampm)</pre></div>
<div class="skip"><span class="num"><pre>2261</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2262</pre></span><pre>def PostalCode(*kw, **kwargs):</pre></div>
<div class="nocov"><span class="num"><pre>2263</pre></span><pre>    warnings.warn(&quot;please use formencode.national.USPostalCode&quot;, DeprecationWarning, stacklevel=2)</pre></div>
<div class="nocov"><span class="num"><pre>2264</pre></span><pre>    from formencode.national import USPostalCode</pre></div>
<div class="nocov"><span class="num"><pre>2265</pre></span><pre>    return USPostalCode(*kw, **kwargs)</pre></div>
<div class="skip"><span class="num"><pre>2266</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2267</pre></span><pre>class StripField(FancyValidator):</pre></div>
<div class="skip"><span class="num"><pre>2268</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2269</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>2270</pre></span><pre>    Take a field from a dictionary, removing the key from the</pre></div>
<div class="nocov"><span class="num"><pre>2271</pre></span><pre>    dictionary.</pre></div>
<div class="skip"><span class="num"><pre>2272</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2273</pre></span><pre>    ``name`` is the key.  The field value and a new copy of the</pre></div>
<div class="nocov"><span class="num"><pre>2274</pre></span><pre>    dictionary with that field removed are returned.</pre></div>
<div class="skip"><span class="num"><pre>2275</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2276</pre></span><pre>    &gt;&gt;&gt; StripField('test').to_python({'a': 1, 'test': 2})</pre></div>
<div class="nocov"><span class="num"><pre>2277</pre></span><pre>    (2, {'a': 1})</pre></div>
<div class="nocov"><span class="num"><pre>2278</pre></span><pre>    &gt;&gt;&gt; StripField('test').to_python({})</pre></div>
<div class="nocov"><span class="num"><pre>2279</pre></span><pre>    Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2280</pre></span><pre>        ...</pre></div>
<div class="nocov"><span class="num"><pre>2281</pre></span><pre>    Invalid: The name 'test' is missing</pre></div>
<div class="skip"><span class="num"><pre>2282</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2283</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>2284</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2285</pre></span><pre>    __unpackargs__ = ('name',)</pre></div>
<div class="skip"><span class="num"><pre>2286</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2287</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre>2288</pre></span><pre>        'missing': _('The name %(name)s is missing'),</pre></div>
<div class="nocov"><span class="num"><pre>2289</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre>2290</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2291</pre></span><pre>    def _to_python(self, valueDict, state):</pre></div>
<div class="nocov"><span class="num"><pre>2292</pre></span><pre>        v = valueDict.copy()</pre></div>
<div class="nocov"><span class="num"><pre>2293</pre></span><pre>        try:</pre></div>
<div class="nocov"><span class="num"><pre>2294</pre></span><pre>            field = v[self.name]</pre></div>
<div class="nocov"><span class="num"><pre>2295</pre></span><pre>            del v[self.name]</pre></div>
<div class="nocov"><span class="num"><pre>2296</pre></span><pre>        except KeyError:</pre></div>
<div class="nocov"><span class="num"><pre>2297</pre></span><pre>            raise Invalid(self.message('missing', state,</pre></div>
<div class="nocov"><span class="num"><pre>2298</pre></span><pre>                                       name=repr(self.name)),</pre></div>
<div class="nocov"><span class="num"><pre>2299</pre></span><pre>                          valueDict, state)</pre></div>
<div class="nocov"><span class="num"><pre>2300</pre></span><pre>        return field, v</pre></div>
<div class="skip"><span class="num"><pre>2301</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2302</pre></span><pre>    def is_empty(self, value):</pre></div>
<div class="skip"><span class="num"><pre>2303</pre></span><pre>        ## Empty dictionaries don't really apply here</pre></div>
<div class="nocov"><span class="num"><pre>2304</pre></span><pre>        return False</pre></div>
<div class="skip"><span class="num"><pre>2305</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2306</pre></span><pre>class StringBool(FancyValidator):</pre></div>
<div class="skip"><span class="num"><pre>2307</pre></span><pre>    # Originally from TurboGears</pre></div>
<div class="nocov"><span class="num"><pre>2308</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>2309</pre></span><pre>    Converts a string to a boolean.</pre></div>
<div class="skip"><span class="num"><pre>2310</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2311</pre></span><pre>    Values like 'true' and 'false' are considered True and False,</pre></div>
<div class="nocov"><span class="num"><pre>2312</pre></span><pre>    respectively; anything in ``true_values`` is true, anything in</pre></div>
<div class="nocov"><span class="num"><pre>2313</pre></span><pre>    ``false_values`` is false, case-insensitive).  The first item of</pre></div>
<div class="nocov"><span class="num"><pre>2314</pre></span><pre>    those lists is considered the preferred form.</pre></div>
<div class="skip"><span class="num"><pre>2315</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2316</pre></span><pre>    ::</pre></div>
<div class="skip"><span class="num"><pre>2317</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2318</pre></span><pre>        &gt;&gt;&gt; s = StringBoolean()</pre></div>
<div class="nocov"><span class="num"><pre>2319</pre></span><pre>        &gt;&gt;&gt; s.to_python('yes'), s.to_python('no')</pre></div>
<div class="nocov"><span class="num"><pre>2320</pre></span><pre>        (True, False)</pre></div>
<div class="nocov"><span class="num"><pre>2321</pre></span><pre>        &gt;&gt;&gt; s.to_python(1), s.to_python('N')</pre></div>
<div class="nocov"><span class="num"><pre>2322</pre></span><pre>        (True, False)</pre></div>
<div class="nocov"><span class="num"><pre>2323</pre></span><pre>        &gt;&gt;&gt; s.to_python('ye')</pre></div>
<div class="nocov"><span class="num"><pre>2324</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2325</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>2326</pre></span><pre>        Invalid: Value should be 'true' or 'false'</pre></div>
<div class="nocov"><span class="num"><pre>2327</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>2328</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2329</pre></span><pre>    true_values = ['true', 't', 'yes', 'y', 'on', '1']</pre></div>
<div class="nocov"><span class="num"><pre>2330</pre></span><pre>    false_values = ['false', 'f', 'no', 'n', 'off', '0']</pre></div>
<div class="skip"><span class="num"><pre>2331</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2332</pre></span><pre>    messages = { &quot;string&quot; : _(&quot;Value should be %(true)r or %(false)r&quot;) }</pre></div>
<div class="skip"><span class="num"><pre>2333</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2334</pre></span><pre>    def _to_python(self, value, state):</pre></div>
<div class="cov"><span class="num"><pre>2335</pre></span><pre>        if isinstance(value, (str, unicode)):</pre></div>
<div class="cov"><span class="num"><pre>2336</pre></span><pre>            value = value.strip().lower()</pre></div>
<div class="cov"><span class="num"><pre>2337</pre></span><pre>            if value in self.true_values:</pre></div>
<div class="cov"><span class="num"><pre>2338</pre></span><pre>                return True</pre></div>
<div class="nocov"><span class="num"><pre>2339</pre></span><pre>            if not value or value in self.false_values:</pre></div>
<div class="nocov"><span class="num"><pre>2340</pre></span><pre>                return False</pre></div>
<div class="nocov"><span class="num"><pre>2341</pre></span><pre>            raise Invalid(self.message(&quot;string&quot;, state,</pre></div>
<div class="nocov"><span class="num"><pre>2342</pre></span><pre>                                       true=self.true_values[0],</pre></div>
<div class="nocov"><span class="num"><pre>2343</pre></span><pre>                                       false=self.false_values[0]),</pre></div>
<div class="nocov"><span class="num"><pre>2344</pre></span><pre>                          value, state)</pre></div>
<div class="nocov"><span class="num"><pre>2345</pre></span><pre>        return bool(value)</pre></div>
<div class="skip"><span class="num"><pre>2346</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2347</pre></span><pre>    def _from_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre>2348</pre></span><pre>        if value:</pre></div>
<div class="nocov"><span class="num"><pre>2349</pre></span><pre>            return self.true_values[0]</pre></div>
<div class="nocov"><span class="num"><pre>2350</pre></span><pre>        else:</pre></div>
<div class="nocov"><span class="num"><pre>2351</pre></span><pre>            return self.false_values[0]</pre></div>
<div class="skip"><span class="num"><pre>2352</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>2353</pre></span><pre># Should deprecate:</pre></div>
<div class="nocov"><span class="num"><pre>2354</pre></span><pre>StringBoolean = StringBool</pre></div>
<div class="skip"><span class="num"><pre>2355</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2356</pre></span><pre>class SignedString(FancyValidator):</pre></div>
<div class="skip"><span class="num"><pre>2357</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2358</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>2359</pre></span><pre>    Encodes a string into a signed string, and base64 encodes both the</pre></div>
<div class="nocov"><span class="num"><pre>2360</pre></span><pre>    signature string and a random nonce.</pre></div>
<div class="skip"><span class="num"><pre>2361</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2362</pre></span><pre>    It is up to you to provide a secret, and to keep the secret handy</pre></div>
<div class="nocov"><span class="num"><pre>2363</pre></span><pre>    and consistent.</pre></div>
<div class="nocov"><span class="num"><pre>2364</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>2365</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2366</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre>2367</pre></span><pre>        'malformed': _('Value does not contain a signature'),</pre></div>
<div class="nocov"><span class="num"><pre>2368</pre></span><pre>        'badsig': _('Signature is not correct'),</pre></div>
<div class="nocov"><span class="num"><pre>2369</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre>2370</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2371</pre></span><pre>    secret = None</pre></div>
<div class="nocov"><span class="num"><pre>2372</pre></span><pre>    nonce_length = 4</pre></div>
<div class="skip"><span class="num"><pre>2373</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2374</pre></span><pre>    def _to_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre>2375</pre></span><pre>        global sha1</pre></div>
<div class="nocov"><span class="num"><pre>2376</pre></span><pre>        if not sha1:</pre></div>
<div class="nocov"><span class="num"><pre>2377</pre></span><pre>            try:</pre></div>
<div class="nocov"><span class="num"><pre>2378</pre></span><pre>                from hashlib import sha1</pre></div>
<div class="nocov"><span class="num"><pre>2379</pre></span><pre>            except ImportError:</pre></div>
<div class="nocov"><span class="num"><pre>2380</pre></span><pre>                from sha import sha as sha1</pre></div>
<div class="nocov"><span class="num"><pre>2381</pre></span><pre>        assert self.secret is not None, (</pre></div>
<div class="nocov"><span class="num"><pre>2382</pre></span><pre>            &quot;You must give a secret&quot;)</pre></div>
<div class="nocov"><span class="num"><pre>2383</pre></span><pre>        parts = value.split(None, 1)</pre></div>
<div class="nocov"><span class="num"><pre>2384</pre></span><pre>        if not parts or len(parts) == 1:</pre></div>
<div class="nocov"><span class="num"><pre>2385</pre></span><pre>            raise Invalid(self.message('malformed', state),</pre></div>
<div class="nocov"><span class="num"><pre>2386</pre></span><pre>                          value, state)</pre></div>
<div class="nocov"><span class="num"><pre>2387</pre></span><pre>        sig, rest = parts</pre></div>
<div class="nocov"><span class="num"><pre>2388</pre></span><pre>        sig = sig.decode('base64')</pre></div>
<div class="nocov"><span class="num"><pre>2389</pre></span><pre>        rest = rest.decode('base64')</pre></div>
<div class="nocov"><span class="num"><pre>2390</pre></span><pre>        nonce = rest[:self.nonce_length]</pre></div>
<div class="nocov"><span class="num"><pre>2391</pre></span><pre>        rest = rest[self.nonce_length:]</pre></div>
<div class="nocov"><span class="num"><pre>2392</pre></span><pre>        expected = sha1(str(self.secret)+nonce+rest).digest()</pre></div>
<div class="nocov"><span class="num"><pre>2393</pre></span><pre>        if expected != sig:</pre></div>
<div class="nocov"><span class="num"><pre>2394</pre></span><pre>            raise Invalid(self.message('badsig', state),</pre></div>
<div class="nocov"><span class="num"><pre>2395</pre></span><pre>                          value, state)</pre></div>
<div class="nocov"><span class="num"><pre>2396</pre></span><pre>        return rest</pre></div>
<div class="skip"><span class="num"><pre>2397</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2398</pre></span><pre>    def _from_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre>2399</pre></span><pre>        global sha1</pre></div>
<div class="nocov"><span class="num"><pre>2400</pre></span><pre>        if not sha1:</pre></div>
<div class="nocov"><span class="num"><pre>2401</pre></span><pre>            try:</pre></div>
<div class="nocov"><span class="num"><pre>2402</pre></span><pre>                from hashlib import sha1</pre></div>
<div class="nocov"><span class="num"><pre>2403</pre></span><pre>            except ImportError:</pre></div>
<div class="nocov"><span class="num"><pre>2404</pre></span><pre>                from sha import sha as sha1</pre></div>
<div class="nocov"><span class="num"><pre>2405</pre></span><pre>        nonce = self.make_nonce()</pre></div>
<div class="nocov"><span class="num"><pre>2406</pre></span><pre>        value = str(value)</pre></div>
<div class="nocov"><span class="num"><pre>2407</pre></span><pre>        digest = sha1(self.secret+nonce+value).digest()</pre></div>
<div class="nocov"><span class="num"><pre>2408</pre></span><pre>        return self.encode(digest)+' '+self.encode(nonce+value)</pre></div>
<div class="skip"><span class="num"><pre>2409</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2410</pre></span><pre>    def encode(self, value):</pre></div>
<div class="nocov"><span class="num"><pre>2411</pre></span><pre>        return value.encode('base64').strip().replace('\n', '')</pre></div>
<div class="skip"><span class="num"><pre>2412</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2413</pre></span><pre>    def make_nonce(self):</pre></div>
<div class="nocov"><span class="num"><pre>2414</pre></span><pre>        global random</pre></div>
<div class="nocov"><span class="num"><pre>2415</pre></span><pre>        if not random:</pre></div>
<div class="nocov"><span class="num"><pre>2416</pre></span><pre>            import random</pre></div>
<div class="nocov"><span class="num"><pre>2417</pre></span><pre>        return ''.join([</pre></div>
<div class="nocov"><span class="num"><pre>2418</pre></span><pre>            chr(random.randrange(256))</pre></div>
<div class="nocov"><span class="num"><pre>2419</pre></span><pre>            for i in range(self.nonce_length)])</pre></div>
<div class="skip"><span class="num"><pre>2420</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2421</pre></span><pre>class IPAddress(FancyValidator):</pre></div>
<div class="nocov"><span class="num"><pre>2422</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>2423</pre></span><pre>    Formencode validator to check whether a string is a correct IP address</pre></div>
<div class="skip"><span class="num"><pre>2424</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2425</pre></span><pre>    Examples::</pre></div>
<div class="skip"><span class="num"><pre>2426</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2427</pre></span><pre>        &gt;&gt;&gt; ip = IPAddress()</pre></div>
<div class="nocov"><span class="num"><pre>2428</pre></span><pre>        &gt;&gt;&gt; ip.to_python('127.0.0.1')</pre></div>
<div class="nocov"><span class="num"><pre>2429</pre></span><pre>        '127.0.0.1'</pre></div>
<div class="nocov"><span class="num"><pre>2430</pre></span><pre>        &gt;&gt;&gt; ip.to_python('299.0.0.1')</pre></div>
<div class="nocov"><span class="num"><pre>2431</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2432</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>2433</pre></span><pre>        Invalid: The octets must be within the range of 0-255 (not '299')</pre></div>
<div class="nocov"><span class="num"><pre>2434</pre></span><pre>        &gt;&gt;&gt; ip.to_python('192.168.0.1/1')</pre></div>
<div class="nocov"><span class="num"><pre>2435</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2436</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>2437</pre></span><pre>        Invalid: Please enter a valid IP address (a.b.c.d)</pre></div>
<div class="nocov"><span class="num"><pre>2438</pre></span><pre>        &gt;&gt;&gt; ip.to_python('asdf')</pre></div>
<div class="nocov"><span class="num"><pre>2439</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2440</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>2441</pre></span><pre>        Invalid: Please enter a valid IP address (a.b.c.d)</pre></div>
<div class="nocov"><span class="num"><pre>2442</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>2443</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre>2444</pre></span><pre>            'bad_format' : u'Please enter a valid IP address (a.b.c.d)',</pre></div>
<div class="nocov"><span class="num"><pre>2445</pre></span><pre>            'illegal_octets' : u'The octets must be within the range of 0-255 (not %(octet)r)',</pre></div>
<div class="nocov"><span class="num"><pre>2446</pre></span><pre>            }</pre></div>
<div class="skip"><span class="num"><pre>2447</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2448</pre></span><pre>    def validate_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre>2449</pre></span><pre>        try:</pre></div>
<div class="nocov"><span class="num"><pre>2450</pre></span><pre>            octets = value.split('.')</pre></div>
<div class="skip"><span class="num"><pre>2451</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>2452</pre></span><pre>            # Only 4 octets?</pre></div>
<div class="nocov"><span class="num"><pre>2453</pre></span><pre>            if len(octets) != 4:</pre></div>
<div class="nocov"><span class="num"><pre>2454</pre></span><pre>                raise Invalid(self.message(&quot;bad_format&quot;, state, value=value), value, state)</pre></div>
<div class="skip"><span class="num"><pre>2455</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>2456</pre></span><pre>            # Correct octets?</pre></div>
<div class="nocov"><span class="num"><pre>2457</pre></span><pre>            for octet in octets:</pre></div>
<div class="nocov"><span class="num"><pre>2458</pre></span><pre>                if int(octet) &lt; 0 or int(octet) &gt; 255:</pre></div>
<div class="nocov"><span class="num"><pre>2459</pre></span><pre>                    raise Invalid(self.message(&quot;illegal_octets&quot;, state, octet=octet), value, state)</pre></div>
<div class="skip"><span class="num"><pre>2460</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>2461</pre></span><pre>        # Splitting faild: wrong syntax</pre></div>
<div class="nocov"><span class="num"><pre>2462</pre></span><pre>        except ValueError:</pre></div>
<div class="nocov"><span class="num"><pre>2463</pre></span><pre>            raise Invalid(self.message(&quot;bad_format&quot;, state), value, state)</pre></div>
<div class="skip"><span class="num"><pre>2464</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2465</pre></span><pre>class CIDR(IPAddress):</pre></div>
<div class="nocov"><span class="num"><pre>2466</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>2467</pre></span><pre>    Formencode validator to check whether a string is in correct CIDR</pre></div>
<div class="nocov"><span class="num"><pre>2468</pre></span><pre>    notation (IP address, or IP address plus /mask)</pre></div>
<div class="skip"><span class="num"><pre>2469</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2470</pre></span><pre>    Examples::</pre></div>
<div class="skip"><span class="num"><pre>2471</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2472</pre></span><pre>        &gt;&gt;&gt; cidr = CIDR()</pre></div>
<div class="nocov"><span class="num"><pre>2473</pre></span><pre>        &gt;&gt;&gt; cidr.to_python('127.0.0.1')</pre></div>
<div class="nocov"><span class="num"><pre>2474</pre></span><pre>        '127.0.0.1'</pre></div>
<div class="nocov"><span class="num"><pre>2475</pre></span><pre>        &gt;&gt;&gt; cidr.to_python('299.0.0.1')</pre></div>
<div class="nocov"><span class="num"><pre>2476</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2477</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>2478</pre></span><pre>        Invalid: The octets must be within the range of 0-255 (not '299')</pre></div>
<div class="nocov"><span class="num"><pre>2479</pre></span><pre>        &gt;&gt;&gt; cidr.to_python('192.168.0.1/1')</pre></div>
<div class="nocov"><span class="num"><pre>2480</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2481</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>2482</pre></span><pre>        Invalid: The network size (bits) must be within the range of 8-32 (not '1')</pre></div>
<div class="nocov"><span class="num"><pre>2483</pre></span><pre>        &gt;&gt;&gt; cidr.to_python('asdf')</pre></div>
<div class="nocov"><span class="num"><pre>2484</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2485</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>2486</pre></span><pre>        Invalid: Please enter a valid IP address (a.b.c.d) or IP network (a.b.c.d/e)</pre></div>
<div class="nocov"><span class="num"><pre>2487</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>2488</pre></span><pre>    messages = dict(IPAddress._messages,</pre></div>
<div class="nocov"><span class="num"><pre>2489</pre></span><pre>            bad_format = u'Please enter a valid IP address (a.b.c.d) or IP network (a.b.c.d/e)',</pre></div>
<div class="nocov"><span class="num"><pre>2490</pre></span><pre>            illegal_bits = u'The network size (bits) must be within the range of 8-32 (not %(bits)r)',</pre></div>
<div class="nocov"><span class="num"><pre>2491</pre></span><pre>            )</pre></div>
<div class="skip"><span class="num"><pre>2492</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2493</pre></span><pre>    def validate_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre>2494</pre></span><pre>        try:</pre></div>
<div class="skip"><span class="num"><pre>2495</pre></span><pre>            # Split into octets and bits</pre></div>
<div class="nocov"><span class="num"><pre>2496</pre></span><pre>            if '/' in value: # a.b.c.d/e</pre></div>
<div class="nocov"><span class="num"><pre>2497</pre></span><pre>                addr, bits = value.split('/')</pre></div>
<div class="nocov"><span class="num"><pre>2498</pre></span><pre>            else: # a.b.c.d</pre></div>
<div class="nocov"><span class="num"><pre>2499</pre></span><pre>                addr, bits = value, 32</pre></div>
<div class="skip"><span class="num"><pre>2500</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>2501</pre></span><pre>            # Use IPAddress validator to validate the IP part</pre></div>
<div class="nocov"><span class="num"><pre>2502</pre></span><pre>            IPAddress.validate_python(self, addr, state)</pre></div>
<div class="skip"><span class="num"><pre>2503</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>2504</pre></span><pre>            # Bits (netmask) correct?</pre></div>
<div class="nocov"><span class="num"><pre>2505</pre></span><pre>            if int(bits) &lt; 8 or int(bits) &gt; 32:</pre></div>
<div class="nocov"><span class="num"><pre>2506</pre></span><pre>                    raise Invalid(self.message(&quot;illegal_bits&quot;, state, bits=bits), value, state)</pre></div>
<div class="skip"><span class="num"><pre>2507</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>2508</pre></span><pre>        # Splitting faild: wrong syntax</pre></div>
<div class="nocov"><span class="num"><pre>2509</pre></span><pre>        except ValueError:</pre></div>
<div class="nocov"><span class="num"><pre>2510</pre></span><pre>            raise Invalid(self.message(&quot;bad_format&quot;, state), value, state)</pre></div>
<div class="skip"><span class="num"><pre>2511</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2512</pre></span><pre>class MACAddress(FancyValidator):</pre></div>
<div class="nocov"><span class="num"><pre>2513</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>2514</pre></span><pre>    Formencode validator to check whether a string is a correct hardware</pre></div>
<div class="nocov"><span class="num"><pre>2515</pre></span><pre>    (MAC) address.</pre></div>
<div class="skip"><span class="num"><pre>2516</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2517</pre></span><pre>    Examples::</pre></div>
<div class="skip"><span class="num"><pre>2518</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2519</pre></span><pre>        &gt;&gt;&gt; mac = MACAddress()</pre></div>
<div class="nocov"><span class="num"><pre>2520</pre></span><pre>        &gt;&gt;&gt; mac.to_python('aa:bb:cc:dd:ee:ff')</pre></div>
<div class="nocov"><span class="num"><pre>2521</pre></span><pre>        'aabbccddeeff'</pre></div>
<div class="nocov"><span class="num"><pre>2522</pre></span><pre>        &gt;&gt;&gt; mac.to_python('aa:bb:cc:dd:ee:ff:e')</pre></div>
<div class="nocov"><span class="num"><pre>2523</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2524</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>2525</pre></span><pre>        Invalid: A MAC address must contain 12 digits and A-F; the value you gave has 13 characters</pre></div>
<div class="nocov"><span class="num"><pre>2526</pre></span><pre>        &gt;&gt;&gt; mac.to_python('aa:bb:cc:dd:ee:fx')</pre></div>
<div class="nocov"><span class="num"><pre>2527</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2528</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>2529</pre></span><pre>        Invalid: MAC addresses may only contain 0-9 and A-F (and optionally :), not 'x'</pre></div>
<div class="nocov"><span class="num"><pre>2530</pre></span><pre>        &gt;&gt;&gt; MACAddress(add_colons=True).to_python('aabbccddeeff')</pre></div>
<div class="nocov"><span class="num"><pre>2531</pre></span><pre>        'aa:bb:cc:dd:ee:ff'</pre></div>
<div class="nocov"><span class="num"><pre>2532</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>2533</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2534</pre></span><pre>    strip=True</pre></div>
<div class="nocov"><span class="num"><pre>2535</pre></span><pre>    valid_characters = '0123456789abcdefABCDEF'</pre></div>
<div class="nocov"><span class="num"><pre>2536</pre></span><pre>    add_colons = False</pre></div>
<div class="skip"><span class="num"><pre>2537</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2538</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre>2539</pre></span><pre>        'bad_length': _(u'A MAC address must contain 12 digits and A-F; the value you gave has %(length)s characters'),</pre></div>
<div class="nocov"><span class="num"><pre>2540</pre></span><pre>        'bad_character': _(u'MAC addresses may only contain 0-9 and A-F (and optionally :), not %(char)r'),</pre></div>
<div class="nocov"><span class="num"><pre>2541</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre>2542</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2543</pre></span><pre>    def _to_python(self, value, state):</pre></div>
<div class="nocov"><span class="num"><pre>2544</pre></span><pre>        address = value.replace(':','') # remove colons</pre></div>
<div class="nocov"><span class="num"><pre>2545</pre></span><pre>        address = address.lower()</pre></div>
<div class="nocov"><span class="num"><pre>2546</pre></span><pre>        if len(address)!=12:</pre></div>
<div class="nocov"><span class="num"><pre>2547</pre></span><pre>            raise Invalid(self.message(&quot;bad_length&quot;, state, length=len(address)), address, state)</pre></div>
<div class="nocov"><span class="num"><pre>2548</pre></span><pre>        for char in address:</pre></div>
<div class="nocov"><span class="num"><pre>2549</pre></span><pre>            if char not in self.valid_characters:</pre></div>
<div class="nocov"><span class="num"><pre>2550</pre></span><pre>                raise Invalid(self.message(&quot;bad_character&quot;, state, char=char), address, state)</pre></div>
<div class="nocov"><span class="num"><pre>2551</pre></span><pre>        if self.add_colons:</pre></div>
<div class="nocov"><span class="num"><pre>2552</pre></span><pre>            address = '%s:%s:%s:%s:%s:%s' % (</pre></div>
<div class="nocov"><span class="num"><pre>2553</pre></span><pre>                address[0:2], address[2:4], address[4:6],</pre></div>
<div class="nocov"><span class="num"><pre>2554</pre></span><pre>                address[6:8], address[8:10], address[10:12])</pre></div>
<div class="nocov"><span class="num"><pre>2555</pre></span><pre>        return address</pre></div>
<div class="skip"><span class="num"><pre>2556</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2557</pre></span><pre>    _from_python = _to_python</pre></div>
<div class="skip"><span class="num"><pre>2558</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2559</pre></span><pre>class FormValidator(FancyValidator):</pre></div>
<div class="nocov"><span class="num"><pre>2560</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>2561</pre></span><pre>    A FormValidator is something that can be chained with a</pre></div>
<div class="nocov"><span class="num"><pre>2562</pre></span><pre>    Schema.  Unlike normal chaining the FormValidator can</pre></div>
<div class="nocov"><span class="num"><pre>2563</pre></span><pre>    validate forms that aren't entirely valid.</pre></div>
<div class="skip"><span class="num"><pre>2564</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2565</pre></span><pre>    The important method is .validate(), of course.  It gets passed a</pre></div>
<div class="nocov"><span class="num"><pre>2566</pre></span><pre>    dictionary of the (processed) values from the form.  If you have</pre></div>
<div class="nocov"><span class="num"><pre>2567</pre></span><pre>    .validate_partial_form set to True, then it will get the incomplete</pre></div>
<div class="nocov"><span class="num"><pre>2568</pre></span><pre>    values as well -- use .has_key() to test if the field was able to</pre></div>
<div class="nocov"><span class="num"><pre>2569</pre></span><pre>    process any particular field.</pre></div>
<div class="skip"><span class="num"><pre>2570</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2571</pre></span><pre>    Anyway, .validate() should return a string or a dictionary.  If a</pre></div>
<div class="nocov"><span class="num"><pre>2572</pre></span><pre>    string, it's an error message that applies to the whole form.  If</pre></div>
<div class="nocov"><span class="num"><pre>2573</pre></span><pre>    not, then it should be a dictionary of fieldName: errorMessage.</pre></div>
<div class="nocov"><span class="num"><pre>2574</pre></span><pre>    The special key &quot;form&quot; is the error message for the form as a whole</pre></div>
<div class="nocov"><span class="num"><pre>2575</pre></span><pre>    (i.e., a string is equivalent to {&quot;form&quot;: string}).</pre></div>
<div class="skip"><span class="num"><pre>2576</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2577</pre></span><pre>    Return None on no errors.</pre></div>
<div class="nocov"><span class="num"><pre>2578</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>2579</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2580</pre></span><pre>    validate_partial_form = False</pre></div>
<div class="skip"><span class="num"><pre>2581</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2582</pre></span><pre>    validate_partial_python = None</pre></div>
<div class="nocov"><span class="num"><pre>2583</pre></span><pre>    validate_partial_other = None</pre></div>
<div class="skip"><span class="num"><pre>2584</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2585</pre></span><pre>    def is_empty(self, value):</pre></div>
<div class="nocov"><span class="num"><pre>2586</pre></span><pre>        return False</pre></div>
<div class="skip"><span class="num"><pre>2587</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2588</pre></span><pre>class RequireIfMissing(FormValidator):</pre></div>
<div class="skip"><span class="num"><pre>2589</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2590</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>2591</pre></span><pre>    This requires one field based on another field being present or</pre></div>
<div class="nocov"><span class="num"><pre>2592</pre></span><pre>    missing.  This is applied to a form, not an individual field</pre></div>
<div class="nocov"><span class="num"><pre>2593</pre></span><pre>    (usually using a Schema's ``pre_validators`` or</pre></div>
<div class="nocov"><span class="num"><pre>2594</pre></span><pre>    ``chained_validators``).</pre></div>
<div class="skip"><span class="num"><pre>2595</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2596</pre></span><pre>    If you provide a ``missing`` value (a string key name) then if</pre></div>
<div class="nocov"><span class="num"><pre>2597</pre></span><pre>    that field is missing the field must be entered.  This gives you</pre></div>
<div class="nocov"><span class="num"><pre>2598</pre></span><pre>    an either/or situation.</pre></div>
<div class="skip"><span class="num"><pre>2599</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2600</pre></span><pre>    If you provide a ``present`` value (another string key name) then</pre></div>
<div class="nocov"><span class="num"><pre>2601</pre></span><pre>    if that field is present, the required field must also be present.</pre></div>
<div class="skip"><span class="num"><pre>2602</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2603</pre></span><pre>    ::</pre></div>
<div class="skip"><span class="num"><pre>2604</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2605</pre></span><pre>        &gt;&gt;&gt; from formencode import validators</pre></div>
<div class="nocov"><span class="num"><pre>2606</pre></span><pre>        &gt;&gt;&gt; v = validators.RequireIfPresent('phone_type',</pre></div>
<div class="nocov"><span class="num"><pre>2607</pre></span><pre>        ...                                 present='phone')</pre></div>
<div class="nocov"><span class="num"><pre>2608</pre></span><pre>        &gt;&gt;&gt; v.to_python({'phone_type':'', 'phone':'510 420  4577'})</pre></div>
<div class="nocov"><span class="num"><pre>2609</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2610</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>2611</pre></span><pre>        Invalid: You must give a value for phone_type</pre></div>
<div class="nocov"><span class="num"><pre>2612</pre></span><pre>        &gt;&gt;&gt; v.to_python({'phone': ''})</pre></div>
<div class="nocov"><span class="num"><pre>2613</pre></span><pre>        {'phone': ''}</pre></div>
<div class="skip"><span class="num"><pre>2614</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2615</pre></span><pre>    Note that if you have a validator on the optionally-required</pre></div>
<div class="nocov"><span class="num"><pre>2616</pre></span><pre>    field, you should probably use ``if_missing=None``.  This way you</pre></div>
<div class="nocov"><span class="num"><pre>2617</pre></span><pre>    won't get an error from the Schema about a missing value.  For example::</pre></div>
<div class="skip"><span class="num"><pre>2618</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2619</pre></span><pre>        class PhoneInput(Schema):</pre></div>
<div class="nocov"><span class="num"><pre>2620</pre></span><pre>            phone = PhoneNumber()</pre></div>
<div class="nocov"><span class="num"><pre>2621</pre></span><pre>            phone_type = String(if_missing=None)</pre></div>
<div class="nocov"><span class="num"><pre>2622</pre></span><pre>            chained_validators = [RequireifPresent('phone_type', present='phone')]</pre></div>
<div class="nocov"><span class="num"><pre>2623</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>2624</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>2625</pre></span><pre>    # Field that potentially is required:</pre></div>
<div class="nocov"><span class="num"><pre>2626</pre></span><pre>    required = None</pre></div>
<div class="skip"><span class="num"><pre>2627</pre></span><pre>    # If this field is missing, then it is required:</pre></div>
<div class="nocov"><span class="num"><pre>2628</pre></span><pre>    missing = None</pre></div>
<div class="skip"><span class="num"><pre>2629</pre></span><pre>    # If this field is present, then it is required:</pre></div>
<div class="nocov"><span class="num"><pre>2630</pre></span><pre>    present = None</pre></div>
<div class="nocov"><span class="num"><pre>2631</pre></span><pre>    __unpackargs__ = ('required',)</pre></div>
<div class="skip"><span class="num"><pre>2632</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2633</pre></span><pre>    def _to_python(self, value_dict, state):</pre></div>
<div class="nocov"><span class="num"><pre>2634</pre></span><pre>        is_required = False</pre></div>
<div class="nocov"><span class="num"><pre>2635</pre></span><pre>        if self.missing and not value_dict.get(self.missing):</pre></div>
<div class="nocov"><span class="num"><pre>2636</pre></span><pre>            is_required = True</pre></div>
<div class="nocov"><span class="num"><pre>2637</pre></span><pre>        if self.present and value_dict.get(self.present):</pre></div>
<div class="nocov"><span class="num"><pre>2638</pre></span><pre>            is_required = True</pre></div>
<div class="nocov"><span class="num"><pre>2639</pre></span><pre>        if is_required and not value_dict.get(self.required):</pre></div>
<div class="nocov"><span class="num"><pre>2640</pre></span><pre>            raise Invalid('You must give a value for %s' % self.required,</pre></div>
<div class="nocov"><span class="num"><pre>2641</pre></span><pre>                          value, state,</pre></div>
<div class="nocov"><span class="num"><pre>2642</pre></span><pre>                          error_dict={self.required: Invalid(self.message(</pre></div>
<div class="nocov"><span class="num"><pre>2643</pre></span><pre>                              'empty', state), value, state)})</pre></div>
<div class="nocov"><span class="num"><pre>2644</pre></span><pre>        return value_dict</pre></div>
<div class="skip"><span class="num"><pre>2645</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2646</pre></span><pre>RequireIfPresent = RequireIfMissing</pre></div>
<div class="skip"><span class="num"><pre>2647</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2648</pre></span><pre>class FieldsMatch(FormValidator):</pre></div>
<div class="skip"><span class="num"><pre>2649</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2650</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>2651</pre></span><pre>    Tests that the given fields match, i.e., are identical.  Useful</pre></div>
<div class="nocov"><span class="num"><pre>2652</pre></span><pre>    for password+confirmation fields.  Pass the list of field names in</pre></div>
<div class="nocov"><span class="num"><pre>2653</pre></span><pre>    as `field_names`.</pre></div>
<div class="skip"><span class="num"><pre>2654</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2655</pre></span><pre>    ::</pre></div>
<div class="skip"><span class="num"><pre>2656</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2657</pre></span><pre>        &gt;&gt;&gt; f = FieldsMatch('pass', 'conf')</pre></div>
<div class="nocov"><span class="num"><pre>2658</pre></span><pre>        &gt;&gt;&gt; f.to_python({'pass': 'xx', 'conf': 'xx'})</pre></div>
<div class="nocov"><span class="num"><pre>2659</pre></span><pre>        {'conf': 'xx', 'pass': 'xx'}</pre></div>
<div class="nocov"><span class="num"><pre>2660</pre></span><pre>        &gt;&gt;&gt; f.to_python({'pass': 'xx', 'conf': 'yy'})</pre></div>
<div class="nocov"><span class="num"><pre>2661</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2662</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>2663</pre></span><pre>        Invalid: conf: Fields do not match</pre></div>
<div class="nocov"><span class="num"><pre>2664</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>2665</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2666</pre></span><pre>    show_match = False</pre></div>
<div class="nocov"><span class="num"><pre>2667</pre></span><pre>    field_names = None</pre></div>
<div class="nocov"><span class="num"><pre>2668</pre></span><pre>    validate_partial_form = True</pre></div>
<div class="nocov"><span class="num"><pre>2669</pre></span><pre>    __unpackargs__ = ('*', 'field_names')</pre></div>
<div class="skip"><span class="num"><pre>2670</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2671</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre>2672</pre></span><pre>        'invalid': _(&quot;Fields do not match (should be %(match)s)&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>2673</pre></span><pre>        'invalidNoMatch': _(&quot;Fields do not match&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>2674</pre></span><pre>        'notDict': _(&quot;Fields should be a dictionary&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>2675</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre>2676</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2677</pre></span><pre>    def __init__(self, *args, **kw):</pre></div>
<div class="cov"><span class="num"><pre>2678</pre></span><pre>        super(FormValidator, self).__init__(*args, **kw)</pre></div>
<div class="cov"><span class="num"><pre>2679</pre></span><pre>        if len(self.field_names) &lt; 2:</pre></div>
<div class="nocov"><span class="num"><pre>2680</pre></span><pre>            raise TypeError(&quot;FieldsMatch() requires at least two field names&quot;)</pre></div>
<div class="skip"><span class="num"><pre>2681</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2682</pre></span><pre>    def validate_partial(self, field_dict, state):</pre></div>
<div class="cov"><span class="num"><pre>2683</pre></span><pre>        for name in self.field_names:</pre></div>
<div class="cov"><span class="num"><pre>2684</pre></span><pre>            if not field_dict.has_key(name):</pre></div>
<div class="cov"><span class="num"><pre>2685</pre></span><pre>                return</pre></div>
<div class="cov"><span class="num"><pre>2686</pre></span><pre>        self.validate_python(field_dict, state)</pre></div>
<div class="skip"><span class="num"><pre>2687</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2688</pre></span><pre>    def validate_python(self, field_dict, state):</pre></div>
<div class="cov"><span class="num"><pre>2689</pre></span><pre>        try:</pre></div>
<div class="cov"><span class="num"><pre>2690</pre></span><pre>            ref = field_dict[self.field_names[0]]</pre></div>
<div class="nocov"><span class="num"><pre>2691</pre></span><pre>        except TypeError:</pre></div>
<div class="skip"><span class="num"><pre>2692</pre></span><pre>            # Generally because field_dict isn't a dict</pre></div>
<div class="nocov"><span class="num"><pre>2693</pre></span><pre>            raise Invalid(self.message('notDict', state), field_dict, state)</pre></div>
<div class="nocov"><span class="num"><pre>2694</pre></span><pre>        except KeyError:</pre></div>
<div class="nocov"><span class="num"><pre>2695</pre></span><pre>            ref = ''</pre></div>
<div class="cov"><span class="num"><pre>2696</pre></span><pre>        errors = {}</pre></div>
<div class="cov"><span class="num"><pre>2697</pre></span><pre>        for name in self.field_names[1:]:</pre></div>
<div class="cov"><span class="num"><pre>2698</pre></span><pre>            if field_dict.get(name, '') != ref:</pre></div>
<div class="cov"><span class="num"><pre>2699</pre></span><pre>                if self.show_match:</pre></div>
<div class="nocov"><span class="num"><pre>2700</pre></span><pre>                    errors[name] = self.message('invalid', state,</pre></div>
<div class="nocov"><span class="num"><pre>2701</pre></span><pre>                                                match=ref)</pre></div>
<div class="cov"><span class="num"><pre>2702</pre></span><pre>                else:</pre></div>
<div class="cov"><span class="num"><pre>2703</pre></span><pre>                    errors[name] = self.message('invalidNoMatch', state)</pre></div>
<div class="cov"><span class="num"><pre>2704</pre></span><pre>        if errors:</pre></div>
<div class="cov"><span class="num"><pre>2705</pre></span><pre>            error_list = errors.items()</pre></div>
<div class="cov"><span class="num"><pre>2706</pre></span><pre>            error_list.sort()</pre></div>
<div class="cov"><span class="num"><pre>2707</pre></span><pre>            error_message = '&lt;br&gt;\n'.join(</pre></div>
<div class="cov"><span class="num"><pre>2708</pre></span><pre>                ['%s: %s' % (name, value) for name, value in error_list])</pre></div>
<div class="cov"><span class="num"><pre>2709</pre></span><pre>            raise Invalid(error_message,</pre></div>
<div class="cov"><span class="num"><pre>2710</pre></span><pre>                          field_dict, state,</pre></div>
<div class="cov"><span class="num"><pre>2711</pre></span><pre>                          error_dict=errors)</pre></div>
<div class="skip"><span class="num"><pre>2712</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2713</pre></span><pre>class CreditCardValidator(FormValidator):</pre></div>
<div class="nocov"><span class="num"><pre>2714</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>2715</pre></span><pre>    Checks that credit card numbers are valid (if not real).</pre></div>
<div class="skip"><span class="num"><pre>2716</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2717</pre></span><pre>    You pass in the name of the field that has the credit card</pre></div>
<div class="nocov"><span class="num"><pre>2718</pre></span><pre>    type and the field with the credit card number.  The credit</pre></div>
<div class="nocov"><span class="num"><pre>2719</pre></span><pre>    card type should be one of &quot;visa&quot;, &quot;mastercard&quot;, &quot;amex&quot;,</pre></div>
<div class="nocov"><span class="num"><pre>2720</pre></span><pre>    &quot;dinersclub&quot;, &quot;discover&quot;, &quot;jcb&quot;.</pre></div>
<div class="skip"><span class="num"><pre>2721</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2722</pre></span><pre>    You must check the expiration date yourself (there is no</pre></div>
<div class="nocov"><span class="num"><pre>2723</pre></span><pre>    relation between CC number/types and expiration dates).</pre></div>
<div class="skip"><span class="num"><pre>2724</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2725</pre></span><pre>    ::</pre></div>
<div class="skip"><span class="num"><pre>2726</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2727</pre></span><pre>        &gt;&gt;&gt; cc = CreditCardValidator()</pre></div>
<div class="nocov"><span class="num"><pre>2728</pre></span><pre>        &gt;&gt;&gt; cc.to_python({'ccType': 'visa', 'ccNumber': '4111111111111111'})</pre></div>
<div class="nocov"><span class="num"><pre>2729</pre></span><pre>        {'ccNumber': '4111111111111111', 'ccType': 'visa'}</pre></div>
<div class="nocov"><span class="num"><pre>2730</pre></span><pre>        &gt;&gt;&gt; cc.to_python({'ccType': 'visa', 'ccNumber': '411111111111111'})</pre></div>
<div class="nocov"><span class="num"><pre>2731</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2732</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>2733</pre></span><pre>        Invalid: ccNumber: You did not enter a valid number of digits</pre></div>
<div class="nocov"><span class="num"><pre>2734</pre></span><pre>        &gt;&gt;&gt; cc.to_python({'ccType': 'visa', 'ccNumber': '411111111111112'})</pre></div>
<div class="nocov"><span class="num"><pre>2735</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2736</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>2737</pre></span><pre>        Invalid: ccNumber: You did not enter a valid number of digits</pre></div>
<div class="nocov"><span class="num"><pre>2738</pre></span><pre>        &gt;&gt;&gt; cc().to_python({})</pre></div>
<div class="nocov"><span class="num"><pre>2739</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2740</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>2741</pre></span><pre>        Invalid: The field ccType is missing</pre></div>
<div class="nocov"><span class="num"><pre>2742</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>2743</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2744</pre></span><pre>    validate_partial_form = True</pre></div>
<div class="skip"><span class="num"><pre>2745</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2746</pre></span><pre>    cc_type_field = 'ccType'</pre></div>
<div class="nocov"><span class="num"><pre>2747</pre></span><pre>    cc_number_field = 'ccNumber'</pre></div>
<div class="nocov"><span class="num"><pre>2748</pre></span><pre>    __unpackargs__ = ('cc_type_field', 'cc_number_field')</pre></div>
<div class="skip"><span class="num"><pre>2749</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2750</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre>2751</pre></span><pre>        'notANumber': _(&quot;Please enter only the number, no other characters&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>2752</pre></span><pre>        'badLength': _(&quot;You did not enter a valid number of digits&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>2753</pre></span><pre>        'invalidNumber': _(&quot;That number is not valid&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>2754</pre></span><pre>        'missing_key': _(&quot;The field %(key)s is missing&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>2755</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre>2756</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2757</pre></span><pre>    def validate_partial(self, field_dict, state):</pre></div>
<div class="nocov"><span class="num"><pre>2758</pre></span><pre>        if not field_dict.get(self.cc_type_field, None) \</pre></div>
<div class="nocov"><span class="num"><pre>2759</pre></span><pre>           or not field_dict.get(self.cc_number_field, None):</pre></div>
<div class="nocov"><span class="num"><pre>2760</pre></span><pre>            return None</pre></div>
<div class="nocov"><span class="num"><pre>2761</pre></span><pre>        self.validate_python(field_dict, state)</pre></div>
<div class="skip"><span class="num"><pre>2762</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2763</pre></span><pre>    def validate_python(self, field_dict, state):</pre></div>
<div class="cov"><span class="num"><pre>2764</pre></span><pre>        errors = self._validateReturn(field_dict, state)</pre></div>
<div class="cov"><span class="num"><pre>2765</pre></span><pre>        if errors:</pre></div>
<div class="cov"><span class="num"><pre>2766</pre></span><pre>            error_list = errors.items()</pre></div>
<div class="cov"><span class="num"><pre>2767</pre></span><pre>            error_list.sort()</pre></div>
<div class="cov"><span class="num"><pre>2768</pre></span><pre>            raise Invalid(</pre></div>
<div class="cov"><span class="num"><pre>2769</pre></span><pre>                '&lt;br&gt;\n'.join([&quot;%s: %s&quot; % (name, value)</pre></div>
<div class="cov"><span class="num"><pre>2770</pre></span><pre>                               for name, value in error_list]),</pre></div>
<div class="cov"><span class="num"><pre>2771</pre></span><pre>                field_dict, state, error_dict=errors)</pre></div>
<div class="skip"><span class="num"><pre>2772</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2773</pre></span><pre>    def _validateReturn(self, field_dict, state):</pre></div>
<div class="cov"><span class="num"><pre>2774</pre></span><pre>        for field in self.cc_type_field, self.cc_number_field:</pre></div>
<div class="cov"><span class="num"><pre>2775</pre></span><pre>            if field not in field_dict:</pre></div>
<div class="nocov"><span class="num"><pre>2776</pre></span><pre>                raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>2777</pre></span><pre>                    self.message('missing_key', state, key=field), value, state)</pre></div>
<div class="cov"><span class="num"><pre>2778</pre></span><pre>        ccType = field_dict[self.cc_type_field].lower().strip()</pre></div>
<div class="cov"><span class="num"><pre>2779</pre></span><pre>        number = field_dict[self.cc_number_field].strip()</pre></div>
<div class="cov"><span class="num"><pre>2780</pre></span><pre>        number = number.replace(' ', '')</pre></div>
<div class="cov"><span class="num"><pre>2781</pre></span><pre>        number = number.replace('-', '')</pre></div>
<div class="cov"><span class="num"><pre>2782</pre></span><pre>        try:</pre></div>
<div class="cov"><span class="num"><pre>2783</pre></span><pre>            long(number)</pre></div>
<div class="cov"><span class="num"><pre>2784</pre></span><pre>        except ValueError:</pre></div>
<div class="cov"><span class="num"><pre>2785</pre></span><pre>            return {self.cc_number_field: self.message('notANumber', state)}</pre></div>
<div class="skip"><span class="num"><pre>2786</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>2787</pre></span><pre>        assert self._cardInfo.has_key(ccType), (</pre></div>
<div class="cov"><span class="num"><pre>2788</pre></span><pre>            &quot;I can't validate that type of credit card&quot;)</pre></div>
<div class="cov"><span class="num"><pre>2789</pre></span><pre>        foundValid = False</pre></div>
<div class="cov"><span class="num"><pre>2790</pre></span><pre>        validLength = False</pre></div>
<div class="cov"><span class="num"><pre>2791</pre></span><pre>        for prefix, length in self._cardInfo[ccType]:</pre></div>
<div class="cov"><span class="num"><pre>2792</pre></span><pre>            if len(number) == length:</pre></div>
<div class="cov"><span class="num"><pre>2793</pre></span><pre>                validLength = True</pre></div>
<div class="cov"><span class="num"><pre>2794</pre></span><pre>            if (len(number) == length</pre></div>
<div class="cov"><span class="num"><pre>2795</pre></span><pre>                and number.startswith(prefix)):</pre></div>
<div class="cov"><span class="num"><pre>2796</pre></span><pre>                foundValid = True</pre></div>
<div class="cov"><span class="num"><pre>2797</pre></span><pre>                break</pre></div>
<div class="cov"><span class="num"><pre>2798</pre></span><pre>        if not validLength:</pre></div>
<div class="cov"><span class="num"><pre>2799</pre></span><pre>            return {self.cc_number_field: self.message('badLength', state)}</pre></div>
<div class="cov"><span class="num"><pre>2800</pre></span><pre>        if not foundValid:</pre></div>
<div class="cov"><span class="num"><pre>2801</pre></span><pre>            return {self.cc_number_field: self.message('invalidNumber', state)}</pre></div>
<div class="skip"><span class="num"><pre>2802</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>2803</pre></span><pre>        if not self._validateMod10(number):</pre></div>
<div class="cov"><span class="num"><pre>2804</pre></span><pre>            return {self.cc_number_field: self.message('invalidNumber', state)}</pre></div>
<div class="cov"><span class="num"><pre>2805</pre></span><pre>        return None</pre></div>
<div class="skip"><span class="num"><pre>2806</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2807</pre></span><pre>    def _validateMod10(self, s):</pre></div>
<div class="nocov"><span class="num"><pre>2808</pre></span><pre>        &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>2809</pre></span><pre>        This code by Sean Reifschneider, of tummy.com</pre></div>
<div class="nocov"><span class="num"><pre>2810</pre></span><pre>        &quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>2811</pre></span><pre>        double = 0</pre></div>
<div class="cov"><span class="num"><pre>2812</pre></span><pre>        sum = 0</pre></div>
<div class="cov"><span class="num"><pre>2813</pre></span><pre>        for i in range(len(s) - 1, -1, -1):</pre></div>
<div class="cov"><span class="num"><pre>2814</pre></span><pre>            for c in str((double + 1) * int(s[i])):</pre></div>
<div class="cov"><span class="num"><pre>2815</pre></span><pre>                sum = sum + int(c)</pre></div>
<div class="cov"><span class="num"><pre>2816</pre></span><pre>            double = (double + 1) % 2</pre></div>
<div class="cov"><span class="num"><pre>2817</pre></span><pre>        return((sum % 10) == 0)</pre></div>
<div class="skip"><span class="num"><pre>2818</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2819</pre></span><pre>    _cardInfo = {</pre></div>
<div class="nocov"><span class="num"><pre>2820</pre></span><pre>        &quot;visa&quot;: [('4', 16),</pre></div>
<div class="nocov"><span class="num"><pre>2821</pre></span><pre>                 ('4', 13)],</pre></div>
<div class="nocov"><span class="num"><pre>2822</pre></span><pre>        &quot;mastercard&quot;: [('51', 16),</pre></div>
<div class="nocov"><span class="num"><pre>2823</pre></span><pre>                       ('52', 16),</pre></div>
<div class="nocov"><span class="num"><pre>2824</pre></span><pre>                       ('53', 16),</pre></div>
<div class="nocov"><span class="num"><pre>2825</pre></span><pre>                       ('54', 16),</pre></div>
<div class="nocov"><span class="num"><pre>2826</pre></span><pre>                       ('55', 16)],</pre></div>
<div class="nocov"><span class="num"><pre>2827</pre></span><pre>        &quot;discover&quot;: [('6011', 16)],</pre></div>
<div class="nocov"><span class="num"><pre>2828</pre></span><pre>        &quot;amex&quot;: [('34', 15),</pre></div>
<div class="nocov"><span class="num"><pre>2829</pre></span><pre>                 ('37', 15)],</pre></div>
<div class="nocov"><span class="num"><pre>2830</pre></span><pre>        &quot;dinersclub&quot;: [('300', 14),</pre></div>
<div class="nocov"><span class="num"><pre>2831</pre></span><pre>                       ('301', 14),</pre></div>
<div class="nocov"><span class="num"><pre>2832</pre></span><pre>                       ('302', 14),</pre></div>
<div class="nocov"><span class="num"><pre>2833</pre></span><pre>                       ('303', 14),</pre></div>
<div class="nocov"><span class="num"><pre>2834</pre></span><pre>                       ('304', 14),</pre></div>
<div class="nocov"><span class="num"><pre>2835</pre></span><pre>                       ('305', 14),</pre></div>
<div class="nocov"><span class="num"><pre>2836</pre></span><pre>                       ('36', 14),</pre></div>
<div class="nocov"><span class="num"><pre>2837</pre></span><pre>                       ('38', 14)],</pre></div>
<div class="nocov"><span class="num"><pre>2838</pre></span><pre>        &quot;jcb&quot;: [('3', 16),</pre></div>
<div class="nocov"><span class="num"><pre>2839</pre></span><pre>                ('2131', 15),</pre></div>
<div class="nocov"><span class="num"><pre>2840</pre></span><pre>                ('1800', 15)],</pre></div>
<div class="nocov"><span class="num"><pre>2841</pre></span><pre>            }</pre></div>
<div class="skip"><span class="num"><pre>2842</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2843</pre></span><pre>class CreditCardExpires(FormValidator):</pre></div>
<div class="nocov"><span class="num"><pre>2844</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>2845</pre></span><pre>    Checks that credit card expiration date is valid relative to</pre></div>
<div class="nocov"><span class="num"><pre>2846</pre></span><pre>    the current date.</pre></div>
<div class="skip"><span class="num"><pre>2847</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2848</pre></span><pre>    You pass in the name of the field that has the credit card</pre></div>
<div class="nocov"><span class="num"><pre>2849</pre></span><pre>    expiration month and the field with the credit card expiration</pre></div>
<div class="nocov"><span class="num"><pre>2850</pre></span><pre>    year.</pre></div>
<div class="skip"><span class="num"><pre>2851</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2852</pre></span><pre>    ::</pre></div>
<div class="skip"><span class="num"><pre>2853</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2854</pre></span><pre>        &gt;&gt;&gt; ed = CreditCardExpires()</pre></div>
<div class="nocov"><span class="num"><pre>2855</pre></span><pre>        &gt;&gt;&gt; ed.to_python({'ccExpiresMonth': '11', 'ccExpiresYear': '2250'})</pre></div>
<div class="nocov"><span class="num"><pre>2856</pre></span><pre>        {'ccExpiresYear': '2250', 'ccExpiresMonth': '11'}</pre></div>
<div class="nocov"><span class="num"><pre>2857</pre></span><pre>        &gt;&gt;&gt; ed.to_python({'ccExpiresMonth': '10', 'ccExpiresYear': '2005'})</pre></div>
<div class="nocov"><span class="num"><pre>2858</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2859</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>2860</pre></span><pre>        Invalid: ccExpiresMonth: Invalid Expiration Date&lt;br&gt;</pre></div>
<div class="nocov"><span class="num"><pre>2861</pre></span><pre>        ccExpiresYear: Invalid Expiration Date</pre></div>
<div class="nocov"><span class="num"><pre>2862</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>2863</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2864</pre></span><pre>    validate_partial_form = True</pre></div>
<div class="skip"><span class="num"><pre>2865</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2866</pre></span><pre>    cc_expires_month_field = 'ccExpiresMonth'</pre></div>
<div class="nocov"><span class="num"><pre>2867</pre></span><pre>    cc_expires_year_field = 'ccExpiresYear'</pre></div>
<div class="nocov"><span class="num"><pre>2868</pre></span><pre>    __unpackargs__ = ('cc_expires_month_field', 'cc_expires_year_field')</pre></div>
<div class="skip"><span class="num"><pre>2869</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2870</pre></span><pre>    datetime_module = None</pre></div>
<div class="skip"><span class="num"><pre>2871</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2872</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre>2873</pre></span><pre>        'notANumber': _(&quot;Please enter numbers only for month and year&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>2874</pre></span><pre>        'invalidNumber': _(&quot;Invalid Expiration Date&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>2875</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre>2876</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2877</pre></span><pre>    def validate_partial(self, field_dict, state):</pre></div>
<div class="nocov"><span class="num"><pre>2878</pre></span><pre>        if not field_dict.get(self.cc_expires_month_field, None) \</pre></div>
<div class="nocov"><span class="num"><pre>2879</pre></span><pre>           or not field_dict.get(self.cc_expires_year_field, None):</pre></div>
<div class="nocov"><span class="num"><pre>2880</pre></span><pre>            return None</pre></div>
<div class="nocov"><span class="num"><pre>2881</pre></span><pre>        self.validate_python(field_dict, state)</pre></div>
<div class="skip"><span class="num"><pre>2882</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2883</pre></span><pre>    def validate_python(self, field_dict, state):</pre></div>
<div class="cov"><span class="num"><pre>2884</pre></span><pre>        errors = self._validateReturn(field_dict, state)</pre></div>
<div class="cov"><span class="num"><pre>2885</pre></span><pre>        if errors:</pre></div>
<div class="cov"><span class="num"><pre>2886</pre></span><pre>            error_list = errors.items()</pre></div>
<div class="cov"><span class="num"><pre>2887</pre></span><pre>            error_list.sort()</pre></div>
<div class="cov"><span class="num"><pre>2888</pre></span><pre>            raise Invalid(</pre></div>
<div class="cov"><span class="num"><pre>2889</pre></span><pre>                '&lt;br&gt;\n'.join([&quot;%s: %s&quot; % (name, value)</pre></div>
<div class="cov"><span class="num"><pre>2890</pre></span><pre>                               for name, value in error_list]),</pre></div>
<div class="cov"><span class="num"><pre>2891</pre></span><pre>                field_dict, state, error_dict=errors)</pre></div>
<div class="skip"><span class="num"><pre>2892</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2893</pre></span><pre>    def _validateReturn(self, field_dict, state):</pre></div>
<div class="cov"><span class="num"><pre>2894</pre></span><pre>        ccExpiresMonth = str(field_dict[self.cc_expires_month_field]).strip()</pre></div>
<div class="cov"><span class="num"><pre>2895</pre></span><pre>        ccExpiresYear = str(field_dict[self.cc_expires_year_field]).strip()</pre></div>
<div class="skip"><span class="num"><pre>2896</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>2897</pre></span><pre>        try:</pre></div>
<div class="cov"><span class="num"><pre>2898</pre></span><pre>            ccExpiresMonth = int(ccExpiresMonth)</pre></div>
<div class="cov"><span class="num"><pre>2899</pre></span><pre>            ccExpiresYear = int(ccExpiresYear)</pre></div>
<div class="cov"><span class="num"><pre>2900</pre></span><pre>            dt_mod = import_datetime(self.datetime_module)</pre></div>
<div class="cov"><span class="num"><pre>2901</pre></span><pre>            now = datetime_now(dt_mod)</pre></div>
<div class="cov"><span class="num"><pre>2902</pre></span><pre>            today = datetime_makedate(dt_mod, now.year, now.month, now.day)</pre></div>
<div class="cov"><span class="num"><pre>2903</pre></span><pre>            next_month = (ccExpiresMonth % 12) + 1</pre></div>
<div class="cov"><span class="num"><pre>2904</pre></span><pre>            if next_month == 1:</pre></div>
<div class="nocov"><span class="num"><pre>2905</pre></span><pre>                next_month_year = ccExpiresYear + 1</pre></div>
<div class="cov"><span class="num"><pre>2906</pre></span><pre>            else:</pre></div>
<div class="cov"><span class="num"><pre>2907</pre></span><pre>                next_month_year = ccExpiresYear</pre></div>
<div class="cov"><span class="num"><pre>2908</pre></span><pre>            expires_date = datetime_makedate(dt_mod, next_month_year, next_month, 1)</pre></div>
<div class="cov"><span class="num"><pre>2909</pre></span><pre>            assert expires_date &gt; today</pre></div>
<div class="cov"><span class="num"><pre>2910</pre></span><pre>        except ValueError:</pre></div>
<div class="cov"><span class="num"><pre>2911</pre></span><pre>            return {self.cc_expires_month_field: self.message('notANumber', state),</pre></div>
<div class="cov"><span class="num"><pre>2912</pre></span><pre>                    self.cc_expires_year_field: self.message('notANumber', state)}</pre></div>
<div class="cov"><span class="num"><pre>2913</pre></span><pre>        except AssertionError:</pre></div>
<div class="cov"><span class="num"><pre>2914</pre></span><pre>            return {self.cc_expires_month_field: self.message('invalidNumber', state),</pre></div>
<div class="cov"><span class="num"><pre>2915</pre></span><pre>                    self.cc_expires_year_field: self.message('invalidNumber', state)}</pre></div>
<div class="skip"><span class="num"><pre>2916</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2917</pre></span><pre>class CreditCardSecurityCode(FormValidator):</pre></div>
<div class="nocov"><span class="num"><pre>2918</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>2919</pre></span><pre>    Checks that credit card security code has the correct number</pre></div>
<div class="nocov"><span class="num"><pre>2920</pre></span><pre>    of digits for the given credit card type.</pre></div>
<div class="skip"><span class="num"><pre>2921</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2922</pre></span><pre>    You pass in the name of the field that has the credit card</pre></div>
<div class="nocov"><span class="num"><pre>2923</pre></span><pre>    type and the field with the credit card security code.</pre></div>
<div class="skip"><span class="num"><pre>2924</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2925</pre></span><pre>    ::</pre></div>
<div class="skip"><span class="num"><pre>2926</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2927</pre></span><pre>        &gt;&gt;&gt; code = CreditCardSecurityCode()</pre></div>
<div class="nocov"><span class="num"><pre>2928</pre></span><pre>        &gt;&gt;&gt; code.to_python({'ccType': 'visa', 'ccCode': '111'})</pre></div>
<div class="nocov"><span class="num"><pre>2929</pre></span><pre>        {'ccType': 'visa', 'ccCode': '111'}</pre></div>
<div class="nocov"><span class="num"><pre>2930</pre></span><pre>        &gt;&gt;&gt; code.to_python({'ccType': 'visa', 'ccCode': '1111'})</pre></div>
<div class="nocov"><span class="num"><pre>2931</pre></span><pre>        Traceback (most recent call last):</pre></div>
<div class="nocov"><span class="num"><pre>2932</pre></span><pre>            ...</pre></div>
<div class="nocov"><span class="num"><pre>2933</pre></span><pre>        Invalid: ccCode: Invalid credit card security code length</pre></div>
<div class="nocov"><span class="num"><pre>2934</pre></span><pre>    &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>2935</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2936</pre></span><pre>    validate_partial_form = True</pre></div>
<div class="skip"><span class="num"><pre>2937</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2938</pre></span><pre>    cc_type_field = 'ccType'</pre></div>
<div class="nocov"><span class="num"><pre>2939</pre></span><pre>    cc_code_field = 'ccCode'</pre></div>
<div class="nocov"><span class="num"><pre>2940</pre></span><pre>    __unpackargs__ = ('cc_type_field', 'cc_code_field')</pre></div>
<div class="skip"><span class="num"><pre>2941</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2942</pre></span><pre>    messages = {</pre></div>
<div class="nocov"><span class="num"><pre>2943</pre></span><pre>        'notANumber': _(&quot;Please enter numbers only for credit card security code&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>2944</pre></span><pre>        'badLength': _(&quot;Invalid credit card security code length&quot;),</pre></div>
<div class="nocov"><span class="num"><pre>2945</pre></span><pre>        }</pre></div>
<div class="skip"><span class="num"><pre>2946</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2947</pre></span><pre>    def validate_partial(self, field_dict, state):</pre></div>
<div class="nocov"><span class="num"><pre>2948</pre></span><pre>        if not field_dict.get(self.cc_type_field, None) \</pre></div>
<div class="nocov"><span class="num"><pre>2949</pre></span><pre>           or not field_dict.get(self.cc_code_field, None):</pre></div>
<div class="nocov"><span class="num"><pre>2950</pre></span><pre>            return None</pre></div>
<div class="nocov"><span class="num"><pre>2951</pre></span><pre>        self.validate_python(field_dict, state)</pre></div>
<div class="skip"><span class="num"><pre>2952</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2953</pre></span><pre>    def validate_python(self, field_dict, state):</pre></div>
<div class="nocov"><span class="num"><pre>2954</pre></span><pre>        errors = self._validateReturn(field_dict, state)</pre></div>
<div class="nocov"><span class="num"><pre>2955</pre></span><pre>        if errors:</pre></div>
<div class="nocov"><span class="num"><pre>2956</pre></span><pre>            error_list = errors.items()</pre></div>
<div class="nocov"><span class="num"><pre>2957</pre></span><pre>            error_list.sort()</pre></div>
<div class="nocov"><span class="num"><pre>2958</pre></span><pre>            raise Invalid(</pre></div>
<div class="nocov"><span class="num"><pre>2959</pre></span><pre>                '&lt;br&gt;\n'.join([&quot;%s: %s&quot; % (name, value)</pre></div>
<div class="nocov"><span class="num"><pre>2960</pre></span><pre>                               for name, value in error_list]),</pre></div>
<div class="nocov"><span class="num"><pre>2961</pre></span><pre>                field_dict, state, error_dict=errors)</pre></div>
<div class="skip"><span class="num"><pre>2962</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2963</pre></span><pre>    def _validateReturn(self, field_dict, state):</pre></div>
<div class="nocov"><span class="num"><pre>2964</pre></span><pre>        ccType = str(field_dict[self.cc_type_field]).strip()</pre></div>
<div class="nocov"><span class="num"><pre>2965</pre></span><pre>        ccCode = str(field_dict[self.cc_code_field]).strip()</pre></div>
<div class="skip"><span class="num"><pre>2966</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2967</pre></span><pre>        try:</pre></div>
<div class="nocov"><span class="num"><pre>2968</pre></span><pre>            int(ccCode)</pre></div>
<div class="nocov"><span class="num"><pre>2969</pre></span><pre>        except ValueError:</pre></div>
<div class="nocov"><span class="num"><pre>2970</pre></span><pre>            return {self.cc_code_field: self.message('notANumber', state)}</pre></div>
<div class="skip"><span class="num"><pre>2971</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2972</pre></span><pre>        length = self._cardInfo[ccType]</pre></div>
<div class="nocov"><span class="num"><pre>2973</pre></span><pre>        validLength = False</pre></div>
<div class="nocov"><span class="num"><pre>2974</pre></span><pre>        if len(ccCode) == length:</pre></div>
<div class="nocov"><span class="num"><pre>2975</pre></span><pre>            validLength = True</pre></div>
<div class="nocov"><span class="num"><pre>2976</pre></span><pre>        if not validLength:</pre></div>
<div class="nocov"><span class="num"><pre>2977</pre></span><pre>            return {self.cc_code_field: self.message('badLength', state)}</pre></div>
<div class="skip"><span class="num"><pre>2978</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>2979</pre></span><pre>    # key = credit card type</pre></div>
<div class="skip"><span class="num"><pre>2980</pre></span><pre>    # value = length of security code</pre></div>
<div class="nocov"><span class="num"><pre>2981</pre></span><pre>    _cardInfo = {</pre></div>
<div class="nocov"><span class="num"><pre>2982</pre></span><pre>        &quot;visa&quot;: 3,</pre></div>
<div class="nocov"><span class="num"><pre>2983</pre></span><pre>        &quot;mastercard&quot;: 3,</pre></div>
<div class="nocov"><span class="num"><pre>2984</pre></span><pre>        &quot;discover&quot;: 3,</pre></div>
<div class="nocov"><span class="num"><pre>2985</pre></span><pre>        &quot;amex&quot;: 4,</pre></div>
<div class="nocov"><span class="num"><pre>2986</pre></span><pre>            }</pre></div>
<div class="skip"><span class="num"><pre>2987</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>2988</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>2989</pre></span><pre>__all__ = ['Invalid']</pre></div>
<div class="nocov"><span class="num"><pre>2990</pre></span><pre>for name, value in globals().items():</pre></div>
<div class="nocov"><span class="num"><pre>2991</pre></span><pre>    if isinstance(value, type) and issubclass(value, Validator):</pre></div>
<div class="nocov"><span class="num"><pre>2992</pre></span><pre>        __all__.append(name)</pre></div>
<div class="skip"><span class="num"><pre>2993</pre></span><pre></pre></div>
</div>
</body>
</html>
